var piper={version:"0.1.0"};if(piper.utils={pipeline:function(){var e=arguments,t=this;return function(n){for(var r=0;r<e.length;r++){var a=e[r].call(this,n);n=t.mergeAll(n,a)}return n}},override:function(e,t){for(var n in t)n in e&&(e[n]=t[n])},merge:function(e,t){for(var n in t)t[n]&&t[n].constructor==Object&&e[n]?this.merge(e[n],t[n]):e[n]=t[n]},mergeAll:function(){for(var e={},t=arguments,n=0;n<t.length;n++)this.merge(e,t[n]);return e},reactiveProperty:function(e){function t(t){if(1===arguments.length){if(e=t,n)for(var r=0;r<n.length;r++)n[r](e);return this}return e}var n;return t.on=function(t){return n||(n=[]),n.push(t),"undefined"!=typeof e&&null!==e&&t(e),t},t.clear=function(e){return n=[],this},t.off=function(e){n&&(n=n.filter(function(t){return t!==e}))},t}},piper.barChartAutoConfig=function(e){return{axisYPadding:20}},piper.data=function(e){var t={data:null};piper.utils.override(t,e);var n=t.data.timestamps.map(function(e,n){return{x:e,y:t.data.values[n]}}),r=!n.filter(function(e){return null!=e.y}).length;return{dataConverted:n,dataIsAllNulls:r}},piper.scaleX=function(e){var t={dataConverted:null,margin:null,width:null,scaleType:null};piper.utils.override(t,e);var n=t.width-t.margin.left-t.margin.right,r=t.dataConverted.map(function(e){return e.x}),a=d3.time.scale.utc().domain(d3.extent(r)).range([0,n]);return{scaleX:a,chartWidth:n}},piper.scaleY=function(e){var t={dataConverted:null,margin:null,height:null};piper.utils.override(t,e);var n=t.height-t.margin.top-t.margin.bottom,r=t.dataConverted.map(function(e){return e.y}),a=d3.scale.linear().domain(d3.extent(r)).range([n,0]);return{scaleY:a,chartHeight:n}},piper.axisX=function(e){var t={scaleX:null,axisXFormat:function(e){return e.toString()}};piper.utils.override(t,e);var n=d3.svg.axis().scale(t.scaleX).orient("bottom").tickFormat(t.axisXFormat);return{axisX:n}},piper.axisY=function(e){var t={scaleY:null};piper.utils.override(t,e);var n=t.scaleY.range()[0],r=d3.svg.axis().scale(t.scaleY).orient("left").ticks(Math.max(~~(n/30),2),".s3").tickPadding(10);return{axisY:r}},piper.panelComponent=function(e){var t={container:null,width:null,height:null,margin:null};piper.utils.override(t,e),piper.events={mousemove:piper.utils.reactiveProperty(),mouseenter:piper.utils.reactiveProperty(),mouseout:piper.utils.reactiveProperty()};var n=d3.select(t.container).selectAll("svg").data([0]);n.enter().append("svg").attr({"class":"piper-chart"}).append("g").attr({"class":"panel"}),n.attr({width:t.width,height:t.height}),n.exit().remove();var r=n.select("g.panel").attr({transform:"translate("+t.margin.left+","+t.margin.top+")"});return{root:n,panel:r}},piper.axisComponentX=function(e){var t={axisX:null,chartHeight:null,panel:null};piper.utils.override(t,e);var n=t.panel.selectAll("g.axis.x").data([0]);return n.enter().append("g").attr({"class":"x axis",transform:"translate("+[0,t.chartHeight]+")"}),n.transition().attr({transform:"translate("+[0,t.chartHeight]+")"}).call(t.axisX),n.exit().remove(),{}},piper.axisComponentY=function(e){var t={axisY:null,panel:null,axisYPadding:null};piper.utils.override(t,e);var n=t.axisYPadding||0,r=t.panel.selectAll("g.axis.y").data([0]);return r.enter().append("g").attr({"class":"y axis",transform:"translate("+[-n/2,0]+")"}),r.transition().call(t.axisY),r.exit().remove(),{}},piper.axisTitleComponentX=function(e){var t={panel:null,axisTitleX:null,chartHeight:null,chartWidth:null};piper.utils.override(t,e);var n=t.panel.selectAll("text.axis-title.x").data([0]);return n.enter().append("text").attr({"class":"x axis-title"}),n.text(t.axisTitleX||"").attr({x:t.chartWidth,y:t.chartHeight}),n.exit().remove(),{}},piper.axisTitleComponentY=function(e){var t={panel:null,axisTitleY:null};piper.utils.override(t,e);var n=t.panel.selectAll("text.axis-title.y").data([0]);return n.enter().append("text").attr({"class":"y axis-title"}),n.text(t.axisTitleY||"").attr({x:-40,y:-10}),n.exit().remove(),{}},piper.chartTitleComponent=function(e){var t={panel:null,chartTitle:null,chartWidth:null};piper.utils.override(t,e);var n=t.panel.selectAll("text.chart-title").data([0]);return n.enter().append("text").attr({"class":"chart-title"}),n.text(t.chartTitle||"").attr({x:function(e){return(t.chartWidth-5*t.chartTitle.length)/2},y:-5}),n.exit().remove(),{}},piper.tooltipHTMLWidget=function(e){var t=d3.select(e).style({position:"absolute","pointer-events":"none",display:"none"}),n=function(e){return t.html(e),this},r=function(e){return t.style({left:e[0]+"px",top:e[1]+"px"}),this},a=function(){return t.style({display:"block"}),this},i=function(){return t.style({display:"none"}),this},l=function(){return t.node()};return{setText:n,setPosition:r,show:a,hide:i,getRootNode:l}},piper.tooltipComponent=function(e){var t={panel:null,dataIsAllNulls:null,events:null};piper.utils.override(t,e);var n=t.panel.selectAll("g.hover-tooltip").data([0]);return n.enter().append("g").classed("hover-tooltip",!0).attr({r:4}).style({"pointer-events":"none",display:"none"}).append("text"),n.exit().remove(),t.events.mousemove.on(function(e){t.dataIsAllNulls||n.attr({transform:"translate("+e.shapePosition+")"}).select("text").text(e.data.y)}),t.events.mouseenter.on(function(e){t.dataIsAllNulls||n.style({display:"block"})}),t.events.mouseout.on(function(e){n.style({display:"none"})}),{}},piper.hoverCircleComponent=function(e){var t={panel:null,dataIsAllNulls:null,events:null};piper.utils.override(t,e);var n=t.panel.selectAll("circle.hover-circle").data([0]);return n.enter().append("circle").classed("hover-circle",!0).attr({r:3}).style({"pointer-events":"none",display:"none"}),n.exit().remove(),t.events.mousemove.on(function(e){t.dataIsAllNulls||n.attr({transform:"translate("+e.shapePosition+")"})}),t.events.mouseenter.on(function(e){t.dataIsAllNulls||n.style({display:"block"})}),t.events.mouseout.on(function(e){n.style({display:"none"})}),{}},piper.tooltipLineComponent=function(e){var t={panel:null,dataIsAllNulls:null,events:null};piper.utils.override(t,e);var n=t.panel.selectAll("g.line-container").data([0]);n.enter().append("g").attr({"class":"line-container","pointer-events":"none"}).style({visibility:"hidden"}).append("line").attr({"class":"tooltip-line"}),n.exit().remove();var r=n.select(".tooltip-line");return t.events.mouseenter.on(function(e){t.dataIsAllNulls||r.style({visibility:"visible"})}),t.events.mouseout.on(function(e){r.style({visibility:"hidden"})}),t.events.mousemove.on(function(e){if(!t.dataIsAllNulls){var n=e.shapePosition[0],a=e.shapePosition[1];r.attr({x1:0,y1:a,x2:n,y2:a})}}),{}},piper.shapePanel=function(e){var t={panel:null};piper.utils.override(t,e);var n=t.panel.selectAll("g.shapes").data([0]);return n.enter().append("g").attr({"class":"shapes"}),n.exit().remove(),{shapePanel:n}},piper.message=function(e){var t={panel:null,dataConverted:null,dataIsAllNulls:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var n=piper.shapePanel(t);piper.utils.override(t,n);var r=t.shapePanel.selectAll("text").data(t.dataIsAllNulls?[0]:[]);return r.enter().append("text"),r.attr({x:(t.scaleX.range()[1]-t.scaleX.range()[0])/2,y:(t.scaleY.range()[0]-t.scaleY.range()[1])/2}).text("Values are all null").attr({dx:function(e){return-this.getBBox().width/2}}),r.exit().remove(),{}},piper.lineShapes=function(e){var t={panel:null,dataConverted:null,scaleX:null,scaleY:null,shapePanel:null};piper.utils.override(t,e);var n=piper.shapePanel(t);piper.utils.override(t,n);var r=d3.svg.line().defined(function(e){return null!=e.y}).x(function(e){return t.scaleX(e.x)}).y(function(e){return t.scaleY(e.y)}),a=t.shapePanel.selectAll("path.line").data([t.dataConverted]);return a.enter().append("path").attr({"class":"line shape"}).style({fill:"none"}),a.attr({d:r}),a.exit().remove(),{}},piper.events={},piper.eventsBinder=function(e){var t={container:null,panel:null,dataConverted:null,scaleX:null,scaleY:null,chartWidth:null,chartHeight:null};piper.utils.override(t,e);var n=t.dataConverted.map(function(e){return e.x}),r=t.scaleX(n[1])-t.scaleX(n[0]),a=t.panel.selectAll("g.event-panel-container").data([0]);this.dataConverted=t.dataConverted;return a.enter().append("g").attr({"class":"event-panel-container"}).append("rect").attr({"class":"event-panel"}).style({visibility:"hidden","pointer-events":"all"}),a.select("rect").attr({width:t.chartWidth,height:t.chartHeight}).on("mouseenter",function(e){piper.events.mouseenter({mouse:d3.mouse(this)})}).on("mouseout",function(e){piper.events.mouseout({mouse:d3.mouse(this)})}).on("mousemove",function(e,a){var i=d3.mouse(this),l=d3.mouse(t.container),s=this.getBoundingClientRect(),o=t.container.getBoundingClientRect(),p=o.left,u=o.top,c=t.scaleX.invert(i[0]-r/2),d=d3.bisectLeft(n,c.getTime()),v=t.dataConverted[d];if(v)var m=v.x,h=v.y,x=t.scaleX(m),f=t.scaleY(h);piper.events.mousemove({data:v,mouse:i,mouseFromContainer:[l[0]+p+window.pageXOffset,l[1]+u+window.pageYOffset],shapePosition:[x,f],shapePositionFromContainer:[x+s.left-o.left,f+s.top-o.top]})}),a.exit().remove(),{events:piper.events}},piper.axisXFormatterTime=function(e){var t={panel:null,dataConverted:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").text(function(e){return d3.time.format("%a")(e)}),{}},piper.axisXFormatterTimeHour=function(e){var t={panel:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").text(function(e){return d3.time.format("%x")(e)}),{}},piper.axisXFormatterRotate30=function(e){var t={panel:null};return piper.utils.override(t,e),t.panel.select("g.axis.x").selectAll(".tick text").style({transform:"rotate(30deg)","text-anchor":"start"}),{}},piper.axisYFormatSI=function(e){var t={axisY:null};return piper.utils.override(t,e),t.axisY.tickFormat(d3.format(".2s")),{}},piper.timeseriesLineChart=piper.utils.pipeline(piper.data,piper.scaleX,piper.scaleY,piper.axisX,piper.axisY,piper.panelComponent,piper.lineShapes,piper.message,piper.axisComponentX,piper.axisComponentY,piper.axisXFormatterRotate30,piper.axisTitleComponentY,piper.eventsBinder,piper.tooltipComponent,piper.hoverCircleComponent,piper.tooltipLineComponent),"object"==typeof module&&module.exports){var d3=require("d3");module.exports=piper}