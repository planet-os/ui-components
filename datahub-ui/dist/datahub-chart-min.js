!function(t){var e,a,r,n,i,l,s,o,c,u,d,m,h,p,f,v,g,x,y,b,w,A,k,D,T,M,S,Y,X,C,H=t="object"==typeof t?t:{},N="object"==typeof global?global:window;"object"==typeof module&&module.exports?N.d3=require("d3"):N.d3=N.d3,e=function(t,a){for(var r in a)a[r]&&a[r].constructor==Object&&t[r]?e(t[r],a[r]):t[r]=a[r]},a=function(t,e){return e.appendChild(document.importNode((new DOMParser).parseFromString(t,"text/html").body.childNodes[0],!0))},r=function(t,e){return e.appendChild(document.importNode((new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">'+t+"</svg>","application/xml").documentElement.firstChild,!0))},n=function(t,e){var a,r,n,i,l=[],s=Number.MAX_VALUE,o=Number.MIN_VALUE,c={};for(n=0;n<t.length;n++)for(a=t[n],i=0;i<a.length;i++)r=e?e(a[i]):a[i],l.push(r),c.hasOwnProperty(r)||null===r||(c[r]=1,r>o&&(o=r),r<s&&(s=r));return{flattened:l,uniques:Object.keys(c).map(function(t,e){return+t}),max:o,min:s}},i=function(t,e,a){for(var r,n=0,i=t.length-1;n<i;)r=n+i>>1,a&&e>=t[r]||!a&&e<t[r]?i=r:n=r+1;return n},H.utils={merge:e,mergeAll:function(t,e){for(var a=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(a[i]=n[i])}return a},htmlToNode:function(t,e){for(;e.lastChild;)e.removeChild(e.lastChild);return a(t,e)},appendHtmlToNode:a,svgToNode:function(t,e){var a=e.parentNode,n=e.cloneNode(!1);return a.removeChild(e),a.appendChild(n),r(t,n)},appendSvgToNode:r,once:function(t,e){var a;return function(){return t&&(a=t.apply(e||this,arguments),t=null),a}},throttle:function(t,e){var a=!1,r=null;return function(){var n=this;a||(a=!0,clearTimeout(r),r=setTimeout(function(){a=!1,t.apply(n,arguments)},e))}},arrayStats:n,arrayUniques:function(t,e){return n(t,e).uniques},arrayFlatten:function(t,e){return n(t,e).flattened},bisection:i,bisectionReversed:function(t,e){return i(t,e,!0)},findMax:function(t){var e,a=0,r=t.length;for(e=0;e<r;e++)t[e]>a&&(a=t[e]);return a},findMin:function(t){var e,a=1/0,r=t.length;for(e=0;e<r;e++)t[e]<a&&(a=t[e]);return a},parseRGB:function(t){return t.slice(4).slice(0,-1).split(",").map(function(t,e){return parseInt(t)})},pipeline:function(){var t=arguments,e=this;return function(a){for(var r=0;r<t.length;r++){var n=t[r].call(this,a);a=e.mergeAll(a,n)}return a}},override:function(t,e){for(var a in e)a in t&&(t[a]=e[a])},rebind:function(t){return function(){return t.on.apply(t,arguments),this}},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},getExtent:function(t,e){return t?d3[e?"min":"max"](t.map(function(t){return t.value})):null},getStackExtent:function(t,e){var a=e?"min":"max";if(t&&t.length){var r=t.map(function(t){return d3.sum(t.value)});return d3[a](r)}return null},getMultiExtent:function(t,e){var a=e?"min":"max";if(t&&t.length){var r=t.map(function(t,e){return t.value});return r[0].length&&(r=d3.merge(r)),d3[a](r)}return null}},l=H,s=N.d3,o=function(t){var e=t.axisXFormat||"%b",a=s.utcFormat(e)||function(t){return t.toString()};return{axisX:s.axisBottom().scale(t.scaleX).tickFormat(a)}},c=function(t){var e=s.select(t.parent).selectAll("div.widget-container").data([0]),a=e.enter().append("div").attr("class","widget-container").merge(e).attr("width",t.width).attr("height",t.height);return e.exit().remove(),{container:a}},l.common={axesFormatAutoconfig:function(t){var e=s.utcFormat("%b %e, %Y at %H:%M UTC"),a="";if(!t.dataIsEmpty){var r=function(t){return t%1?~~(100*t)/100:t},n=[],i=s.extent(t.timestamps),l=i[0],o=i[1];l.getTime()===o.getTime()&&l.getUTCMonth()===o.getUTCMonth()||n.push("%b %e"),l.getYear()!==o.getYear()&&n.push("%Y"),l.getYear()===o.getYear()&&l.getUTCHours()!==o.getUTCHours()&&n.push("%H:%M"),a=s.utcFormat(n.join(" "))}return{axisXFormat:a,axisTitleXFormat:function(t){return e(t.data.x)},tooltipFormat:function(t){return r(t.data.y)}}},defaultConfig:function(t){return{margin:t.margin||{top:50,right:50,bottom:100,left:50},width:t.width||600,height:t.height||300}},sortData:function(t){return t.dataConverted.sort(function(t,e){var a=t.x.getTime(),r=e.x.getTime();return a<r?-1:a>r?1:0}),{}},detectDataAllNulls:function(t){return{dataIsAllNulls:!t.flattenedData.filter(function(t){return null!=t.y}).length}},axisX:o,axisY:function(t){var e=t.axisYFormat||".2s",a=s.format(e),r=t.scaleY.range()[0];return{axisY:s.axisLeft().scale(t.scaleY).ticks(Math.max(~~(r/30),2)).tickPadding(10).tickFormat(a).tickSize(-t.chartWidth)}},axisComponentX:function(t){var e=t.container.selectAll("g.axis.x").data([0]),a=e.enter().append("g").attr("class","x axis").attr("transform","translate("+[0,t.chartHeight]+")").merge(e).attr("display",function(e){return t.dataIsEmpty?"none":null}).attr("transform","translate("+[0,t.chartHeight]+")");a.call(t.axisX),e.exit().remove();var r=[],n=(a.selectAll(".tick").select("text").each(function(t,e){var a=this.getBBox().width;a&&r.push(a)}),Math.floor(s.max(r)/t.stripeScaleX.bandwidth()));return n&&a.selectAll(".tick text").attr("display",function(t,e){return e%(n+1)?"none":"block"}),{}},axisComponentY:function(t){var e=t.axisYPadding||0,a=t.container.selectAll("g.axis.y").data([0]);return a.enter().append("g").attr("class","y axis").attr("transform","translate("+[-e/2,0]+")").merge(a).call(t.axisY).attr("text-anchor","start").selectAll("text").attr("dx",10-t.margin.left),a.exit().remove(),{}},axisTitleComponentX:function(t){var e=t.container.selectAll("text.axis-title.x").data([0]);return e.enter().append("text").attr("class","x axis-title").merge(e).text(t.axisTitleX||"").attr("x",t.chartWidth).attr("y",t.chartHeight),e.exit().remove(),{axisTitleXComponent:o}},axisTitleComponentY:function(t){var e=t.container.selectAll("text.axis-title.y").data([0]);return e.enter().append("text").attr("class","y axis-title").merge(e).text(t.axisTitleY||"").attr("x",-t.margin.left).attr("y",-10).attr("text-anchor","start"),e.exit().remove(),{}},chartTitleComponent:function(t){var e=t.container.selectAll("text.chart-title").data([t.chartTitle||""]);return e.enter().append("text").attr("class","chart-title").merge(e).html(function(t){return t}).attr("x",function(e){return(t.chartWidth-5*e.length)/2}).attr("y",-5),e.exit().remove(),{}},shapePanel:function(t){var e=t.container.selectAll("g.shapes").data([0]),a=e.enter().append("g").attr("class","shapes").merge(e);return e.exit().remove(),{shapePanel:a}},svgContainer:function(t){var e=c(t).container.selectAll("svg").data([0]),a=e.enter().append("svg").attr("class","datahub-chart"),r=a.append("g").attr("class","panel").merge(e).attr("transform","translate("+t.margin.left+","+t.margin.top+")");return a.merge(e).attr("width",t.width).attr("height",t.height),e.exit().remove(),{root:e,container:r}},container:c,message:function(t){var e="";t.dataIsEmpty?e="(Data Unavailable)":t.dataIsAllNulls&&(e="Values are all null");var a=t.container.select(".message-group").selectAll("text").data([e]);return a.enter().append("text").merge(a).attr("x",t.chartWidth/2).attr("y",function(){return t.height/2-this.getBBox().height/2}).text(function(t){return t}).attr("dx",function(t){return-this.getBBox().width/2}),a.exit().remove(),{}},axisXFormatterTime:function(t){return t.container.select("g.axis.x").selectAll(".tick text").text(function(t){return s.timeFormat("%a")(t)}),{}},axisXFormatterTimeHour:function(t){return t.container.select("g.axis.x").selectAll(".tick text").text(function(t){return s.timeFormat("%x")(t)}),{}},axisXFormatterRotate30:function(t){return t.container.select("g.axis.x").selectAll(".tick text").style("transform","rotate(30deg)").style("text-anchor","start"),{}},axisYFormatSI:function(t){return config.axisY.tickFormat(s.format(".2s")),{}},labelsRewriterY:function(t){return t.labelsRewriterY?(t.container.selectAll("g.axis.y").selectAll("text").each(function(e,a){H.utils.svgToNode(t.labelsRewriterY(e,a,t),this)}),{}):{}},printer:function(t){console.warn(t)}},function(t,e){var a={currentBaseURI:"https://data.planetos.com/",baseURI:"https://api.planetos.com/v1a/",datasetsEndpoint:"https://api.planetos.com/v1/datasets/",apiKey:null},r=function(t){return{type:"FeatureCollection",features:t.map(function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:{id:t.id}}})}};var n=function(t,e){var a=e||function(t,e){return 0};return Array.apply(null,Array(t)).map(a)},i=function(a){var r={count:(a=a||{}).count||12,layerCount:a.layerCount||1,timeStart:a.timeStart||"2016-01-01",timeIncrement:a.timeIncrement||"month",step:a.step||1,min:a.min||0,max:a.max||100},n="utc"+t.utils.capitalize(r.timeIncrement)||"utcHour",i=e[n],l=e[n+"s"],s=r.timeStart?new Date(r.timeStart):new Date;return l(s,i.offset(s,r.count*r.step),r.step).map(function(t,a){return e.isoFormat(t)})},l=function(t,e){var a="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("get",t,!0),a.onreadystatechange=function(){var t,r;4==a.readyState&&(200==(t=a.status)?(r=JSON.parse(a.responseText),e(null,r)):e(t))},a.send()};function s(t){if(t)return!0;throw"You need to set an API key using `datahub.data.setApiKey(API_KEY)`. You can get yours at http://data.planetos.com/"}t.data={generateRaster:function(){var e={lon:n(360,function(t,e){return e-180}),lat:n(180,function(t,e){return 180-e-90}),values:n(180,function(t,e){return n(360,function(t,e){return~~(100*Math.random())})})};return e.uniqueValues=t.utils.arrayUniques(e.values),e},generateGeojson:function(){return{type:"Feature",properties:{name:""},geometry:{type:"LineString",coordinates:[[-170,80],[170,80],[170,-80],[-170,-80],[-170,80]]}}},generateTimeSeries:function(t){var e={count:(t=t||{}).count||12,layerCount:t.layerCount||1,timeStart:t.timeStart||"2016-01-01",timeIncrement:t.timeIncrement||"month",step:t.step||1,min:t.min||0,max:t.max||100},a=~~(Math.random()*(e.max-e.min))+e.min,r=n(e.count,function(){return n(e.layerCount,function(t){return a+=(2*Math.random()-1)*((e.max-e.min)/10),a=Math.max(a,e.min)})});return i(e).map(function(t,e){return{timestamp:t,value:r[e],id:r[e].map(function(t){return~~(1e3*Math.random())}),className:r[e].map(function(t){return Math.random().toString(36).substring(4,8)})}})},generateTimeSeriesSplit:function(t){var e={count:(t=t||{}).count||12,layerCount:t.layerCount||1,timeStart:t.timeStart||"2016-01-01",timeIncrement:t.timeIncrement||"month",step:t.step||1,min:t.min||0,max:t.max||100},a=~~(Math.random()*(e.max-e.min))+e.min;return n(e.layerCount,function(){var t,r={},l=i(e);return r.data=n(e.count,function(t,r){return a+=(2*Math.random()-1)*((e.max-e.min)/10),a=Math.max(a,e.min),{value:a=Math.min(a,e.max),timestamp:l[r]}}),r.metadata={id:(t=8,Math.random().toString(36).substring(4,t+4||8))},r})},generateTimestamps:i,generateWeatherChartData:function(){var t={layerCount:1,count:10,timeIncrement:"minute",min:0,max:50},e=H.utils.mergeAll({},t,{layerCount:1,count:100,timeIncrement:"hour"});return{historical:{wind:H.data.generateTimeSeriesSplit(t)[0],windDirection:H.data.generateTimeSeriesSplit(t)[0],wave:H.data.generateTimeSeriesSplit(t)[0],tide:H.data.generateTimeSeriesSplit(t)[0],bottomAxis:H.data.generateTimeSeriesSplit(t)[0],topAxis:H.data.generateTimeSeriesSplit(t)[0]},forecast:{wind:H.data.generateTimeSeriesSplit(e)[0],windDirection:H.data.generateTimeSeriesSplit(e)[0],wave:H.data.generateTimeSeriesSplit(e)[0],tide:H.data.generateTimeSeriesSplit(e)[0],bottomAxis:H.data.generateTimeSeriesSplit(e)[0],topAxis:H.data.generateTimeSeriesSplit(e)[0]}}},getDatasetDetails:function(t,e){s(a.apiKey);var r=a.baseURI+"/datasets/"+t+"?apikey="+a.apiKey;return console.log("get dataset details",r),l(r,function(t,a){if(void 0===a)return console.log("Can not render dataset because of API error",t),!1;var r="grid"===(a.FeatureType||"timeseries").toLowerCase().trim()?"raster":"timeseries";console.log("Data type:",r,a.ProductType,a.FeatureType,a),e({datasetInfo:a,dataType:r,productType:a.ProductType})}),this},getVariables:function(t,e,r){s(a.apiKey);var n=a.baseURI+"/datasets/"+t+"/variables?apikey="+a.apiKey;return console.log("query variables",n),l(n,function(a,n){var i,l=n[t],s=e;s&&(i=l.filter(function(t){return t.name===s})[0]);var o=i||l[0];r({variables:l,defaultVariable:o})}),this},getTimestamps:function(t,e,r){s(a.apiKey);var n=a.baseURI+"/datasets/"+t+"/variables/"+encodeURIComponent(e)+"/timestamps?apikey="+a.apiKey;return console.log("query timestamps",n),l(n,function(t,e){if(t)console.log("Server error",t);else{var a=e.map(function(t){return new Date(parseInt(t))});r({timestamps:a})}}),this},getPreview:function(e,r,n,i){s(a.apiKey);var o=a.baseURI+"/datasets/"+e+"/variables/"+encodeURIComponent(r);return n&&(o+="/timestamps/"+n),o+="/sample_data",o+="?apikey="+a.apiKey,console.log("query dataset",o),l(o,function(n,l){if(n)console.log("Server error",n);else{l.values=l.values.map(function(t,e){return t.map(function(t){return-999===t?null:t})}),l.uniqueValues=t.utils.arrayUniques(l.values).sort();var s=a.currentBaseURI+"/datasets/"+e+"?variable="+r;i({json:l,uri:o,datahubLink:s})}}),this},getStations:function(t,e){s(a.apiKey);var r=a.datasetsEndpoint+t+"/stations?apikey="+a.apiKey;return console.log("get stations",r),l(r,function(t,a){if(t)console.log("Server error",t);else{var r=[];for(var n in a.station){var i=a.station[n];void 0!==i.SpatialExtent&&r.push({id:n,coordinates:i.SpatialExtent.coordinates})}e({stations:r,defaultStation:r[0]})}}),this},getStationVariables:function(t,e,r,n,i){s(a.apiKey);var o=a.datasetsEndpoint+t+"/stations/"+e+"?apikey="+a.apiKey+"&verbose=true&count=500";return n||(o+="&time_order=desc"),console.log("station variable",o),l(o,function(e,n){if(e)console.log("Server error",e);else{console.log("Point API data",n,o);var l,s,c={},u=[],d=n.metadata.contexts;for(var m in d){l=d[m].dataVariables,d[m].axes&&Object.keys(d[m].axes)&&Object.keys(d[m].axes).map(function(t,e){return t.toLowerCase().trim()}).indexOf("time")>-1&&(u=u.concat(Object.keys(l)));for(var h in l)(s=l[h]).key=h,c[h]=s}var p={};n.entries.forEach(function(t){for(var e in t.data)p[e]||(p[e]={values:[],timestamps:[]}),p[e].values.push(t.data[e]),p[e].timestamps.push(new Date(t.axes.time))});var f=[];for(var v in c)f.push(c[v]);var g=a.currentBaseURI+"/datasets/"+t+"?variable="+r;i({datasets:p,variablesMetadata:c,variables:f,datahubLink:g,variableData:p[r],variableMetadata:c[r],timeVariableIDs:u})}}),this},getImage:function(t,e,r,n,i){s(a.apiKey);var o=a.baseURI+"/datasets/"+t+"/variables/"+encodeURIComponent(e);return r&&(o+="/timestamps/"+r),o+="/image",o+="?width="+n+"&projection=mercator",o+="&apikey="+a.apiKey,console.log("query image",o),l(o,function(t,e){i(e.img,e.metadata)}),this},getJSON:l,apiConfig:a,pointsToFeatures:r,generateGeojsonPoints:function(){var t=n(50,function(t,e){return{coordinates:[360*Math.random()-180,180*Math.random()-90],id:"random-point-"+e}});return r(t)},getWorldVector:function(t){l("https://cdn.rawgit.com/johan/world.geo.json/master/countries.geo.json",function(e,a){t(a)})},setApiKey:function(t){return a.apiKey=t,this},setApiConfig:function(t){return a=H.utils.mergeAll(a,t),this}}}(H,N.d3),u=H,d=N.d3,m=function(t){t.container.classed("datahub-slider",!0);var e=d.dispatch("brush"),a=d.brushX().extent([[0,0],[t.sliderWidth,t.sliderHeight-12]]).handleSize(10).on("brush",function(){var a=d.event.selection,r={start:t.scaleX.invert(a[0]),end:t.scaleX.invert(a[1])};e.call("brush",null,{brushExtent:r})}),r=t.container.selectAll("g.brush").data([0]);r.enter().append("g").attr("class","brush").attr("transform","translate("+[0,t.margin.top]+")").merge(r).attr("transform","translate("+[0,t.margin.top]+")").call(a).call(a.move,t.scaleX.range());return r.exit().remove(),t.initialTimeRange,{events:e}},h=function(t){var e=u.utils.appendHtmlToNode('<div class="datahub-month-calendar"> <div class="year-selector">     <div class="prev-year">&lsaquo;</div>     <div class="selected-year"></div>     <div class="next-year">&rsaquo;</div> </div> <div class="month-selector"> </div></div>',t.parent),a=d.select(e),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n={month:r[(new Date).getMonth()],year:(new Date).getFullYear()},i=d.dispatch("change","update");function l(){m.text(n.year),c()}function s(){p.classed("active",function(t){return t===n.month}),c()}function o(){i.call("change",null,f()),c()}function c(){i.call("update",null,f())}var m=a.select(".selected-year").text(n.year);a.select(".prev-year").on("click",function(t){n.year-=1,l(),o()}),a.select(".next-year").on("click",function(t){n.year+=1,l(),o()});var h=a.select(".month-selector").selectAll(".element").data(r),p=h.enter().append("div").attr("class","element month").text(function(t){return t}).on("click",function(t){var e=this;p.classed("active",function(){return e===this}),n.month=t,s(),o()}).merge(h).classed("active",function(t){return t===n.month});function f(){return{year:n.year,month:n.month,date:v(),iso:x(),formatted:g()}}function v(){return new Date(n.year,r.indexOf(n.month))}function g(t){var e=t||"%B %Y";return d.timeFormat(e)(v())}function x(t){return d.isoFormat(v())}function y(t){return n={month:r[new Date(t).getMonth()],year:new Date(t).getFullYear()},l(),s(),this}function b(t){return n.month=t,s(),this}function w(t){return n.year=t,l(),this}function A(t){return n.month=r[t],s(),this}return t.defaultMonth&&t.defaultYear?(b(t.defaultMonth),w(t.defaultYear)):t.defaultMonthNumber&&t.defaultYear?(A(t.defaultMonthNumber),w(t.defaultYear)):y(t.defaultDate||new Date),o(),{on:u.utils.rebind(i),getDateFormats:f,getDate:v,getISODate:x,getFormattedDate:g,setDate:y,setMonth:b,setYear:w,getMonthNames:function(){return r},setMonthNumber:A,destroy:function(){t.parent.innerHTML=null}}},p=function(t){var e,a=u.utils.appendHtmlToNode('<div class="datahub-dropdown"> <div class="top">     <div class="title"></div>     <div class="selected-element"></div> </div> <div class="elements"></div></div>',t.parent),r=d.select(a),n=r.select(".elements"),i=d.dispatch("change");r.select(".title").html(t.title);var l=r.on("mouseover",function(){var t="ontouchstart"in document.documentElement;n.classed("active")||t||m()}).on("mouseout",function(){var t=n.classed("active"),e="ontouchstart"in document.documentElement;t&&!e&&h()}).select(".top").on("click",function(){n.classed("active")?h():m()}).select(".selected-element");function s(t){return l.html(t),e&&e.classed("active",function(e){return e.label===t}),this}function o(a){if(!a)return this;var r=n.selectAll(".element").data(a,function(t){return t.key});return e=r.enter().append("div").attr("class","element").on("mouseover",m).on("click",function(a){if(!t.ignoreClickEvents){var r=this;e.classed("active",function(){return r===this}),s(a.label),i.call("change",null,a),h()}}).merge(r).html(function(t){return t.label}),r.exit().remove(),s(t.selected||t.elements[0].label),this}function c(t){return n.classed("active",t),this}function m(){return c(!0),this}function h(){return c(!1),this}return o(t.elements),{on:u.utils.rebind(i),toggle:c,open:m,close:h,isOpened:function(){return n.classed("active")},setElements:o,setSelected:s}},m=u.utils.pipeline(function(t){var e=t.width-t.margin.left-t.margin.right,a=t.timeRange.map(function(t){return new Date(t)});return{scaleX:d.scaleTime().domain(a).range([0,e]),sliderWidth:e}},function(t){var e=t.height-t.margin.top-t.margin.bottom,a=t.axisXFormat||d.utcFormat("%b");return{axisX:d.axisBottom().scale(t.scaleX).tickFormat(a).tickSize(e-12),sliderHeight:e}},u.common.svgContainer,function(t){var e=t.container.selectAll("g.axis.x").data([0]);return e.enter().append("g").attr("class","x axis").attr("transform","translate("+[0,t.margin.top]+")").merge(e).transition().attr("transform","translate("+[0,t.margin.top]+")").call(t.axisX),e.exit().remove(),{}},m),f=u.utils.pipeline(u.common.container,function(t){t.container.classed("datahub-button-group",!0);var e=d.dispatch("click"),a=t.container.selectAll(".element").data(t.elements),r=a.enter().append("div").on("click",function(a){var n=this,i=!1;r.classed("active",function(){return isAlreadyActive=this.classList.contains("active"),isTarget=n===this,isTarget&&isAlreadyActive&&!1!==t.isTogglable&&(i=!0),t.isExclusive?(!isAlreadyActive||isAlreadyActive&&!1===t.isTogglable)&&isTarget:isTarget?!isAlreadyActive:isAlreadyActive}),e.call("click",null,{selected:i?null:a})}).merge(a).attr("class",function(t){return"element "+(t.className||"")}).classed("active",function(e){return e.key===t.defaultElementKey}).html(function(t){return t.label});return a.exit().remove(),{events:e}}),u.widget={timeSlider:m,buttonGroup:f,number:function(t){var e={title:t.title,value:t.value,info:t.info},a=u.utils.appendHtmlToNode('<div class="datahub-number"><div class="title"></div><div class="value"></div><div class="info"></div></div>',t.parent),r=d.select(a).on("click",function(t){n.call("click",null,e)}),n=d.dispatch("click");function i(t){return e.title=t||e.title,r.select(".title").html(e.title),this}function l(t){return e.value=t||e.value,r.select(".value").html(e.value),this}function s(t){return e.info=t||e.info,r.select(".info").html(e.info),this}return i(e.title),l(e.value),s(e.info),{on:u.utils.rebind(n),setTitle:i,setValue:l,setInfo:s}},table:function(t){var e=u.utils.appendHtmlToNode('<div class="datahub-table"><div class="header-row"></div></div>',t.parent),a=d.select(e),r={elements:t.elements,header:t.header,defaultSortKey:t.header?t.header[0].key:null};function n(t){if(!t)return this;r.header=t,r.defaultSortKey=t[0].key;var e=a.select(".header-row").selectAll(".header-cell").data(t),n=e.enter().append("div").attr("class","header-cell").on("click",function(t,e){if(this.classList.contains("sortable")&&r.elements){var a=this,l=!1;n.classed("ascending",function(t){var e=a===this;return e&&(e=!(l=this.classList.contains("ascending"))),e}),i(r.elements,t.key,!l)}}).merge(e).classed("sortable",function(t){return t.sortable}).classed("ascending",function(t){return t.key===r.defaultSortKey}).html(function(t){return t.label});e.exit().remove()}function i(t,e,n){if(!t||!r.header)return this;r.elements=t;var i,l,s,o,c=e||r.defaultSortKey,u=(i=t,l=c,s=void 0===n||n,o=r.header.map(function(t){return t.key}).indexOf(l),JSON.parse(JSON.stringify(i)).sort(function(t,e){return t[o]<e[o]?s?-1:1:t[o]>e[o]?s?1:-1:0})),d=a.selectAll(".table-row").data(u),m=d.enter().append("div").attr("class","table-row").merge(d);d.exit().remove();var h=m.selectAll(".cell").data(function(t){return t});h.enter().append("div").attr("class","cell").merge(h).html(function(t){return t}),h.exit().remove()}return i(t.elements),n(t.header),{setHeader:n,setElements:i}},alertMessage:function(t){var e=u.utils.appendHtmlToNode('<div class="datahub-alert-message"><div class="alert-band"></div><div class="alert-message"></div></div>',t.parent),a=d.select(e);function r(t){a.select(".alert-band").classed(t,!0)}function n(t){a.select(".alert-message").html(t)}return r(t.level),n(t.message),{setLevel:r,setMessage:n}},monthCalendar:h,dropdown:p,dropdownCalendar:function(t){var e=d.dispatch("change"),a=p({parent:t.parent,ignoreClickEvents:!0}),r=h({parent:t.parent.querySelector(".elements"),defaultDate:t.defaultDate,defaultMonthNumber:t.defaultMonthNumber,defaultYear:t.defaultYear,defaultMonth:t.defaultMonth}).on("change",function(t){e.call("change",null,t)}).on("update",function(t){a.setSelected(t.formatted)});return a.setSelected(r.getFormattedDate()),{on:u.utils.rebind(e),toggle:a.toggle,open:a.open,close:a.close,isOpened:a.isOpened,setElements:a.setElements,setSelected:a.setSelected,getDateFormats:r.getDateFormats,getDate:r.getDate,getISODate:r.getISODate,getFormattedDate:r.getFormattedDate,setDate:r.setDate,setMonth:r.setMonth,setYear:r.setYear,getMonthNames:r.getMonthNames,setMonthNumber:r.setMonthNumber}}},v=H,g=N.d3,x=function(t,e,a){return t[e]?t[e].map(function(t){return t.timestamp=new Date(t.timestamp),t.value=Array.isArray(t.value)&&!a?t.value[0]:t.value,t}):[]},y=function(t,e,a){if(!a)return null;var r=t[e].map(function(t){return t.timestamp&&t.timestamp.getTime()}).indexOf(a.getTime());if(r>-1){var n=v.utils.mergeAll({},t[e][r]);return n.value=[].concat(t[e][r].value),n.id=[].concat(t[e][r].id),n}return null},b=function(t,e){return{referenceData:y(e,"referenceData",t),estimateData:y(e,"estimateData",t),barData:y(e,"barData",t),stackedBarData:y(e,"stackedBarData",t),lineData:y(e,"lineData",t),areaData:y(e,"areaData",t),stackedAreaData:y(e,"stackedAreaData",t),thresholdData:function(t,e,a){if(t[e][0]){var r=v.utils.mergeAll({},t[e][0]);return r.value=[].concat(t[e][0].value),r.id=[].concat(t[e][0].id),r}return null}(e,"thresholdData")}},w=v.utils.pipeline(v.common.defaultConfig,function(t){var e,a=t.data||{};return{dataIsEmpty:!a||!a.timestamp||!a.timestamp.length,data:{timestamp:(e=a,e.timestamp?e.timestamp.map(function(t){return new Date(t)}):[]),stackedBarData:x(a,"stackedBarData",!0),stackedAreaData:x(a,"stackedAreaData",!0),lineData:x(a,"lineData",!0),barData:x(a,"barData"),referenceData:x(a,"referenceData"),estimateData:x(a,"estimateData"),thresholdData:x(a,"thresholdData"),areaData:x(a,"areaData")}}},function(t){var e=t.parent.querySelector(".widget-container");e||(e=v.utils.appendHtmlToNode('<div class="widget-container"><svg class="datahub-chart"><g class="panel"><g class="stripe-group"></g><g class="area-group"></g><g class="stacked-area-group"></g><g class="reference-bar-group"></g><g class="reference-line-group"></g><g class="bar-group"></g><g class="stacked-bar-group"></g><g class="estimate-bar-group"></g><g class="line-group"></g><g class="dot-group"></g><g class="threshold-line-group"></g><g class="y axis"></g><g class="x axis"></g><g class="active-group"></g><g class="title-container"><text class="y axis-title"></text><text class="x axis-title"></text><text class="chart-title"></text></g><g class="message-group"></g><g class="events"><rect class="event-panel"></rect></g></g></svg></div>',t.parent));var a=t.width-t.margin.left-t.margin.right,r=t.height-t.margin.top-t.margin.bottom,n=g.select(e);return n.select("svg").attr("width",t.width).attr("height",t.height),n.select(".panel").attr("transform","translate("+t.margin.left+","+t.margin.top+")"),n.select(".events rect").attr("width",a).attr("height",r).attr("opacity",0),{container:n,chartWidth:a,chartHeight:r}},function(t){var e=t.dataIsEmpty?0:t.data.timestamp,a=g.scaleBand().domain(e).range([0,t.chartWidth]).paddingInner(.4).paddingOuter(.2);return{scaleX:a,referenceScaleX:a.copy().paddingInner(.1).paddingOuter(.05),stripeScaleX:a.copy().paddingInner(0).paddingOuter(0),lineScaleX:a.copy().paddingInner(1).paddingOuter(.5)}},function(t){var e=[];e.push(v.utils.getExtent(t.data.barData)),e.push(v.utils.getExtent(t.data.referenceData)),e.push(v.utils.getExtent(t.data.estimateData)),e.push(v.utils.getExtent(t.data.thresholdData)),e.push(v.utils.getExtent(t.data.areaData)),e.push(v.utils.getStackExtent(t.data.stackedBarData)),e.push(v.utils.getStackExtent(t.data.stackedAreaData)),e.push(v.utils.getMultiExtent(t.data.lineData));var a=[];a.push(v.utils.getExtent(t.data.barData,!0)),a.push(v.utils.getExtent(t.data.referenceData,!0)),a.push(v.utils.getExtent(t.data.estimateData,!0)),a.push(v.utils.getExtent(t.data.thresholdData,!0)),a.push(v.utils.getExtent(t.data.areaData,!0)),a.push(v.utils.getStackExtent(t.data.stackedBarData,!0)),a.push(v.utils.getStackExtent(t.data.stackedAreaData,!0)),a.push(v.utils.getMultiExtent(t.data.lineData,!0));var r,n=g.max(e);if(t.autoScaleY){var i=(n-(r=g.min(a)))/10;r=Math.max(r-i,0),n+=i}else r=Math.min(g.min(a),0),n=Math.max(n,0);var l=[r,n];return t.domain&&(l=t.domain),t.reverseY&&(l=[l[1],l[0]]),{scaleY:g.scaleLinear().domain(l).range([t.chartHeight,0])}},function(t){return{eventPanel:t.container.select(".events .event-panel").on("mousemove touchstart",function(e){if(!t.dataIsEmpty){var a=g.mouse(this)[0],r=t.stripeScaleX.bandwidth(),n=t.stripeScaleX.domain(),i=n.length,l=Math.min(~~(a/r),i-1),s=n[l],o=b(s,t.data);t.events.call("hover",null,{index:l,timestamp:s,data:o,config:t,event:g.event})}}).on("mouseout",function(e){t.events.call("mouseout",null,{})}).on("click",function(e){t.events.call("click",null,{event:g.event})})}},v.common.axisX,v.common.axisY,function(t){if(!1===t.showStripes)return t.container.select(".stripe-group").selectAll("rect.stripe").remove(),{};var e=t.container.select(".stripe-group").selectAll("rect.stripe").data(t.data.timestamp);return e.enter().append("rect").attr("class","stripe").merge(e).classed("even",function(t,e){return e%2}).attr("x",function(e,a){return t.stripeScaleX(e)||0}).attr("y",function(t){return 0}).attr("width",function(e){return t.stripeScaleX.bandwidth()}).attr("height",function(e){return t.chartHeight}),e.exit().remove(),{}},function(t){var e=t.activeDate&&void 0!==t.activeDate.getTime?t.activeDate.getTime():new Date(t.activeDate).getTime(),a=t.data.timestamp.filter(function(t){return t.getTime()===e}),r=t.container.select(".active-group").selectAll("rect.active").data(a);return r.enter().append("rect").attr("class","active").merge(r).each(function(e){if(!t.dataIsEmpty){var a=b(e,t.data);t.events.call("active",null,{timestamp:e,data:a,config:t,event:g.event})}}).attr("x",function(e,a){return t.stripeScaleX(e)||0}).attr("y",function(t){return 0}).attr("width",function(e){return t.stripeScaleX.bandwidth()}).attr("height",function(e){return t.chartHeight}),r.exit().remove(),{}},function(t){if(!t.data.areaData||!t.data.areaData.length)return t.container.select(".area-group").selectAll("path.area").remove(),{};var e=g.area().defined(function(t){return null!=t.value}).x(function(e){return t.lineScaleX(e.timestamp)}).y0(t.chartHeight).y1(function(e){return t.scaleY(e.value)}),a=t.container.select(".area-group").selectAll("path.area").data([t.data.areaData]);return a.enter().append("path").attr("class",function(t,e){return["area","layer"+e,t[0].id,t[0].className].join(" ")}).merge(a).attr("d",e),a.exit().remove(),{}},function(t){var e=t.container.select(".reference-bar-group").selectAll("rect.reference-bar").data(t.data.referenceData);e.enter().append("rect").merge(e).attr("class",function(t){return["reference-bar",t.id,t.className].join(" ")}).attr("x",function(e,a){return t.referenceScaleX(e.timestamp)||0}).attr("y",function(e){return t.autoScaleY?t.chartHeight-(t.chartHeight-Math.abs(t.scaleY(e.value))):e.value>=0||t.reverseY?t.scaleY(0)-Math.abs(t.scaleY(e.value)-t.scaleY(0)):t.scaleY(0)}).attr("width",function(e){return t.referenceScaleX.bandwidth()}).attr("height",function(e){return t.autoScaleY?t.chartHeight-Math.abs(t.scaleY(e.value)):Math.abs(t.scaleY(e.value)-t.scaleY(0))}),e.exit().remove();var a=t.container.select(".reference-line-group").selectAll("path.reference-top").data(t.data.referenceData);return a.enter().append("path").attr("class","reference-top").merge(a).attr("d",function(e,a){var r=t.referenceScaleX(e.timestamp)||0,n=0;return"M"+[[r,n=e.value>=0||t.reverseY?t.scaleY(0)-Math.abs(t.scaleY(e.value)-t.scaleY(0)):t.scaleY(0)+Math.abs(t.scaleY(e.value)-t.scaleY(0))],[r+t.referenceScaleX.bandwidth(),n]]}),a.exit().remove(),{}},function(t){if(!t.data.stackedBarData||!t.data.stackedBarData.length)return t.container.select(".stacked-bar-group").selectAll("g.stack").remove(),{};var e=t.data.stackedBarData[0].value.map(function(t,e){return"y"+e}),a=[];t.data.stackedBarData.forEach(function(t,e){var r=v.utils.mergeAll({},t);t.value&&t.value.length&&(t.value.forEach(function(t,e){r["y"+e]=t}),a.push(r))});var r=t.container.select(".stacked-bar-group").selectAll("g.stack").data(g.stack().keys(e)(a)),n=r.enter().append("g").attr("class","stack").merge(r).selectAll("rect.stacked-bar").data(function(t,e){return t.forEach(function(e){e.index=t.index}),t});return n.enter().append("rect").attr("class","stacked-bar").merge(n).attr("class",function(t,e,a){var r=t.data.id?t.data.id[t.index]:null,n=t.data.className?t.data.className[t.index]:null;return["stacked-bar","layer"+t.index,r,n].join(" ")}).filter(function(t){return!Number.isNaN(t[0])&&!Number.isNaN(t[1])}).attr("x",function(e){return t.scaleX(e.data.timestamp)}).attr("y",function(e){return t.scaleY(e[1])}).attr("height",function(e){return t.scaleY(e[0])-t.scaleY(e[1])}).attr("width",t.scaleX.bandwidth()),n.exit().remove(),r.exit().remove(),{}},function(t){if(!t.data.stackedAreaData||!t.data.stackedAreaData.length)return t.container.select(".stacked-area-group").selectAll("g.stack-area").remove(),{};var e=t.data.stackedAreaData[0].value.map(function(t,e){return"y"+e}),a=g.area().defined(function(t){return!Number.isNaN(t[0])&&!Number.isNaN(t[1])}).x(function(e){return t.lineScaleX(e.data.timestamp)}).y0(function(e){return t.scaleY(e[0])}).y1(function(e){return t.scaleY(e[1])}),r=[];t.data.stackedAreaData.forEach(function(t,e){var a=v.utils.mergeAll({},t);t.value&&t.value.length&&(t.value.forEach(function(t,e){a["y"+e]=t}),r.push(a))});var n=t.container.select(".stacked-area-group").selectAll("g.stack-area").data(g.stack().keys(e)(r)),i=n.enter().append("g").attr("class","stack-area").merge(n).selectAll("path.stacked-area").data(function(t,e){return t.forEach(function(e){e.index=t.index}),[t]});return i.enter().append("path").merge(i).attr("class",function(t){var e=t[0].data.id?t[0].data.id[t.index]:null,a=t[0].data.className?t[0].data.className[t.index]:null;return["stacked-area","layer"+t.index,e,a].join(" ")}).attr("d",a),i.exit().remove(),n.exit().remove(),{}},function(t){var e=t.container.select(".bar-group").selectAll("rect.bar").data(t.data.barData);return e.enter().append("rect").merge(e).attr("class",function(t){return["bar",t.id,t.className].join(" ")}).attr("x",function(e,a){return t.scaleX(e.timestamp)||0}).attr("y",function(e){return t.autoScaleY?t.chartHeight-(t.chartHeight-Math.abs(t.scaleY(e.value))):e.value>=0||t.reverseY?t.scaleY(0)-Math.abs(t.scaleY(e.value)-t.scaleY(0)):t.scaleY(0)}).attr("width",function(e){return t.scaleX.bandwidth()}).attr("height",function(e){return t.autoScaleY?t.chartHeight-Math.abs(t.scaleY(e.value)):Math.abs(t.scaleY(e.value)-t.scaleY(0))}),e.exit().remove(),{}},function(t){var e=t.container.select(".estimate-bar-group").selectAll("rect.estimate-bar").data(t.data.estimateData);return e.enter().append("rect").merge(e).attr("class",function(t){return["estimate-bar",t.id,t.className].join(" ")}).attr("x",function(e,a){return t.scaleX(e.timestamp)||0}).attr("y",function(e){return t.scaleY(e.value)||0}).attr("width",function(e){return t.scaleX.bandwidth()}).attr("height",function(e){return t.chartHeight-t.scaleY(e.value)||0}),e.exit().remove(),{}},function(t){if(!t.data.lineData.length)return t.container.select(".line-group").selectAll("path.line").remove(),{};var e=g.line().defined(function(t){return null!=t.value}).x(function(e){return t.lineScaleX(e.timestamp)}).y(function(e){return t.scaleY(e.value)}),a=[],r=t.data.lineData[0].value.length;if(void 0===r)a.push(t.data.lineData);else for(var n=0;n<r;n++){var i=t.data.lineData.map(function(t){return{timestamp:t.timestamp,value:t.value[n],id:t.id&&t.id[n],className:t.className&&t.className[n]}});a.push(i)}var l=t.container.select(".line-group").selectAll("path.line").data(a);return l.enter().append("path").style("fill","none").merge(l).attr("class",function(t,e){return["line","layer"+e,t[0].id,t[0].className].join(" ")}).attr("d",e),l.exit().remove(),{}},function(t){if(!t.data.lineData.length)return t.container.select(".dot-group").selectAll(".dot-layer").remove(),{};for(var e=t.data.lineData,a=[],r=e[0].value.length,n=0;n<r;n++){var i=[];e.forEach(function(t,a){var r=Math.max(0,a-1),l=Math.min(e.length-1,a+1),s=a,o=e[r].value[n],c=e[l].value[n],u=t.value[n];(null!==u&&(null===o||null===c)||s===r&&s===l)&&i.push({value:u,timestamp:t.timestamp,layer:n})}),a.push(i)}var l=t.container.select(".dot-group").selectAll(".dot-layer").data(a),s=l.enter().append("g").merge(l).attr("class","dot-layer");l.exit().remove();var o=s.selectAll(".dot").data(function(t,e){return t});return o.enter().append("circle").merge(o).attr("class",function(t,e,a){return["dot","layer"+t.layer].join(" ")}).attr("cx",function(e){return t.lineScaleX(e.timestamp)}).attr("cy",function(e){return t.scaleY(e.value)}).attr("r",2),o.exit().remove(),{}},function(t){var e=t.container.select(".threshold-line-group").selectAll("line.threshold-line").data(t.data.thresholdData);return e.enter().append("line").merge(e).attr("class",function(t){return["threshold-line",t.id,t.className].join(" ")}).attr("x1",0).attr("y1",function(e){return t.scaleY(e.value)||0}).attr("x2",t.chartWidth).attr("y2",function(e){return t.scaleY(e.value)||0}).attr("display",function(t){return t?null:"none"}),e.exit().remove(),{}},v.common.axisComponentY,v.common.labelsRewriterY,v.common.message,v.common.axisComponentX,v.common.axisTitleComponentX,v.common.axisTitleComponentY,v.common.chartTitleComponent),v.multiChart=function(t){var e,a=g.dispatch("hover","click","mouseout","active"),r=~~(1e4*Math.random()),n=v.utils.throttle(function(){e.width=e.parent.clientWidth,s()},200);g.select(window).on("resize."+r,n);var i,l,s=function(){w(e)},o=function(t){return e=v.utils.mergeAll(e,t),s(),this};return i=t,l=a,o(v.utils.mergeAll(i,{events:l})),{on:v.utils.rebind(a),setConfig:o,setData:function(t){var a=t?JSON.parse(JSON.stringify(t)):{};return(e=v.utils.mergeAll({},e)).data=a,s(),this},destroy:function(){g.select(window).on("resize."+r,null),e.parent.innerHTML=null}}},A=H,k=N.d3,D=A.utils.pipeline(function(t){var e=t.parent.querySelector(".datahub-table-chart");e||(e=A.utils.appendHtmlToNode('<div class="datahub-table-chart"><div class="table-container"><div class="header"><div class="row"></div></div><div class="content"></div><div class="footer"><div class="row"></div></div></div><div class="chart-container"><div class="header"><div class="row"></div></div><div class="content"><div class="rows"></div><div class="chart"><svg><g class="panel"><g class="stripes"></g><g class="bars"></g><g class="axis"></g><g class="message-group"></g></g></svg></div></div><div class="footer"><div class="row"></div></div></div></div>',t.parent));var a=!(t.elements&&t.elements.length),r=t.margin||{top:0,bottom:24,right:24,left:24},n=t.rowHeight||48,i=k.select(e),l=i.select(".chart-container").node().clientWidth,s=l-r.left-r.right,o=a?n:t.elements.length*n+r.bottom;return{container:i,width:l,height:o,chartWidth:s,chartHeight:o-r.bottom,rowHeight:n,margin:r,dataIsEmpty:a}},function(t){return t.elements?{elements:t.elements.slice().sort(t.sortFunc)}:{}},function(t){var e=t.container.select(".header .row").selectAll("div.column").data(t.header||[]);return e.enter().append("div").merge(e).attr("class",function(t){return"column "+t.key}).html(function(t){return Array.isArray(t.label)?'<div class="multiline">'+t.label.map(function(t,e){return"<div>"+t+"</div>"}).join("")+"</div>":t.label}),e.exit().remove(),{}},function(t){var e=t.container.select(".table-container .content").selectAll("div.row").data(t.elements||[]),a=e.enter().append("div").merge(e).attr("class","row");e.exit().remove();var r=a.selectAll("div.column").data(function(t){return t});r.enter().append("div").merge(r).attr("class","column").html(function(e){return"number"==typeof e.label?(t.valueFormat||function(t){return Math.floor(100*t)/100})(e.label):Array.isArray(e.label)?'<div class="multiline">'+e.label.map(function(t,e){return"<div>"+t+"</div>"}).join("")+"</div>":null===e.label||void 0===e.label?t.emptyPlaceholder||"":e.label}),r.exit().remove();var n=t.container.select(".chart-container .rows").selectAll("div.row").data(t.elements||[]);return n.enter().append("div").attr("class","row").append("div").attr("class","column"),n.exit().remove(),{}},function(t){var e=t.domain||[0,0];if(!t.domain&&t.elements){var a=k.merge(t.elements).filter(function(e){return e.key===t.valueKey||e.key===t.referenceKey}).map(function(t){return t.value});e=a.length?k.extent(a):[0,0]}e[0]=Math.min(e[0],0);var r=Math.max(Math.abs(e[0]),Math.abs(e[1]));return e=[-r,r],{scaleX:k.scaleLinear().domain(e).range([0,t.chartWidth])}},function(t){return t.container.on("click",function(){t.events.call("click",null,{event:k.event})}),{}},function(t){var e=t.scaleX.ticks(),a=t.container.select(".stripes").selectAll("rect.stripe").data(e);return a.enter().append("rect").attr("class","stripe").merge(a).attr("x",function(a,r){var n=e[Math.max(r-1,0)],i=(t.scaleX(a)-t.scaleX(n))/2;return t.scaleX(a)-i}).attr("y",function(t){return 0}).attr("width",function(a,r){var n=e[Math.max(r-1,0)],i=(t.scaleX(a)-t.scaleX(n))/2;return i=Math.max(i,0)}).attr("height",function(e){return t.chartHeight}),a.exit().remove(),{}},function(t){t.scaleX.ticks();var e=t.container.select(".stripes").selectAll("line.grid").data([0]);return e.enter().append("line").attr("class","grid").merge(e).attr("display",t.dataIsEmpty?"none":"block").attr("x1",function(e){return t.scaleX(0)+.5}).attr("y1",0).attr("x2",function(e){return t.scaleX(0)+.5}).attr("y2",t.chartHeight),e.exit().remove(),{}},function(t){var e=t.axisXFormat||".2s",a=k.axisBottom().scale(t.scaleX).tickFormat(k.format(e));return{axisX:t.container.select(".axis").attr("transform","translate("+[0,t.chartHeight]+")").attr("display",t.dataIsEmpty?"none":"block").call(a)}},function(t){return t.labelsRewriterX?(t.container.selectAll(".axis").selectAll("text").html(function(e,a){return t.labelsRewriterX(e,a,t)}),{}):{}},function(t){var e=t.container.select("svg").attr("width",t.width).attr("height",t.height).select(".panel").attr("transform","translate("+t.margin.left+" 0)").select(".bars").selectAll("g.bar-group").data(t.elements||[]),a=e.enter().append("g").merge(e).attr("class","bar-group").attr("transform",function(e,a){return"translate(0 "+a*t.rowHeight+")"});e.exit().remove();var r=a.selectAll("rect.reference-bar").data(function(e,a){var r=e.filter(function(e){return e.key===t.referenceKey});return[r&&r[0]]});r.enter().append("rect").merge(r).attr("class","reference-bar").attr("width",function(e){return Math.abs(t.scaleX(e.value)-t.scaleX(0))}).attr("height",function(e){return t.rowHeight/2}).attr("x",function(e){return e.value<0?t.scaleX(e.value):t.scaleX(0)}).attr("y",function(e){return t.rowHeight/4}),r.exit().remove();var n=a.selectAll("rect.reference-line").data(function(e,a){var r=e.filter(function(e){return e.key===t.referenceKey});return[r&&r[0]]});n.enter().append("rect").merge(n).attr("class","reference-line").attr("display",function(t){return t.value||0===t.value?"block":"none"}).attr("width",2).attr("height",function(e){return t.rowHeight/2}).attr("x",function(e){var a=2;return e.value>0&&(a*=-1),t.scaleX(e.value)+a}).attr("y",function(e){return t.rowHeight/4}),n.exit().remove();var i=a.selectAll("rect.value-bar").data(function(e,a){var r=e.filter(function(e){return e.key===t.valueKey});return[r&&r[0]]});return i.enter().append("rect").merge(i).attr("class","value-bar").attr("width",function(e){return Math.abs(t.scaleX(e.value)-t.scaleX(0))}).attr("height",function(e){return t.rowHeight/4}).attr("x",function(e){return e.value<0?t.scaleX(e.value):t.scaleX(0)}).attr("y",function(e){return 3*t.rowHeight/8}),i.exit().remove(),{}}),A.tableChart=function(t){var e,a=k.dispatch("click"),r=~~(1e4*Math.random()),n=A.utils.throttle(function(){e.width=e.parent.clientWidth,s()},200);k.select(window).on("resize."+r,n);var i,l,s=function(){D(e)},o=function(t){return e=A.utils.mergeAll(e,t),s(),this};return i=t,l=a,o(A.utils.mergeAll(i,{events:l})),{on:A.utils.rebind(a),setConfig:o,setData:function(t){var a=t?JSON.parse(JSON.stringify(t)):{};return e=A.utils.mergeAll({},e,{data:a}),s(),this},destroy:function(){k.select(window).on("resize."+r,null),e.parent.innerHTML=null}}},function(t,e){function a(a,r){var n=[];return a.dataConverted[0].data.length&&a.dataConverted.forEach(function(i,l){var s=(0,e.bisector(function(t,e){return t.timestamp.getTime()-e.getTime()}).left)(i.data,r),o=i.data[Math.min(s,i.data.length-1)],c=i.data[Math.max(s-1,0)],u=r-c.timestamp>o.timestamp-r?o:c,d=Math.round(a.scaleX(u.timestamp)),m=Math.round(a.scaleY(u.value)),h={event:e.event,posX:d,posY:m};u=t.utils.mergeAll({},u,i.metadata,h),n.push(u)}),n}function r(t,e,a){if(!t.dataConverted[0].data.length)return t.datasetIndex=0;var r,n;t.datasetIndex=a?(r=t.dataConverted[0].data,n=r[r.length-1].timestamp,e[0].timestamp===n&&e[1]?1:0):0;var i,l=t.margin.left+e[t.datasetIndex].posX;if(t.container.select(".tooltip line").attr("y1",0).attr("y2",t.height).attr("x1",l).attr("x2",l).attr("display","block"),!e||!e[0]||void 0===e[0].value||null===e[0].value||t.hide.indexOf("tooltip")>-1)return t.container.select(".tooltip").selectAll("text.tooltip-label").remove(),void t.container.select(".tooltip").selectAll(".tooltip-rect").remove();if(t.hide.indexOf("tooltipDot")>-1)t.container.select(".tooltip").selectAll("circle.dot").remove();else{var s=t.container.select(".tooltip").selectAll("circle.dot").data(e);s.enter().append("circle").merge(s).attr("display","block").attr("class",function(t,e){return["dot",t.id,"layer"+e].join(" ")}).attr("cx",function(e){return e.posX+t.margin.left}).attr("cy",function(e){return e.posY+t.margin.top}).attr("r",2),s.exit().remove()}if(t.hide.indexOf("tooltipLabel")>-1)t.container.select(".tooltip").selectAll("text.tooltip-label").remove(),t.container.select(".tooltip").selectAll(".tooltip-rect").remove();else{var o=t.container.select(".tooltip").selectAll(".tooltip-rect").data(e),c=t.container.select(".tooltip").selectAll("text.tooltip-label").data(e);c.enter().append("text").merge(c).attr("display","block").attr("class",function(t,e){return["tooltip-label",t.id,"layer"+e].join(" ")}).attr("transform",function(e,a){var r=e.posX+t.margin.left,n=e.posY+t.margin.top;return"arrow"===t.chartType&&(n=0),"translate("+[r,n]+")"}).attr("dx",-4).attr("text-anchor","end").text(function(e,a){return t.valueFormatter?t.valueFormatter(e,a):e.value}),t.container.select(".tooltip").selectAll("text.tooltip-label").each(function(t,a){e[a].bb=this.getBBox()});o.enter().insert("rect").merge(o).attr("display","block").attr("width",function(t){return t.bb.width?t.bb.width+4:0}).attr("height",function(t){return t.bb.height?t.bb.height+2:0}).attr("class",function(t,e){return["tooltip-rect",t.id,"layer"+e].join(" ")}).attr("style","fill:black;stroke:#575f6d;stroke-width:1;fill-opacity:0.8;stroke-opacity:0.8").attr("transform",function(e,a){var r=e.posX+t.margin.left-e.bb.width-6,n=e.posY+t.margin.top-e.bb.height+2/1.5;return"arrow"===t.chartType&&(n=0),"translate("+[r,n]+")"}).attr("rx",2),t.container.selectAll(".tooltip *").each(function(t,e){var a=this.parentNode.firstChild;"rect"===this.localName&&this.parentNode.insertBefore(this,a)}),c.exit().remove(),o.exit().remove()}i=1===t.datasetIndex?0:1,t.container.select(".tooltip").selectAll(".layer"+i).remove()}function n(t){t.container.select(".tooltip line").attr("display","none"),t.container.selectAll(".tooltip circle").attr("display","none"),t.container.selectAll(".tooltip .tooltip-label").attr("display","none"),t.container.selectAll(".tooltip .tooltip-rect").attr("display","none")}var i=t.utils.pipeline(function(t){return{margin:t.margin||{top:0,right:0,bottom:10,left:10},hide:t.hide||[],chartType:t.chartType||"line"}},function(a){var r=a.parent.querySelector(".datahub-timeseries-chart");r||(r=t.utils.appendHtmlToNode('<div class="datahub-timeseries-chart"><div class="number-group"></div><div class="chart-group"><svg><g class="panel"><g class="shapes"></g><g class="grid x"></g><g class="axis x"></g><g class="axis y"></g><g class="axis-title x"><text></text></g><g class="axis-title y"><text></text></g><g class="reference"></g></g><g class="tooltip"><line></line></g><g class="message-group"></g><g class="events"><rect class="event-panel"></rect></g></svg></div></div>',a.parent));var n=e.select(r),i=a.width||a.parent.clientWidth,l=a.height||a.parent.clientHeight,s=i-a.margin.left-a.margin.right,o=l-a.margin.top-a.margin.bottom;return n.select("svg").attr("width",i).attr("height",l),n.select(".panel").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),n.select(".events rect").attr("width",i).attr("height",l).attr("opacity",0),{container:n,width:i,height:l,chartWidth:s,chartHeight:o}},function(t){var e=t.data||[],a=[],r=[];e.forEach(function(t){t.data.forEach(function(t,e,n){n[e].timestamp=new Date(function(t){var e=(t="object"==typeof t?t.toString():t).indexOf("+");if(-1===e)return t;var a=t.slice(e);return t.slice(0,e)+a.slice(0,3)+":"+a.slice(3)}(t.timestamp)),a.push(t.value),r.push(n[e].timestamp)})});var n=!!a.length&&!a.filter(function(t){return null!==t}).length;return{dataConverted:e,dataValues:a,dataTimestamps:r,dataIsEmpty:!e.length,dataIsAllNulls:n}},function(t){return t.dataIsEmpty?{}:{scaleX:e.scaleTime().domain(e.extent(t.dataTimestamps)).range([0,t.chartWidth])}},function(t){return t.dataIsEmpty?{}:(t.domain?(a=t.domain[0],r=t.domain[1]):(a=e.min(t.dataValues),r=e.max(t.dataValues),"number"==typeof t.reference&&(r=Math.max(t.reference,r),a=Math.min(t.reference,a)),a===r&&(a-=a/20,r+=r/10)),{scaleY:e.scaleLinear().domain([a,r]).range([t.chartHeight,0])});var a,r},function(t){if(t.dataIsEmpty)return{};var a=t.xAxisOnTop?"axisTop":"axisBottom";return{axisX:e[a]().scale(t.scaleX).ticks(t.xTicks||null).tickFormat(e.utcFormat(t.axisXFormat||"%H:%M"))}},function(t){return t.dataIsEmpty?{}:{axisY:e.axisLeft().scale(t.scaleY).ticks(t.yTicks||6).tickFormat(function(a){return t.axisYFormat?e.format(t.axisYFormat)(a):a<1?e.format(".2")(a):e.format(".2s")(a)}).tickPadding(10)}},function(t){if(t.dataIsEmpty||t.hide.indexOf("xAxis")>-1)return{};t.container.select(".axis.x").attr("transform","translate("+[0,t.chartHeight]+")").call(t.axisX);return{}},function(t){if(t.dataIsEmpty||t.hide.indexOf("xGrid")>-1||t.axisOnly)return{};t.container.select(".grid.x").attr("transform","translate("+[0,t.chartHeight]+")").call(t.axisX.tickSize(-t.chartHeight).tickFormat(""));return{}},function(t){if(t.dataIsEmpty||t.axisOnly||"line"!==t.chartType&&"area"!==t.chartType)return t.container.select(".line-group").selectAll("path.line").remove(),{};var a,r=t.chartType||"line";a="area"===r?e.area().defined(function(t){return null!=t.value}).x(function(e){return t.scaleX(e.timestamp)}).y0(function(e){return t.scaleY(0)}).y1(function(e){return t.scaleY(e.value)}):e.line().defined(function(t){return null!=t.value}).x(function(e){return t.scaleX(e.timestamp)}).y(function(e){return t.scaleY(e.value)});var n=t.container.select(".shapes").selectAll(".shape-group").data(t.dataConverted),i=n.enter().append("g").attr("class","shape-group").merge(n).selectAll("path.shape").data(function(t,e){return t.layer=e,[t]});return i.enter().append("path").merge(i).attr("class",function(t,e,a,n){return["shape",t.metadata.id,"layer"+t.layer,r].join(" ")}).attr("d",function(t){return a(t.data)}),i.exit().remove(),n.exit().remove(),{}},function(t){if(t.dataIsEmpty||t.axisOnly||"arrow"!==t.chartType)return t.container.select(".shapes").selectAll("path.arrow").remove(),{};var e=t.container.select(".shapes").selectAll("path.arrow").data(t.dataConverted[0].data.filter(function(e,a){return a%(t.arrowSkip||3)==0}));return e.enter().append("path").attr("class",function(t){return"arrow"}).merge(e).attr("d","M6 0L12 10L8 10L8 24L4 24L4 10L0 10Z").attr("transform",function(e){return"translate("+t.scaleX(e.timestamp)+", 0) scale(0.5) rotate("+e.value+", 6, 12)"}),e.exit().remove(),{}},function(t){if(t.dataIsEmpty||t.axisOnly||"step"!==t.chartType)return t.container.select(".step-group").selectAll("path.shape").remove(),{};var a=t.dataConverted[0].metadata.id,r=t.stepRange||3,n=[],i=t.dataConverted[0].data;i.forEach(function(e,a){var r=Math.max(a-1,0);n.push([t.scaleX(e.timestamp),t.scaleY(i[r].value)]),n.push([t.scaleX(e.timestamp),t.scaleY(e.value)])});var l=[],s=[];t.dataConverted[0].data.forEach(function(e,a){var n=Math.max(a-1,0);l.push([t.scaleX(e.timestamp),t.scaleY(i[n].value+r)]),l.push([t.scaleX(e.timestamp),t.scaleY(e.value+r)]),s.push([t.scaleX(e.timestamp),t.scaleY(i[n].value-r)]),s.push([t.scaleX(e.timestamp),t.scaleY(e.value-r)])});var o=l.concat(s.reverse()),c=(e.line().defined(function(t){return null!=t.value}).x(function(e){return t.scaleX(e.timestamp)}).y(function(e){return t.scaleY(e.value)}),t.container.select(".shapes").selectAll(".step-group").data([n,o])),u=c.enter().append("g").attr("class","step-group").merge(c).selectAll("path.shape").data(function(t,e){return t.layer=e,[t]});return u.enter().append("path").merge(u).attr("class",function(e,r,n,i){return["shape",a,"layer"+e.layer,t.chartType].join(" ")}).attr("d",function(t,e){return"M"+t.join()}),u.exit().remove(),c.exit().remove(),{}},t.common.message,function(t){if(t.dataIsEmpty||t.hide.indexOf("yAxis")>-1||t.axisOnly)return{};t.container.select(".axis.y").call(t.axisY);return{}},function(t){if(t.dataIsEmpty||"number"!=typeof t.reference)return t.container.selectAll("path.reference").remove(),{};var e=t.scaleY(t.reference),a="M"+[[0,e],[t.chartWidth,e]].join("L"),r=t.container.select(".reference").selectAll("path").data([0]);return r.enter().append("path").attr("class","reference").style("fill","none").merge(r).attr("d",a),r.exit().remove(),{}},function(t){return{eventPanel:t.container.select(".events .event-panel").on("mousemove touchstart",function(r){if(!t.dataIsEmpty){var n=e.mouse(this)[0]-t.margin.left,i=t.scaleX.invert(n),l=a(t,i);t.events.call("hover",null,l)}}).on("mouseout",function(e){n(t),t.container.selectAll(".axis-title.x text").text(null),t.events.call("mouseout",null,{})}).on("click",function(a){t.events.call("click",null,{event:e.event})})}},function(t){if(void 0!==t.tooltipTimestamp)if(null===t.tooltipTimestamp)n(t),t.events.call("tooltipChange",null,{});else{var e=a(t,t.tooltipTimestamp);r(t,e),t.events.call("tooltipChange",null,{timestamp:e[0].timestamp,data:e})}if(t.dataIsEmpty||t.axisOnly||t.hide.indexOf("tooltip")>-1)return n(t),{};t.events.on("hover.tooltip",function(e){r(t,e,"hover")})},function(t){if(t.dataIsEmpty||t.axisOnly||t.hide.indexOf("xTitle")>-1)return{};var a=t.xTitleFormat||e.utcFormat("%X"),r=t.container.select(".axis-title.x"),n=r.select("text");return t.events.on("hover.title",function(e){var i=e[t.datasetIndex].timestamp;r.attr("transform","translate("+[t.chartWidth,t.chartHeight]+")"),n.text(a(i)).attr("dy",-8).attr("text-anchor","end")}),{}},function(t){return t.axisOnly||t.hide.indexOf("yTitle")>-1?{}:(t.container.select(".axis-title.y text").text(t.yAxisTitle||"").attr("dx","0.5em").attr("dy","1em"),{})});t.timeseries=function(a){var r,n=e.dispatch("hover","click","mouseout","tooltipChange"),l=~~(1e4*Math.random()),s=t.utils.throttle(function(){r.width=r.parent.clientWidth,u()},200);a.resizeOff||e.select(window).on("resize."+l,s);var o,c,u=function(){i(r)},d=function(e){return r=t.utils.mergeAll({},r,e),u(),this};return o=a,c=n,d(t.utils.mergeAll({},o,{events:c})),{on:t.utils.rebind(n),setConfig:d,setData:function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return r=t.utils.mergeAll({},r,{data:a}),u(),this},destroy:function(){e.select(window).on("resize."+l,null),r.parent.innerHTML=null}}}}(H,N.d3),T=H,M=N.d3,S=T.utils.pipeline(function(t){var e=t.parent.querySelector(".datahub-vertical-chart");e||(e=T.utils.appendHtmlToNode('<div class="datahub-vertical-chart"><div class="header"></div><div class="chart-container"><div class="chart-wrapper"><svg><g class="panel"><g class="reference-bars"></g><g class="bars"></g><g class="axis"></g></g></svg></div></div><div class="number-container"></div></div>',t.parent));var a=!(t.elements&&t.elements.length),r=M.select(e);return{container:r,chartWidth:r.select(".chart-container").node().clientWidth,chartHeight:a?0:26*t.elements.length,rowHeight:26,dataIsEmpty:a,refernceValue:100}},function(t){return t.container.select(".header").html(t.title),{}},function(t){var e=t.container.select(".number-container").selectAll(".number").data(t.elements||[]),a=e.enter().append("div").merge(e).attr("class",function(t,e){return"number number"+e});e.exit().remove();var r=a.selectAll(".label").data(function(t){return[t]});r.enter().append("div").attr("class","label").merge(r).html(function(t){return t.label}),r.exit().remove();var n=a.selectAll(".value").data(function(t){return[t]});return n.enter().append("div").attr("class","value").merge(n).html(function(e){return Math.round(e.value)+" "+t.unit}),n.exit().remove(),{}},function(t){return{scaleX:M.scaleLinear().domain([0,100]).range([0,t.referenceBarSize])}},function(t){var e=t.container.select(".axis").selectAll(".vertical").data([0]);return e.enter().append("line").attr("class","vertical").merge(e).attr("x1",t.chartWidth/2).attr("y1",0).attr("x2",t.chartWidth/2).attr("y2",t.chartHeight),e.exit().remove(),{}},function(t){var e=t.container.select("svg").attr("width",t.chartWidth).attr("height",t.chartHeight).select(".panel"),a=t.rowHeight,r=a-2,n=r/2,i=e.select(".bars").selectAll(".bar").data(t.elements||[]);i.enter().append("rect").merge(i).attr("class",function(t,e){return["bar",t.label.toLowerCase(),"bar"+e].join(" ")}).attr("x",function(e){var a=t.scaleX(e.value);return a<0?t.chartWidth/2-Math.abs(a):t.chartWidth/2}).attr("y",function(t,e){return a*e+(a-n)/2}).attr("width",function(e){if(e.value)return Math.abs(t.scaleX(e.value))}).attr("height",n),i.exit().remove();var l=e.select(".reference-bars").selectAll(".bar").data(t.elements||[]);l.enter().append("rect").attr("class","bar").merge(l).attr("x",t.chartWidth/2).attr("y",function(t,e){return a*e+(a-r)/2}).attr("width",function(e,a){return t.referenceBarSize}).attr("height",r),l.exit().remove();var s=e.select(".reference-bars").selectAll(".line").data(t.elements||[]);return s.enter().append("line").attr("class","line").merge(s).attr("x1",t.chartWidth/2+t.referenceBarSize).attr("y1",function(t,e){return a*e+(a-r)/2}).attr("x2",t.chartWidth/2+t.referenceBarSize).attr("y2",function(t,e){return a*e+(a-r)/2+r}),s.exit().remove(),{}}),T.verticalChart=function(t){var e,a=M.dispatch("barHover"),r=~~(1e4*Math.random()),n=T.utils.throttle(function(){e.width=e.parent.clientWidth,s()},200);M.select(window).on("resize."+r,n);var i,l,s=function(){S(e)},o=function(t){return e=T.utils.mergeAll(e,t),s(),this};return i=t,l=a,o(T.utils.mergeAll(i,{events:l})),{on:T.utils.rebind(a),setConfig:o,destroy:function(){M.select(window).on("resize."+r,null),e.parent.innerHTML=null}}},Y=H,X=N.d3,C=Y.utils.pipeline(function(t){var e=t.parent.querySelector(".datahub-waterfall-chart");e||(e=Y.utils.appendHtmlToNode('<div class="datahub-waterfall-chart"><div class="chart-container"><svg><g class="panel"><g class="bars"></g><g class="connectors"></g></g></svg></div><div class="number-container"></div></div>',t.parent));var a=!(t.elements&&t.elements.length),r=!(!a&&t.elements[0].value),n=X.select(e),i=n.select(".chart-container");return{container:n,chartWidth:t.width||i.node().clientWidth,chartHeight:t.height||i.node().clientHeight||300,dataIsEmpty:r,infoIsEmpty:a,elements:t.elements||[],isConnected:[1,3],isNegative:[1]}},function(t){return{scaleX:X.scaleBand().domain(X.range(t.elements.length)).rangeRound([0,t.chartWidth]).paddingInner(.4).paddingOuter(.2)}},function(t){var e=t.elements.map(function(t){return t.value});return{scaleY:X.scaleLinear().domain([0,X.max(e)]).range([0,t.chartHeight])}},function(t){var e=t.container.select("svg").attr("width",t.chartWidth).attr("height",t.chartHeight).select(".panel");if(t.dataIsEmpty)return e.select(".bars").selectAll(".bar").remove(),{};var a=e.select(".bars").selectAll(".bar").data(t.elements);return a.enter().append("rect").merge(a).attr("class",function(t,e){return["bar",t.label.toLowerCase(),t.key,"bar"+e].join(" ")}).attr("x",function(e,a){return t.scaleX(a)}).attr("y",function(e,a){if(t.isConnected.indexOf(a)>-1){var r=Math.max(0,a-1),n=t.elements[r];return t.isNegative.indexOf(a)>-1?t.chartHeight-t.scaleY(Math.abs(n.value)):t.chartHeight-t.scaleY(Math.abs(n.value))-t.scaleY(Math.abs(e.value))}return t.chartHeight-t.scaleY(Math.abs(e.value))}).attr("width",function(e){if(e.value)return t.scaleX.bandwidth()}).attr("height",function(e){return t.scaleY(Math.abs(e.value))}),a.exit().remove(),{}},function(t){return t.dataIsEmpty?(t.container.select(".connectors").selectAll(".connector").remove(),{}):((e=t.container.select(".connectors").selectAll(".connector").data(t.elements)).enter().append("line").attr("class","connector").merge(e).attr("x1",function(e,a){return t.scaleX(a)}).attr("y1",function(e,a){if(t.isConnected.indexOf(a)>-1){var r=Math.max(0,a-1),n=t.elements[r];return t.isNegative.indexOf(a)>-1?t.scaleY(Math.abs(e.value)):t.chartHeight-t.scaleY(Math.abs(n.value))-t.scaleY(Math.abs(e.value))}return t.chartHeight-t.scaleY(Math.abs(e.value))}).attr("x2",function(e,a){return t.scaleX(Math.min(a+1,t.elements.length-1))}).attr("y2",function(e,a){if(t.isConnected.indexOf(a)>-1){var r=Math.max(0,a-1),n=t.elements[r];return t.isNegative.indexOf(a)>-1?t.chartHeight-t.scaleY(Math.abs(n.value))+t.scaleY(Math.abs(e.value)):t.chartHeight-t.scaleY(Math.abs(n.value))-t.scaleY(Math.abs(e.value))}return t.chartHeight-t.scaleY(Math.abs(e.value))}),e.exit().remove(),(e=t.container.select(".connectors").selectAll(".base").data([0])).enter().append("line").attr("class","base").merge(e).attr("x1",t.scaleX(0)).attr("y1",t.chartHeight).attr("x2",t.scaleX(Math.max(t.elements.length-1,0))+t.scaleX.bandwidth()||0).attr("y2",t.chartHeight),e.exit().remove(),{});var e},function(t){var e=t.container.select(".number-container").selectAll(".number").data(t.elements),a=e.enter().append("div").merge(e).attr("class",function(t,e){return"number number"+e});e.exit().remove();var r=a.selectAll(".label").data(function(t){return[t]});r.enter().append("div").attr("class","label").merge(r).html(function(t){return t.label}),r.exit().remove();var n=a.selectAll(".value").data(function(t){return[t]});return n.enter().append("div").attr("class","value").merge(n).html(function(t){return void 0===t.value?'<div class="error">(Data Unavailable)</div>':Math.round(t.value)}),n.exit().remove(),{}}),Y.waterfallChart=function(t){var e,a=X.dispatch("barHover"),r=~~(1e4*Math.random()),n=Y.utils.throttle(function(){e.width=e.parent.clientWidth,s()},200);t.resizeOff||X.select(window).on("resize."+r,n);var i,l,s=function(){C(e)},o=function(t){return e=Y.utils.mergeAll(e,t),s(),this};return i=t,l=a,o(Y.utils.mergeAll(i,{events:l})),{on:Y.utils.rebind(a),setConfig:o,setData:function(t){var a=t?JSON.parse(JSON.stringify(t)):{};return e=Y.utils.mergeAll({},e,{data:a}),s(),this},destroy:function(){X.select(window).on("resize."+r,null),e.parent.innerHTML=null}}},function(t,e){function a(t,a,r){new Date(t).getTime();var n,i,l=e.bisector(function(t,e){return new Date(t.timestamp).getTime()-new Date(e).getTime()}).left,s={},o=0;for(var c in a)if(c===r)for(var u in a[c])["topAxis","bottomAxis"].indexOf(u)>-1||(o=l(n=a[c][u].data,t),s[c]||(s[c]={}),(i=n[o]).metadata=a[c][u].metadata,s[c][u]=i);return s}function r(t,e,a,r,n){for(var i in t)if(i===e)for(var l in t[i])l!==a&&t[i][l]&&t[i][l].setConfig({tooltipTimestamp:r});else for(var l in t[i])t[i][l].setConfig({tooltipTimestamp:null});var s;(s=r)&&n.events.call("hover",null,{timestamp:s})}var n=t.utils.pipeline(function(a){var r=a.parent.querySelector(".datahub-weather-chart");r||(r=t.utils.appendHtmlToNode('<div class="datahub-weather-chart"><div class="chart-row topAxis"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row wind"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row windDirection"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row wave"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row tide"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row bottomAxis"><div class="historical"></div><div class="forecast"></div></div></div>',a.parent));var n=!a.data;return{container:e.select(r),chartWidth:a.width||r.clientWidth,chartHeight:a.height||r.clientHeight||300,dataIsEmpty:n}},function(t){var a={xTicks:t.historicalXTicks||e.utcHour.every(12),resolution:"minute",axisXFormat:t.historicalXFormat||"%H:%M",axisYFormat:".0f",domain:[0,50],chartType:"area",yTicks:3,height:80,width:t.chartWidth/2,valueFormatter:function(t,e){return Math.round(100*t.value)/100},hide:["xTitle","yTitle","xAxis","tooltipLabel"],margin:{top:10,right:4,bottom:10,left:26}},r=H.utils.mergeAll({},a,{xTicks:t.forecastXTicks||e.utcHour.every(12),axisXFormat:t.forecastXFormat||"%H:%M",resolution:"hour",hide:["xAxis","yAxis","yTitle","xTitle","tooltipLabel"],margin:{top:10,right:4,bottom:10,left:26}}),n={hide:["xAxis","yAxis","xTitle","yTitle","tooltipDot","tooltipLabel"],chartType:"arrow",height:20,arrowSkip:t.historicalArrowSkip||3,margin:{top:0,right:4,bottom:0,left:26}},i=H.utils.mergeAll({},a,n),l=H.utils.mergeAll({},r,n,{arrowSkip:t.forecastArrowSkip||6,margin:{top:0,right:4,bottom:0,left:26}}),s={axisOnly:!0,xAxisOnTop:!0,hide:["yAxis","yTitle","tooltipLabel"],height:20,margin:{top:20,right:4,bottom:0,left:26}},o=H.utils.mergeAll({},a,s),c=H.utils.mergeAll({},r,s,{margin:{top:20,right:4,bottom:0,left:26}});return{chartConfig:{historical:{wind:a,windDirection:i,wave:a,tide:a,bottomAxis:H.utils.mergeAll({},a,s,{margin:{top:0,right:4,bottom:20,left:26},xAxisOnTop:!1}),topAxis:o},forecast:{wind:r,windDirection:l,wave:r,tide:r,bottomAxis:H.utils.mergeAll({},r,s,{margin:{top:0,right:4,bottom:20,left:26},xAxisOnTop:!1}),topAxis:c}}}},function(t){return{dataConverted:t.data}},function(t){var e={historical:{wind:null,windDirection:null,wave:null,tide:null,bottomAxis:null,topAxis:null},forecast:{wind:null,windDirection:null,wave:null,tide:null,bottomAxis:null,topAxis:null}};for(var n in e)for(var i in e[n])e[n][i]=H.timeseries({parent:t.container.select("."+i+" ."+n).node(),resizeOff:t.resizeOff||!1}).setConfig(t.chartConfig[n][i]).on("hover",function(){var l=n,s=i;return function(n){if(n[0]){r(e,l,s,n[0].timestamp,t);var i=a(n[0].timestamp,t.dataConverted,l);t.events.call("tooltipChange",null,{data:i,timestamp:n[0].timestamp,info:n,config:t})}}}()).on("mouseout",function(){var n=new Date(t.dataConverted?t.dataConverted.historical.wind.data.slice(-1)[0].timestamp:Date.now());r(e,"historical",null,n,t),t.events.call("mouseout",null,{});var i=a(n,t.dataConverted,"historical");t.events.call("tooltipChange",null,{data:i,timestamp:n,config:t})}),t.domain&&e[n][i].setConfig({domain:t.domain[i]}),t.dataConverted&&e[n][i].setData([t.dataConverted[n][i]]);if(t.dataConverted){var l=new Date(t.dataConverted.historical.wind.data.slice(-1)[0].timestamp);r(e,"historical",null,l,t);var s=a(l,t.dataConverted,"historical");t.events.call("tooltipChange",null,{data:s,timestamp:l,config:t})}return{charts:e}});t.weatherChart=function(a){var r,i=e.dispatch("hover","tooltipChange","mouseout"),l=~~(1e4*Math.random()),s=t.utils.throttle(function(){r.width=r.parent.clientWidth,u()},200);a.resizeOff||e.select(window).on("resize."+l,s);var o,c,u=function(){n(r)},d=function(e){return r=t.utils.mergeAll(r,e),u(),this};return o=a,c=i,d(t.utils.mergeAll(o,{events:c})),{on:t.utils.rebind(i),setConfig:d,setData:function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return r=t.utils.mergeAll({},r,{data:a}),u(),this},destroy:function(){e.select(window).on("resize."+l,null),r.parent.innerHTML=null}}}}(H,N.d3),"object"==typeof module&&module.exports&&(module.exports=t)}("undefined"==typeof datahub?datahub={}:datahub);