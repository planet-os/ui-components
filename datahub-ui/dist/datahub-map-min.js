!function(e,t){var n=e="object"==typeof e?e:{},a="object"==typeof t?t:window;if("object"==typeof module&&module.exports){a.d3=require("d3");try{a.colorBrewer=require("d3-scale-chromatic")}catch(r){a.colorBrewer=null}try{a.leaflet=require("leaflet")}catch(r){a.leaflet=null}}else a.d3=a.d3,a.colorBrewer=a.d3,a.leaflet=a.L;!function(e){var t=function(e,n){for(var a in n)n[a]&&n[a].constructor==Object&&e[a]?t(e[a],n[a]):e[a]=n[a]},n=function(e,t){for(var n=Object(e),a=1;a<arguments.length;a++){var r=arguments[a];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},a=function(e,t){for(;t.lastChild;)t.removeChild(t.lastChild);return r(e,t)},r=function(e,t){return t.appendChild(document.importNode((new DOMParser).parseFromString(e,"text/html").body.childNodes[0],!0))},o=function(e,t){var n=t.parentNode,a=t.cloneNode(!1);return n.removeChild(t),n.appendChild(a),i(e,a)},i=function(e,t){return t.appendChild(document.importNode((new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">'+e+"</svg>","application/xml").documentElement.firstChild,!0))},l=function(e,t){var n;return function(){return e&&(n=e.apply(t||this,arguments),e=null),n}},s=function(e,t){var n=!1,a=null;return function(){var r=this;n||(n=!0,clearTimeout(a),a=setTimeout(function(){n=!1,e.apply(r,arguments)},t))}},u=function(e,t){var n,a,r,o,i=[],l=[],s=Number.MAX_VALUE,u=Number.MIN_VALUE,c={};for(r=0;r<e.length;r++)for(n=e[r],o=0;o<n.length;o++)a=t?t(n[o]):n[o],i.push(a),c.hasOwnProperty(a)||null===a||(c[a]=1,a>u&&(u=a),s>a&&(s=a));return l=Object.keys(c).map(function(e,t){return+e}),{flattened:i,uniques:l,max:u,min:s}},c=function(e,t){return u(e,t).uniques},d=function(e,t){return u(e,t).flattened},m=function(e,t,n){for(var a,r=0,o=e.length-1;o>r;)a=r+o>>1,n&&t>=e[a]||!n&&t<e[a]?o=a:r=a+1;return r},g=function(e,t){return m(e,t,!0)},p=function(e){var t,n=0,a=e.length;for(t=0;a>t;t++)e[t]>n&&(n=e[t]);return n},f=function(e){var t,n=1/0,a=e.length;for(t=0;a>t;t++)e[t]<n&&(n=e[t]);return n},h=function(e){return e.slice(4).slice(0,-1).split(",").map(function(e,t){return parseInt(e)})},v=function(){var e=arguments,t=this;return function(n){for(var a=0;a<e.length;a++){var r=e[a].call(this,n);n=t.mergeAll(n,r)}return n}},y=function(e,t){for(var n in t)n in e&&(e[n]=t[n])},b=function(e){return function(){return e.on.apply(e,arguments),this}},x=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},w=function(e,t){var n=t?"min":"max";return e?d3[n](e.map(function(e){return e.value})):null},S=function(e,t){var n=t?"min":"max";if(e&&e.length){var a=e.map(function(e){return d3.sum(e.value)});return d3[n](a)}return null},C=function(e,t){var n=t?"min":"max";if(e&&e.length){var a=e.map(function(e,t){return e.value});return a[0].length&&(a=d3.merge(a)),d3[n](a)}return null};e.utils={merge:t,mergeAll:n,htmlToNode:a,appendHtmlToNode:r,svgToNode:o,appendSvgToNode:i,once:l,throttle:s,arrayStats:u,arrayUniques:c,arrayFlatten:d,bisection:m,bisectionReversed:g,findMax:p,findMin:f,parseRGB:h,pipeline:v,override:y,rebind:b,capitalize:x,getExtent:w,getStackExtent:S,getMultiExtent:C}}(n),!function(e,t){function a(e){if(e)return!0;throw"You need to set an API key using `datahub.data.setApiKey(API_KEY)`. You can get yours at http://data.planetos.com/"}var r={currentBaseURI:"https://data.planetos.com/",baseURI:"https://api.planetos.com/v1a/",datasetsEndpoint:"https://api.planetos.com/v1/datasets/",apiKey:null},o=function(e){return r.apiKey=e,this},i=function(e){return r=n.utils.mergeAll(r,e),this},l=function(){return{type:"Feature",properties:{name:""},geometry:{type:"LineString",coordinates:[[-170,80],[170,80],[170,-80],[-170,-80],[-170,80]]}}},s=function(){var e=g(50,function(e,t){return{coordinates:[360*Math.random()-180,180*Math.random()-90],id:"random-point-"+t}});return c(e)},u=function(e){return Math.random().toString(36).substring(4,e+4||8)},c=function(e){return{type:"FeatureCollection",features:e.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:{id:e.id}}})}},d=function(e){var t="https://cdn.rawgit.com/johan/world.geo.json/master/countries.geo.json";y(t,function(t,n){e(n)})},m=function(){var t={lon:g(360,function(e,t){return t-180}),lat:g(180,function(e,t){return 180-t-90}),values:g(180,function(e,t){return g(360,function(e,t){return~~(100*Math.random())})})};return t.uniqueValues=e.utils.arrayUniques(t.values),t},g=function(e,t){var n=t||function(e,t){return 0};return Array.apply(null,Array(e)).map(n)},p=function(e){var e=e||{},t={count:e.count||12,layerCount:e.layerCount||1,timeStart:e.timeStart||"2016-01-01",timeIncrement:e.timeIncrement||"month",step:e.step||1,min:e.min||0,max:e.max||100},n=~~(Math.random()*(t.max-t.min))+t.min,a=g(t.count,function(){return g(t.layerCount,function(e){return n+=(2*Math.random()-1)*((t.max-t.min)/10),n=Math.max(n,t.min)})}),r=h(t),o=r.map(function(e,t){return{timestamp:e,value:a[t],id:a[t].map(function(e){return~~(1e3*Math.random())}),className:a[t].map(function(e){return Math.random().toString(36).substring(4,8)})}});return o},f=function(e){var e=e||{},t={count:e.count||12,layerCount:e.layerCount||1,timeStart:e.timeStart||"2016-01-01",timeIncrement:e.timeIncrement||"month",step:e.step||1,min:e.min||0,max:e.max||100},n=~~(Math.random()*(t.max-t.min))+t.min,a=g(t.layerCount,function(){var e={},a=h(t);return e.data=g(t.count,function(e,r){return n+=(2*Math.random()-1)*((t.max-t.min)/10),n=Math.max(n,t.min),n=Math.min(n,t.max),{value:n,timestamp:a[r]}}),e.metadata={id:u(8)},e});return a},h=function(n){var n=n||{},a={count:n.count||12,layerCount:n.layerCount||1,timeStart:n.timeStart||"2016-01-01",timeIncrement:n.timeIncrement||"month",step:n.step||1,min:n.min||0,max:n.max||100},r="utc"+e.utils.capitalize(a.timeIncrement)||"utcHour",o=t[r],i=t[r+"s"],l=a.timeStart?new Date(a.timeStart):new Date,s=o.offset(l,a.count*a.step),u=i(l,s,a.step),c=u.map(function(e,n){return t.isoFormat(e)});return c},v=function(){var e={layerCount:1,count:10,timeIncrement:"minute",min:0,max:50},t=n.utils.mergeAll({},e,{layerCount:1,count:100,timeIncrement:"hour"}),a={historical:{wind:n.data.generateTimeSeriesSplit(e)[0],windDirection:n.data.generateTimeSeriesSplit(e)[0],wave:n.data.generateTimeSeriesSplit(e)[0],tide:n.data.generateTimeSeriesSplit(e)[0],bottomAxis:n.data.generateTimeSeriesSplit(e)[0],topAxis:n.data.generateTimeSeriesSplit(e)[0]},forecast:{wind:n.data.generateTimeSeriesSplit(t)[0],windDirection:n.data.generateTimeSeriesSplit(t)[0],wave:n.data.generateTimeSeriesSplit(t)[0],tide:n.data.generateTimeSeriesSplit(t)[0],bottomAxis:n.data.generateTimeSeriesSplit(t)[0],topAxis:n.data.generateTimeSeriesSplit(t)[0]}};return a},y=function(e,t){var n="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.open("get",e,!0),n.onreadystatechange=function(){var e,a;4==n.readyState&&(e=n.status,200==e?(a=JSON.parse(n.responseText),t(null,a)):t(e))},n.send()},b=function(e,t){a(r.apiKey);var n=r.baseURI+"/datasets/"+e+"?apikey="+r.apiKey;return console.log("get dataset details",n),y(n,function(e,n){if(void 0===n)return console.log("Can not render dataset because of API error",e),!1;var a=n.FeatureType||"timeseries",r="grid"===a.toLowerCase().trim()?"raster":"timeseries";console.log("Data type:",r,n.ProductType,n.FeatureType,n),t({datasetInfo:n,dataType:r,productType:n.ProductType})}),this},x=function(e,t,n){a(r.apiKey);var o=r.baseURI+"/datasets/"+e+"/variables?apikey="+r.apiKey;return console.log("query variables",o),y(o,function(a,r){var o,i=r[e],l=t;l&&(o=i.filter(function(e){return e.name===l})[0]);var s=o||i[0];n({variables:i,defaultVariable:s})}),this},w=function(e,t,n){a(r.apiKey);var o=r.baseURI+"/datasets/"+e+"/variables/"+encodeURIComponent(t)+"/timestamps?apikey="+r.apiKey;return console.log("query timestamps",o),y(o,function(e,t){if(e)return void console.log("Server error",e);var a=t.map(function(e){return new Date(parseInt(e))});n({timestamps:a})}),this},S=function(t,n,o,i){a(r.apiKey);var l=r.baseURI+"/datasets/"+t+"/variables/"+encodeURIComponent(n);return o&&(l+="/timestamps/"+o),l+="/sample_data",l+="?apikey="+r.apiKey,console.log("query dataset",l),y(l,function(a,o){if(a)return void console.log("Server error",a);o.values=o.values.map(function(e,t){return e.map(function(e){return-999===e?null:e})}),o.uniqueValues=e.utils.arrayUniques(o.values).sort();var s=r.currentBaseURI+"/datasets/"+t+"?variable="+n;i({json:o,uri:l,datahubLink:s})}),this},C=function(e,t){a(r.apiKey);var n=r.datasetsEndpoint+e+"/stations?apikey="+r.apiKey;return console.log("get stations",n),y(n,function(e,n){if(e)return void console.log("Server error",e);var a=[];for(var r in n.station){var o=n.station[r];void 0!==o.SpatialExtent&&a.push({id:r,coordinates:o.SpatialExtent.coordinates})}t({stations:a,defaultStation:a[0]})}),this},M=function(e,t,n,o,i){a(r.apiKey);var l=500,s=r.datasetsEndpoint+e+"/stations/"+t+"?apikey="+r.apiKey+"&verbose=true&count="+l;return o||(s+="&time_order=desc"),console.log("station variable",s),y(s,function(t,a){if(t)return void console.log("Server error",t);console.log("Point API data",a,s);var o,l,u={},c=[],d=a.metadata.contexts;for(var m in d){if(o=d[m].dataVariables,d[m].axes&&Object.keys(d[m].axes)){var g=Object.keys(d[m].axes).map(function(e,t){return e.toLowerCase().trim()});g.indexOf("time")>-1&&(c=c.concat(Object.keys(o)))}for(var p in o)l=o[p],l.key=p,u[p]=l}var f={};a.entries.forEach(function(e){for(var t in e.data)f[t]||(f[t]={values:[],timestamps:[]}),f[t].values.push(e.data[t]),f[t].timestamps.push(new Date(e.axes.time))});var h=[];for(var v in u)h.push(u[v]);var y=r.currentBaseURI+"/datasets/"+e+"?variable="+n;i({datasets:f,variablesMetadata:u,variables:h,datahubLink:y,variableData:f[n],variableMetadata:u[n],timeVariableIDs:c})}),this},k=function(e,t,n,o,i){a(r.apiKey);var l=r.baseURI+"/datasets/"+e+"/variables/"+encodeURIComponent(t);return n&&(l+="/timestamps/"+n),l+="/image",l+="?width="+o+"&projection=mercator",l+="&apikey="+r.apiKey,console.log("query image",l),y(l,function(e,t){i(t.img,t.metadata)}),this};e.data={generateRaster:m,generateGeojson:l,generateTimeSeries:p,generateTimeSeriesSplit:f,generateTimestamps:h,generateWeatherChartData:v,getDatasetDetails:b,getVariables:x,getTimestamps:w,getPreview:S,getStations:C,getStationVariables:M,getImage:k,getJSON:y,apiConfig:r,pointsToFeatures:c,generateGeojsonPoints:s,getWorldVector:d,setApiKey:o,setApiConfig:i}}(n,a.d3),!function(e,t,n){var a=n.schemeSpectral[11].reverse(),r=function(e,n){var a=t.scaleQuantile().domain(e).range(t.range(n-1)).quantiles();return a.push(t.max(e)),a.unshift(t.min(e)),a},o=function(e,n){var a=r(e,n.length);return t.scaleLinear().domain(a).range(n)},i=function(e,n){var a=n||e.length,r=t.scaleLinear().domain([0,a-1]).range(e);return t.range(a).map(r)},l=function(e,n){var a=(t.max(e)-t.min(e))/n;return t.range(n).map(function(n,r){return t.min(e)+r*a})},s={grayscale:function(e){return t.scaleLinear().domain(t.extent(e)).range(["white","black"])},equalizedSpectral:function(e){return o(e,a)},equalizedGrayscale:function(e){return o(e,i(["white","black"],10))},reversedBrewerSpectral:function(e){if(t.min(e)>=0)return t.scaleLinear().domain(l(e,a.length)).range(a.slice().reverse());var n=l(e.filter(function(e){return 0>=e}),a.length/2-1),r=l(e.filter(function(e){return e>0}),a.length/2-1),o=n.concat([0]).concat(r),i=a.slice().reverse();return t.scaleLinear().domain(o).range(i)}};e.palette=s}(n,a.d3,a.colorBrewer),!function(e,t){var n=function(e){return{margin:e.margin||{right:20,left:20},unit:null,colorScale:e.colorScale||palette.equalizedSpectral}},a=function(n){var a=n.parent.querySelector(".datahub-legend");if(!a){var r='<div class="datahub-legend"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="panel"><defs><linearGradient id="legend-gradient"></linearGradient></defs><rect class="color-band" fill="url(#legend-gradient)" /><g class="axis"></g><text class="unit"></text></g></svg></div>';a=e.utils.appendHtmlToNode(r,n.parent)}var o=t.select(a),i=n.width||a.offsetWidth,l=n.height||a.offsetHeight;o.select("svg").attr("width",i).attr("height",l);var s=(o.select(".panel").attr("transform","translate("+n.margin.left+",0)"),i-n.margin.left-n.margin.right);return{container:o,width:i,height:l,legendWidth:s}},r=function(e){if(!e.data)return{};var n,a,r,o=e.colorScale(e.data);return a=o.domain(),r=t.range(0,a.length),n=e.colorScale(r),{legendColorScale:n,labelValues:a,colors:r}},o=function(e){if(!e.data)return{};var t=e.container.select("#legend-gradient").selectAll("stop").data(e.colors);return t.enter().append("stop").merge(t).attr("offset",function(t,n){return n*(100/(e.colors.length-1))+"%"}).attr("stop-color",function(t){return e.legendColorScale(t)}),t.exit().remove(),e.container.select(".color-band").attr("width",e.legendWidth).attr("height",e.height/2),{}},i=function(e){if(!e.data)return{};var t=e.container.select(".axis").selectAll("text.tick-label").data(e.labelValues),n=t.enter().append("text").classed("tick-label",!0).merge(t).attr("x",function(t,n){return n*(e.legendWidth/(e.labelValues.length-1))}).attr("y",.7*e.height).attr("dy","0.5em").text(function(e){return e.toPrecision(3)});t.exit().remove(),n.attr("dx",function(e,t){return-(this.getBBox().width/2)});var a=e.container.select(".axis").selectAll("line.tick-line").data(e.labelValues),r=a.enter().append("line").classed("tick-line",!0).merge(a).attr("x1",function(t,n){return n*(e.legendWidth/(e.labelValues.length-1))}).attr("y1",e.height/2).attr("x2",function(t,n){return n*(e.legendWidth/(e.labelValues.length-1))}).attr("y2",.55*e.height);return a.exit().remove(),r.attr("dx",function(e,t){return-(this.getBBox().width/2)}),e.unit&&e.container.select(".unit").attr("y",.95*e.height).text(e.unit),{}},l=e.utils.pipeline(n,a,r,o,i),s=function(n){var a,r,o=~~(1e4*Math.random()),i=e.utils.throttle(function(){a.width=a.parent.clientWidth,s()},200);t.select(window).on("resize."+o,i);var s=function(){r=l(a)},u=function(t){var n=t?JSON.parse(JSON.stringify(t)):{};return a=e.utils.mergeAll({},a),a.data=n,s(),this},c=function(t){return a=e.utils.mergeAll(a,t),s(),this},d=function(t){c(e.utils.mergeAll({},t))},m=function(){t.select(window).on("resize."+o,null),a.parent.innerHTML=null};return d(n),{setConfig:c,render:s,setData:u,destroy:m}};e.colorLegend=s}(n,a.d3),!function(e,t,a){var r=function(){var t=null,n=null,r=null,o=null,i=null,l=null,s=a.DomUtil.create("canvas","data-grid-layer");s.style.display="none",document.body.appendChild(s);var u={};return u.render=function(i){var l=i||o;if(o=l,!l)return u;var c=n.getBounds(),d=n.getPixelOrigin(),m=n.getPixelWorldBounds(),g=n.getSize(),p=g.y;n._zoom<g.y/512&&(p=m.max.y-m.min.y),console.log("Start rendering..."),console.time("render");var f=l.lat,h=l.lon,v=l.values;s.width=g.x,s.height=p;for(var y,b,x,w,S,C,M,k,T,L=s.getContext("2d"),D=Math.max(e.utils.bisectionReversed(f,c.getNorth())-1,0),P=Math.min(e.utils.bisectionReversed(f,c.getSouth()),f.length-1),I=Math.max(e.utils.bisection(h,c.getWest())-1,0),N=Math.min(e.utils.bisection(h,c.getEast())+1,h.length-1),A=n.latLngToContainerPoint([f[D],h[Math.max(I,0)]]),j=n.latLngToContainerPoint([f[D],h[Math.min(I+1,h.length-1)]]),O=Math.ceil(Math.max(j.x-A.x,1))+2,B=L.getImageData(0,0,g.x,p),E=new ArrayBuffer(B.data.length),U=new Uint8ClampedArray(E),l=new Uint32Array(E),z=0;z<f.length;z++)if(!(D>z||z>P)){M=Math.max(z,0),k=Math.min(M+1,f.length-1);for(var _=n.latLngToContainerPoint([f[M],h[I]]),R=n.latLngToContainerPoint([f[k],h[I]]),V=Math.ceil(Math.max(R.y-_.y,1)+1),q=0;q<h.length;q++)if(q>=I&&N>q&&(T=Math.max(q,0),S=n.latLngToContainerPoint([f[M],h[T]]),n._zoom<g.y/512&&(S.y=S.y+d.y-n._getMapPanePos().y),C=v[M][T],-999!==C&&null!==C&&!isNaN(C)&&z%1===0&&q%1===0))for(y=e.utils.parseRGB(t(C)),x=0;O>x;x++)for(w=0;V>w;w++)b=(~~S.y+w-~~(V/2))*g.x+Math.min(Math.max(~~S.x+x-~~(O/2),0),g.x-1),l[b]=255<<24|y[2]<<16|y[1]<<8|y[0]}return B.data.set(U),L.putImageData(B,0,0),r&&r.removeFrom(n),r=a.imageOverlay(s.toDataURL("image/png"),c).addTo(n),r.setOpacity(.8),console.timeEnd("render"),u},u.setColorScale=function(e){return t=e,u},u.setData=function(e){return u.render(e),u},u.addTo=function(e){return n=e,n.on("moveend",function(e){var t=e.target._panes.overlayPane.querySelector("img");if(t){var a=t.style,r=a.transform;if(r){var o=r.match(/\((.*)\)/)[1].split(",").slice(0,2);a.transform="translate("+o+")"}}var s=e.target._zoom,c=s!==i;i=s;var d=n.getBounds(),m=JSON.stringify(d)!==JSON.stringify(l);l=d,(c||m)&&u.render()}),u},u},o=function(n){function r(e){a.marker(e,{interactive:!0}).on("click",function(e){o(),c(),m.call("markerClick",this,e)},this).addTo(f),c()}function o(){return f.clearLayers(),h._toolbars.draw._modes.rectangle.handler.disable(),h._toolbars.draw._modes.marker.handler.disable(),this}function l(e){return{type:"Feature",geometry:{type:"Polygon",coordinates:[e.concat([e[0]])]},properties:{}}}function s(e){return{type:"Feature",geometry:{type:e.type,coordinates:e.coordinates},properties:{}}}function u(e,t){var n=a.GeoJSON.geometryToLayer(e).on("click",function(e){f.removeLayer(this),t&&t(this),c()},this);return n.addTo(f),this}function c(){if(n.disableAutoZoom)return this;var e=f.getBounds();return e._southWest?g.fitBounds(e):g.fitWorld(),this}var d=i(n).init(),m=t.dispatch("mapCloseClick","rectangleDraw","rectangleClick","markerClick","markerDraw","geojsonClick"),g=d._getMap();g.zoomControl.setPosition("bottomright");var p=a.Control.extend({position:"topright",onAdd:function(e){var t=a.DomUtil.create("a","map-close leaflet-bar leaflet-control leaflet-control-custom");return t.onclick=function(e){m.call("mapCloseClick",this,e)},t}});g.addControl(new p);var f=new a.FeatureGroup;g.addLayer(f);var h=new a.Control.Draw({edit:{featureGroup:f,edit:!1,remove:!1},draw:{polygon:!1,circle:!1,polyline:!1,marker:{icon:new a.Icon.Default,zIndexOffset:2e3,repeatMode:!0},rectangle:{shapeOptions:{fillColor:"#128DE0",color:"#128DE0",opacity:.5},repeatMode:!0}}});return g.addControl(h),g.on("draw:created",function(e){var t=e.layer;if(o(),"rectangle"===e.layerType&&(t.addTo(f).on("click",function(e){o(),c(),m.call("rectangleClick",this,e)},this),m.call("rectangleDraw",this,t.getBounds()),c()),"marker"===e.layerType){var n=t.getLatLng();r(n),m.call("markerDraw",this,n)}},this),d.addRectangle=function(e){o();var t=l(e);return u(t,function(){m.call("rectangleClick",this,arguments)}),c(),this},d.addPolygons=function(e){return o(),e.forEach(function(e){e[1].id=e[0],console.log(444,e);var t=s(e[1]);u(t,function(){m.call("geojsonClick",this,e)})}),c(),this},d.removeAllPolygons=o,d.zoomToBoundingBox=c,d.addMarker=r,d.on=e.utils.rebind(m),d},i=function(o){function i(){a.Icon.Default.imagePath=x.imagePath,S=a.map(x.container,w).on("click",function(e){D.call("click",this,{lat:e.latlng.lat,lon:e.latlng.lng})}).on("mousedown",function(e){x.container.classList.add("grab")}).on("mouseup",function(e){x.container.classList.remove("grab")}).on("mousemove",function(t){if(T){var r=e.utils.bisectionReversed(T.lat,t.latlng.lat),o=e.utils.bisection(T.lon,t.latlng.lng),i=Math.max(r-1,0),l=T.lat[i]-T.lat[r];t.latlng.lat>T.lat[r]+l/2&&(r=i);var s=Math.max(o-1,0),u=T.lon[o]-T.lon[s];t.latlng.lng<T.lon[o]-u/2&&(o=s);var c=null;if(t.latlng.lat<=T.lat[0]&&t.latlng.lat>=T.lat[T.lat.length-1]&&t.latlng.lng>=T.lon[0]&&t.latlng.lng<=T.lon[T.lon.length-1]&&(c=T.values[r][o]),null!==c&&-999!==c&&x.showTooltip){var d=a.Util.formatNum(c,2);n.setTooltipContent(d+"").openTooltip([t.latlng.lat,t.latlng.lng])}else n.closeTooltip();D.call("mousemove",this,{x:t.containerPoint.x,y:t.containerPoint.y,value:c,lat:t.latlng.lat,lon:t.latlng.lng})}}).on("mouseover",function(e){D.call("mouseenter",this,arguments)}).on("mouseout",function(e){D.call("mouseleave",this,arguments)}),o.mapConfig&&o.mapConfig.zoom||S.fitWorld(),S.createPane("labels");var t={};t.basemapDark=a.tileLayer("https://api.mapbox.com/styles/v1/planetos/ciusdqjc200w12jmlg0dys640/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGxhbmV0b3MiLCJhIjoiZjZkNDE4MTE5NWNhOGYyMmZhZmNhMDQwMDg0YWMyNGUifQ.htlwo6U82iekTcpGtDR_dQ",{tileSize:256,maxZoom:19}),t.basemapLight=a.tileLayer("https://api.mapbox.com/styles/v1/planetos/civ28flwe002c2ino04a6jiqs/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGxhbmV0b3MiLCJhIjoiZjZkNDE4MTE5NWNhOGYyMmZhZmNhMDQwMDg0YWMyNGUifQ.htlwo6U82iekTcpGtDR_dQ",{tileSize:256,maxZoom:19}),t.labelLight=a.tileLayer("http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",{attribution:"©OpenStreetMap, ©CartoDB",pane:"labels"}),t[x.basemapName].addTo(S),x.showLabels&&t.labelLight.addTo(S),C=r().addTo(S);var n=a.featureGroup().bindTooltip("").addTo(S);return this}function l(e,t){var n=t.bbox,r=[[n.latMax,n.lonMin],[n.latMin,n.lonMax]];return a.imageOverlay(e,r).addTo(S),this}function s(){return x.container.style.display="block",P.isVisible=!0,this}function u(){return x.container.style.display="none",P.isVisible=!1,this}function c(){return S.invalidateSize(),L?d(L):S.fitWorld(),this}function d(e){var t=a.geoJson(e);return S.fitBounds(t.getBounds()),L=e,this}function m(e){var t=function(e,t){t.on({click:function(e){D.call("featureClick",this,{id:e.target.feature.properties.id,lat:e.target._latlng?e.target._latlng.lat:e.latlng.lat,lon:e.target._latlng?e.target._latlng.lng:e.latlng.lng,layer:e})},mouseover:function(e,t,n){D.call("featureMousEnter",this,{x:e.containerPoint.x,y:e.containerPoint.y,lat:e.latlng.lat,lon:e.latlng.lng,value:e.target.feature.properties.id})},mouseout:function(e){D.call("featureMousLeave",this,{x:e.containerPoint.x,y:e.containerPoint.y,lat:e.latlng.lat,lon:e.latlng.lng,value:e.target.feature.properties.id})}})};return M=a.geoJson(e,{onEachFeature:t,pointToLayer:function(e,t){return new a.CircleMarker(t,{radius:4,fillColor:"#05A5DE",color:"#1E1E1E",weight:1,opacity:.5,fillOpacity:.4})}}).addTo(S),x.polygonTooltipFunc&&M.bindTooltip(x.polygonTooltipFunc),this}function g(e){return p(),k=a.marker(e,{interactive:!0,draggable:!0,opacity:1}).on("click",function(e){D.call("markerClick",this,arguments)}).addTo(S),this}function p(){return k&&k.remove(),this}function f(e){T=e;var t=e.uniqueValues.sort(function(e,t){return e-t}),n=x.colorScale(t);return C.setColorScale(n).setData(e),this}function h(e){return e?(S.addControl(S.zoomControl),S.doubleClickZoom.enable(),S.boxZoom.enable(),S.dragging.enable()):(S.removeControl(S.zoomControl),S.doubleClickZoom.disable(),S.boxZoom.disable(),S.dragging.disable()),this}function v(){return n.data.getWorldVector(function(e){m(e)}),this}var y=a.DomUtil.create("div","datahub-map"),b=o.parent.appendChild(y),x={container:b,colorScale:o.colorScale,basemapName:o.basemapName||"basemapDark",imagePath:o.imagePath||"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/images/",showLabels:!(o.showLabels===!1),showTooltip:!(o.showTooltip===!1),polygonTooltipFunc:o.polygonTooltipFunc},w={maxBounds:[[-90,-180],[90,180]],maxZoom:13,minZoom:1,scrollWheelZoom:!1,zoomSnap:0,zoomDelta:.5,attributionControl:!1,fadeAnimation:!1,tileLayer:{noWrap:!0,continuousWorld:!1}};e.utils.merge(w,o.mapConfig);var S,C,M,k,T,L,D=t.dispatch("click","mousemove","mouseenter","mouseleave","featureClick","featureMousEnter","featureMousLeave","markerClick"),P={isVisible:!0};return{init:i,show:s,hide:u,resize:c,zoomToPolygonBoundingBox:d,addMarker:g,removeMarker:p,renderPolygon:m,renderImage:l,renderRaster:f,renderVectorMap:v,isVisible:P.isVisible,hideZoomControl:h,on:e.utils.rebind(D),_getMap:function(){return S}}};e.map={rasterMap:i,selectorMap:o}}(n,a.d3,a.leaflet),"object"==typeof module&&module.exports&&(module.exports=e),t.datahub=e}({},function(){return this}());