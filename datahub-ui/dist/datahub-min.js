!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3"),require("d3-scale-chromatic"),require("leaflet")):"function"==typeof define&&define.amd?define(["d3","d3-scale-chromatic","leaflet"],t):e.datahub=t(e.d3,e.d3,e.L)}(this,function(e,t,a){"use strict";function n(e){return e.charAt(0).toUpperCase()+e.slice(1)}function r(e){if(e)return!0;throw"You need to set an API key using `datahub.data.setApiKey(API_KEY)`. You can get yours at http://data.planetos.com/"}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t,a="default"in a?a["default"]:a;var i=function(e,t){for(var a in t)t[a]&&t[a].constructor==Object&&e[a]?i(e[a],t[a]):e[a]=t[a]},l=function(){for(var e={},t=arguments,a=0;a<t.length;a++)i(e,t[a]);return e},o=function(e,t){for(;t.lastChild;)t.removeChild(t.lastChild);return s(e,t)},s=function(e,t){return t.appendChild(document.importNode((new DOMParser).parseFromString(e,"text/html").body.childNodes[0],!0))},c=function(e,t){var a;return function(){return e&&(a=e.apply(t||this,arguments),e=null),a}},u=function(e,t){var a=!1,n=null;return function(){var r=this;a||(a=!0,clearTimeout(n),n=setTimeout(function(){a=!1,e.apply(r,arguments)},t))}},d=function(e,t){var a,n,r,i,l=[],o=[],s=Number.MAX_VALUE,c=Number.MIN_VALUE,u={};for(r=0;r<e.length;r++)for(a=e[r],i=0;i<a.length;i++)n=t?t(a[i]):a[i],l.push(n),u.hasOwnProperty(n)||null===n||(u[n]=1,n>c&&(c=n),s>n&&(s=n));return o=Object.keys(u).map(function(e,t){return+e}),{flattened:l,uniques:o,max:c,min:s}},m=function(e,t){return d(e,t).uniques},h=function(e,t){return d(e,t).flattened},f=function(e,t,a){for(var n,r=0,i=e.length-1;i>r;)n=r+i>>1,a&&t>=e[n]||!a&&t<e[n]?i=n:r=n+1;return r},g=function(e,t){return f(e,t,!0)},v=function(e){var t,a=0,n=e.length;for(t=0;n>t;t++)e[t]>a&&(a=e[t]);return a},p=function(e){var t,a=1/0,n=e.length;for(t=0;n>t;t++)e[t]<a&&(a=e[t]);return a},x=function(e){return e.slice(4).slice(0,-1).split(",").map(function(e,t){return parseInt(e)})},y=function(){var e=arguments,t=this;return function(a){for(var n=0;n<e.length;n++){var r=e[n].call(this,a);a=t.mergeAll(a,r)}return a}},b=function(e,t){for(var a in t)a in e&&(e[a]=t[a])},w=function(e){return function(){return e.on.apply(e,arguments),this}},k={merge:i,mergeAll:l,htmlToNode:o,appendHtmlToNode:s,once:c,throttle:u,arrayStats:d,arrayUniques:m,arrayFlatten:h,bisection:f,bisectionReversed:g,findMax:v,findMin:p,parseRGB:x,pipeline:y,override:b,rebind:w},M={currentBaseURI:"https://data.planetos.com/",baseURI:"https://api.planetos.com/v1a/",datasetsEndpoint:"https://api.planetos.com/v1/datasets/",apiKey:null},D=function(e){return M.apiKey=e,this},A=function(){return{type:"Feature",properties:{name:""},geometry:{type:"LineString",coordinates:[[-170,80],[170,80],[170,-80],[-170,-80],[-170,80]]}}},S=function(){var e=N(50,function(e,t){return{coordinates:[360*Math.random()-180,180*Math.random()-90],id:"random-point-"+t}});return T(e)},T=function(e){return{type:"FeatureCollection",features:e.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:{id:e.id}}})}},C=function(e){var t="https://cdn.rawgit.com/johan/world.geo.json/master/countries.geo.json";I(t,function(t,a){e(a)})},Y=function(){var e={lon:N(360,function(e,t){return t-180}),lat:N(180,function(e,t){return 180-t-90}),values:N(180,function(e,t){return N(360,function(e,t){return~~(100*Math.random())})})};return e.uniqueValues=k.arrayUniques(e.values),e},N=function(e,t){var a=t||function(e,t){return 0};return Array.apply(null,Array(e)).map(a)},X=function(e){var e=e||{},t={count:e.count||12,layerCount:e.layerCount||1,timeStart:e.timeStart||"2016-01-01",timeIncrement:e.timeIncrement||"month",step:e.step||1,min:e.min||0,max:e.max||100},a=~~(Math.random()*(t.max-t.min))+t.min,n=N(t.count,function(){return N(t.layerCount,function(e){return a+=(2*Math.random()-1)*((t.max-t.min)/10),a=Math.max(a,t.min)})}),r=H(t),i=r.map(function(e,t){return{timestamp:e,value:n[t],id:n[t].map(function(e){return~~(1e3*Math.random())}),className:n[t].map(function(e){return Math.random().toString(36).substring(4,8)})}});return i},H=function(t){var t=t||{},a={count:t.count||12,layerCount:t.layerCount||1,timeStart:t.timeStart||"2016-01-01",timeIncrement:t.timeIncrement||"month",step:t.step||1,min:t.min||0,max:t.max||100},r="utc"+n(a.timeIncrement)||"utcHour",i=e[r],l=e[r+"s"],o=a.timeStart?new Date(a.timeStart):new Date,s=i.offset(o,a.count*a.step),c=l(o,s,a.step),u=c.map(function(t,a){return e.isoFormat(t)});return u},I=function(e,t){var a="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("get",e,!0),a.onreadystatechange=function(){var e,n;4==a.readyState&&(e=a.status,200==e?(n=JSON.parse(a.responseText),t(null,n)):t(e))},a.send()},L=function(e,t){r(M.apiKey);var a=M.baseURI+"/datasets/"+e+"?apikey="+M.apiKey;return console.log("get dataset details",a),I(a,function(e,a){if(void 0===a)return console.log("Can not render dataset because of API error",e),!1;var n=a.FeatureType||"timeseries",r="grid"===n.toLowerCase().trim()?"raster":"timeseries";console.log("Data type:",r,a.ProductType,a.FeatureType,a),t({datasetInfo:a,dataType:r,productType:a.ProductType})}),this},E=function(e,t,a){r(M.apiKey);var n=M.baseURI+"/datasets/"+e+"/variables?apikey="+M.apiKey;return console.log("query variables",n),I(n,function(n,r){var i,l=r[e],o=t;o&&(i=l.filter(function(e){return e.name===o})[0]);var s=i||l[0];a({variables:l,defaultVariable:s})}),this},F=function(e,t,a){r(M.apiKey);var n=M.baseURI+"/datasets/"+e+"/variables/"+encodeURIComponent(t)+"/timestamps?apikey="+M.apiKey;return console.log("query timestamps",n),I(n,function(e,t){if(e)return void console.log("Server error",e);var n=t.map(function(e){return new Date(parseInt(e))});a({timestamps:n})}),this},O=function(e,t,a,n){r(M.apiKey);var i=M.baseURI+"/datasets/"+e+"/variables/"+encodeURIComponent(t);return a&&(i+="/timestamps/"+a),i+="/sample_data",i+="?apikey="+M.apiKey,console.log("query dataset",i),I(i,function(a,r){if(a)return void console.log("Server error",a);r.values=r.values.map(function(e,t){return e.map(function(e){return-999===e?null:e})}),r.uniqueValues=k.arrayUniques(r.values).sort();var l=M.currentBaseURI+"/datasets/"+e+"?variable="+t;n({json:r,uri:i,datahubLink:l})}),this},W=function(e,t){r(M.apiKey);var a=M.datasetsEndpoint+e+"/stations?apikey="+M.apiKey;return console.log("get stations",a),I(a,function(e,a){if(e)return void console.log("Server error",e);var n=[];for(var r in a.station){var i=a.station[r];void 0!==i.SpatialExtent&&n.push({id:r,coordinates:i.SpatialExtent.coordinates})}t({stations:n,defaultStation:n[0]})}),this},B=function(e,t,a,n,i){r(M.apiKey);var l=500,o=M.datasetsEndpoint+e+"/stations/"+t+"?apikey="+M.apiKey+"&verbose=true&count="+l;return n||(o+="&time_order=desc"),console.log("station variable",o),I(o,function(t,n){if(t)return void console.log("Server error",t);console.log("Point API data",n,o);var r,l,s={},c=n.metadata.contexts;for(var u in c){r=c[u].dataVariables;for(var d in r)l=r[d],l.key=d,s[d]=l}var m={};n.entries.forEach(function(e){for(var t in e.data)m[t]||(m[t]={values:[],timestamps:[]}),m[t].values.push(e.data[t]),m[t].timestamps.push(new Date(e.axes.time))});var h=[];for(var f in s)h.push(s[f]);var g=M.currentBaseURI+"/datasets/"+e+"?variable="+a;i({datasets:m,variablesMetadata:s,variables:h,datahubLink:g,variableData:m[a],variableMetadata:s[a]})}),this},P=function(e,t,a,n,i){r(M.apiKey);var l=M.baseURI+"/datasets/"+e+"/variables/"+encodeURIComponent(t);return a&&(l+="/timestamps/"+a),l+="/image",l+="?width="+n+"&projection=mercator",l+="&apikey="+M.apiKey,console.log("query image",l),I(l,function(e,t){i(t.img,t.metadata)}),this},z={generateRaster:Y,generateGeojson:A,generateTimeSeries:X,generateTimestamps:H,getDatasetDetails:L,getVariables:E,getTimestamps:F,getPreview:O,getStations:W,getStationVariables:B,getImage:P,getJSON:I,apiConfig:M,pointsToFeatures:T,generateGeojsonPoints:S,getWorldVector:C,setApiKey:D},j=function(t){var a=e.utcFormat("%b %e, %Y at %H:%M UTC"),n="";if(!t.dataIsEmpty){var r=function(e){return e%1?~~(100*e)/100:e},i=[],l=e.extent(t.timestamps),o=l[0],s=l[1];o.getTime()===s.getTime()&&o.getUTCMonth()===s.getUTCMonth()||i.push("%b %e"),o.getYear()!==s.getYear()&&i.push("%Y"),o.getYear()===s.getYear()&&o.getUTCHours()!==s.getUTCHours()&&i.push("%H:%M"),n=e.utcFormat(i.join(" "))}return{axisXFormat:n,axisTitleXFormat:function(e){return a(e.data.x)},tooltipFormat:function(e){return r(e.data.y)}}},R=function(e){var t={top:50,right:50,bottom:100,left:50};return{margin:e.margin||t,width:e.width||600,height:e.height||300}},U=function(e){return e.dataConverted.sort(function(e,t){var a=e.x.getTime(),n=t.x.getTime();return n>a?-1:a>n?1:0}),{}},q=function(e){var t=!e.flattenedData.filter(function(e){return null!=e.y}).length;return{dataIsAllNulls:t}},K=function(t){var a=t.axisXFormat||"%b",n=e.utcFormat(a)||function(e){return e.toString()},r=e.axisBottom().scale(t.scaleX).tickFormat(n);return{axisX:r}},V=function(t){var a=t.axisYFormat||".2s",n=e.format(a),r=t.scaleY.range()[0],i=e.axisLeft().scale(t.scaleY).ticks(Math.max(~~(r/30),2)).tickPadding(10).tickFormat(n).tickSize(-t.chartWidth);return{axisY:i}},J=function(t){var a=t.container.selectAll("g.axis.x").data([0]),n=a.enter().append("g").attr("class","x axis").attr("transform","translate("+[0,t.chartHeight]+")").merge(a).attr("display",function(e){return t.dataIsEmpty?"none":null}).attr("transform","translate("+[0,t.chartHeight]+")");n.call(t.axisX),a.exit().remove();var r=[],i=(n.selectAll(".tick").select("text").each(function(e,t){var a=this.getBBox().width;a&&r.push(a)}),Math.floor(e.max(r)/t.stripeScaleX.bandwidth()));return i&&n.selectAll(".tick text").attr("display",function(e,t){return t%(i+1)?"none":"block"}),{}},_=function(e){var t=e.axisYPadding||0,a=e.container.selectAll("g.axis.y").data([0]);return a.enter().append("g").attr("class","y axis").attr("transform","translate("+[-t/2,0]+")").merge(a).call(e.axisY).attr("text-anchor","start").selectAll("text").attr("dx",-e.margin.left+10),a.exit().remove(),{}},G=function(e){var t=e.container.selectAll("text.axis-title.x").data([0]);return t.enter().append("text").attr("class","x axis-title").merge(t).text(e.axisTitleX||"").attr("x",e.chartWidth).attr("y",e.chartHeight),t.exit().remove(),{axisTitleXComponent:K}},Z=function(e){var t=e.container.selectAll("text.axis-title.y").data([0]);t.enter().append("text").attr("class","y axis-title").merge(t).text(e.axisTitleY||"").attr("x",-e.margin.left).attr("y",-10).attr("text-anchor","start");return t.exit().remove(),{}},Q=function(e){var t=e.container.selectAll("text.chart-title").data([e.chartTitle||""]);return t.enter().append("text").attr("class","chart-title").merge(t).html(function(e){return e}).attr("x",function(t){return(e.chartWidth-5*t.length)/2}).attr("y",-5),t.exit().remove(),{}},$=function(e){var t=e.container.selectAll("g.shapes").data([0]),a=t.enter().append("g").attr("class","shapes").merge(t);return t.exit().remove(),{shapePanel:a}},ee=function(t){var a=e.select(t.parent).selectAll("div.widget-container").data([0]),n=a.enter().append("div").attr("class","widget-container").merge(a).attr("width",t.width).attr("height",t.height);return a.exit().remove(),{container:n}},te=function(e){var t=ee(e).container,a=t.selectAll("svg").data([0]),n=a.enter().append("svg").attr("class","datahub-chart"),r=n.append("g").attr("class","panel").merge(a).attr("transform","translate("+e.margin.left+","+e.margin.top+")");return n.merge(a).attr("width",e.width).attr("height",e.height),a.exit().remove(),{root:a,container:r}},ae=function(e){var t="";e.dataIsEmpty?t="(Data Unavailable)":e.dataIsAllNulls&&(t="Values are all null");var a=e.container.select(".message-group").selectAll("text").data([t]);return a.enter().append("text").merge(a).attr("x",(e.scaleX.range()[1]-e.scaleX.range()[0])/2).attr("y",function(){return e.height/2-this.getBBox().height/2}).text(function(e){return e}).attr("dx",function(e){return-this.getBBox().width/2}),a.exit().remove(),{}},ne=function(t){return t.container.select("g.axis.x").selectAll(".tick text").text(function(t){return e.timeFormat("%a")(t)}),{}},re=function(t){return t.container.select("g.axis.x").selectAll(".tick text").text(function(t){return e.timeFormat("%x")(t)}),{}},ie=function(e){return e.container.select("g.axis.x").selectAll(".tick text").style("transform","rotate(30deg)").style("text-anchor","start"),{}},le=function(t){return config.axisY.tickFormat(e.format(".2s")),{}},oe=function(e){return e.labelsRewriterY?(e.container.selectAll("g.axis.y").selectAll("text").html(function(t,a){return e.labelsRewriterY(t,a,e)}),{}):{}},se={axesFormatAutoconfig:j,defaultConfig:R,sortData:U,detectDataAllNulls:q,axisX:K,axisY:V,axisComponentX:J,axisComponentY:_,axisTitleComponentX:G,axisTitleComponentY:Z,chartTitleComponent:Q,shapePanel:$,svgContainer:te,container:ee,message:ae,axisXFormatterTime:ne,axisXFormatterTimeHour:re,axisXFormatterRotate30:ie,axisYFormatSI:le,labelsRewriterY:oe},ce=function(t){var a=t.parent.querySelector(".widget-container");if(!a){var n='<div class="widget-container"><svg class="datahub-chart"><g class="panel"><g class="stripe-group"></g><g class="area-group"></g><g class="stacked-area-group"></g><g class="reference-bar-group"></g><g class="reference-line-group"></g><g class="bar-group"></g><g class="stacked-bar-group"></g><g class="estimate-bar-group"></g><g class="line-group"></g><g class="dot-group"></g><g class="threshold-line-group"></g><g class="y axis"></g><g class="x axis"></g><g class="active-group"></g><g class="title-container"><text class="y axis-title"></text><text class="x axis-title"></text><text class="chart-title"></text></g><g class="message-group"></g><g class="events"><rect class="event-panel"></rect></g></g></svg></div>';a=k.appendHtmlToNode(n,t.parent)}var r=t.width-t.margin.left-t.margin.right,i=t.height-t.margin.top-t.margin.bottom,l=e.select(a);return l.select("svg").attr("width",t.width).attr("height",t.height),l.select(".panel").attr("transform","translate("+t.margin.left+","+t.margin.top+")"),l.select(".events rect").attr("width",r).attr("height",i).attr("opacity",0),{container:l,chartWidth:r,chartHeight:i}},ue=function(e,t,a){return e[t]?e[t].map(function(e){return e.timestamp=new Date(e.timestamp),e.value=Array.isArray(e.value)&&!a?e.value[0]:e.value,e}):[]},de=function(e){return e.timestamp?e.timestamp.map(function(e){return new Date(e)}):[]},me=function(e){var t=e.data||{};return{dataIsEmpty:!t||!t.timestamp||!t.timestamp.length,data:{timestamp:de(t),stackedBarData:ue(t,"stackedBarData",!0),stackedAreaData:ue(t,"stackedAreaData",!0),lineData:ue(t,"lineData",!0),barData:ue(t,"barData"),referenceData:ue(t,"referenceData"),estimateData:ue(t,"estimateData"),thresholdData:ue(t,"thresholdData"),areaData:ue(t,"areaData")}}},he=function(t){var a=t.dataIsEmpty?0:t.data.timestamp,n=e.scaleBand().domain(a).range([0,t.chartWidth]).paddingInner(.4).paddingOuter(.2),r=n.copy().paddingInner(.1).paddingOuter(.05),i=n.copy().paddingInner(0).paddingOuter(0),l=n.copy().paddingInner(1).paddingOuter(.5);return{scaleX:n,referenceScaleX:r,stripeScaleX:i,lineScaleX:l}},fe=function(t,a){var n=a?"min":"max";return t?e[n](t.map(function(e){return e.value})):null},ge=function(t,a){var n=a?"min":"max";if(t&&t.length){var r=t.map(function(t){return e.sum(t.value)});return e[n](r)}return null},ve=function(t,a){var n=a?"min":"max";if(t&&t.length){var r=t.map(function(e,t){return e.value});return r[0].length&&(r=e.merge(r)),e[n](r)}return null},pe=function(t){var a=[];a.push(fe(t.data.barData)),a.push(fe(t.data.referenceData)),a.push(fe(t.data.estimateData)),a.push(fe(t.data.thresholdData)),a.push(fe(t.data.areaData)),a.push(ge(t.data.stackedBarData)),a.push(ge(t.data.stackedAreaData)),a.push(ve(t.data.lineData));var n=[],r=!0;n.push(fe(t.data.barData,r)),n.push(fe(t.data.referenceData,r)),n.push(fe(t.data.estimateData,r)),n.push(fe(t.data.thresholdData,r)),n.push(fe(t.data.areaData,r)),n.push(ge(t.data.stackedBarData,r)),n.push(ge(t.data.stackedAreaData,r)),n.push(ve(t.data.lineData,r));var i,l=e.max(a);if(t.autoScaleY){i=e.min(n);var o=(l-i)/10;i=Math.max(i-o,0),l+=o}else i=Math.min(e.min(n),0),l=Math.max(l,0);var s=[i,l];t.domain&&(s=t.domain),t.reverseY&&(s=[s[1],s[0]]);var c=e.scaleLinear().domain(s).range([t.chartHeight,0]);return{scaleY:c}},xe=function(e,t,a){if(!a)return null;var n=e[t].map(function(e){return e.timestamp&&e.timestamp.getTime()}).indexOf(a.getTime());if(n>-1){var r=k.mergeAll({},e[t][n]);return r.value=[].concat(e[t][n].value),r.id=[].concat(e[t][n].id),r}return null},ye=function(e,t,a){if(e[t][0]){var n=k.mergeAll({},e[t][0]);return n.value=[].concat(e[t][0].value),n.id=[].concat(e[t][0].id),n}return null},be=function(e,t){var a={referenceData:xe(t,"referenceData",e),estimateData:xe(t,"estimateData",e),barData:xe(t,"barData",e),stackedBarData:xe(t,"stackedBarData",e),lineData:xe(t,"lineData",e),areaData:xe(t,"areaData",e),stackedAreaData:xe(t,"stackedAreaData",e),thresholdData:ye(t,"thresholdData",e)};return a},we=function(t){var a=t.container.select(".events .event-panel").on("mousemove touchstart",function(a){if(!t.dataIsEmpty){var n=e.mouse(this)[0],r=t.stripeScaleX.bandwidth(),i=t.stripeScaleX.domain(),l=i.length,o=Math.min(~~(n/r),l-1),s=i[o],c=be(s,t.data);t.events.call("hover",null,{index:o,timestamp:s,data:c,config:t,event:e.event})}}).on("mouseout",function(e){t.events.call("mouseout",null,{})}).on("click",function(a){t.events.call("click",null,{event:e.event})});return{eventPanel:a}},ke=function(e){var t=e.container.select(".bar-group").selectAll("rect.bar").data(e.data.barData);return t.enter().append("rect").merge(t).attr("class",function(e){return["bar",e.id,e.className].join(" ")}).attr("x",function(t,a){return e.scaleX(t.timestamp)||0}).attr("y",function(t){return e.autoScaleY?e.chartHeight-(e.chartHeight-Math.abs(e.scaleY(t.value))):t.value>=0||e.reverseY?e.scaleY(0)-Math.abs(e.scaleY(t.value)-e.scaleY(0)):e.scaleY(0)}).attr("width",function(t){return e.scaleX.bandwidth()}).attr("height",function(t){return e.autoScaleY?e.chartHeight-Math.abs(e.scaleY(t.value)):Math.abs(e.scaleY(t.value)-e.scaleY(0))}),t.exit().remove(),{}},Me=function(e){var t=e.container.select(".estimate-bar-group").selectAll("rect.estimate-bar").data(e.data.estimateData);return t.enter().append("rect").merge(t).attr("class",function(e){return["estimate-bar",e.id,e.className].join(" ")}).attr("x",function(t,a){return e.scaleX(t.timestamp)||0}).attr("y",function(t){return e.scaleY(t.value)||0}).attr("width",function(t){return e.scaleX.bandwidth()}).attr("height",function(t){return e.chartHeight-e.scaleY(t.value)||0}),t.exit().remove(),{}},De=function(e){var t=e.container.select(".reference-bar-group").selectAll("rect.reference-bar").data(e.data.referenceData);t.enter().append("rect").merge(t).attr("class",function(e){return["reference-bar",e.id,e.className].join(" ")}).attr("x",function(t,a){return e.referenceScaleX(t.timestamp)||0}).attr("y",function(t){return e.autoScaleY?e.chartHeight-(e.chartHeight-Math.abs(e.scaleY(t.value))):t.value>=0||e.reverseY?e.scaleY(0)-Math.abs(e.scaleY(t.value)-e.scaleY(0)):e.scaleY(0)}).attr("width",function(t){return e.referenceScaleX.bandwidth()}).attr("height",function(t){return e.autoScaleY?e.chartHeight-Math.abs(e.scaleY(t.value)):Math.abs(e.scaleY(t.value)-e.scaleY(0))}),t.exit().remove();var a=e.container.select(".reference-line-group").selectAll("path.reference-top").data(e.data.referenceData);return a.enter().append("path").attr("class","reference-top").merge(a).attr("d",function(t,a){var n=e.referenceScaleX(t.timestamp)||0,r=0;r=t.value>=0||e.reverseY?e.scaleY(0)-Math.abs(e.scaleY(t.value)-e.scaleY(0)):e.scaleY(0)+Math.abs(e.scaleY(t.value)-e.scaleY(0));var i=e.referenceScaleX.bandwidth();return"M"+[[n,r],[n+i,r]]}),a.exit().remove(),{}},Ae=function(t){if(!t.data.stackedBarData||!t.data.stackedBarData.length)return t.container.select(".stacked-bar-group").selectAll("g.stack").remove(),{};var a=t.data.stackedBarData[0].value.map(function(e,t){return"y"+t}),n=[];t.data.stackedBarData.forEach(function(e,t){var a=k.mergeAll({},e);e.value&&e.value.length&&(e.value.forEach(function(e,t){a["y"+t]=e}),n.push(a))});var r=t.container.select(".stacked-bar-group").selectAll("g.stack").data(e.stack().keys(a)(n)),i=r.enter().append("g").attr("class","stack").merge(r).selectAll("rect.stacked-bar").data(function(e,t){return e.forEach(function(t){t.index=e.index}),e});return i.enter().append("rect").attr("class","stacked-bar").merge(i).attr("class",function(e,t,a){var n=e.data.id?e.data.id[e.index]:null,r=e.data.className?e.data.className[e.index]:null;return["stacked-bar","layer"+e.index,n,r].join(" ")}).filter(function(e){return!Number.isNaN(e[0])&&!Number.isNaN(e[1])}).attr("x",function(e){return t.scaleX(e.data.timestamp)}).attr("y",function(e){return t.scaleY(e[1])}).attr("height",function(e){return t.scaleY(e[0])-t.scaleY(e[1])}).attr("width",t.scaleX.bandwidth()),i.exit().remove(),r.exit().remove(),{}},Se=function(t){if(!t.data.lineData.length)return t.container.select(".line-group").selectAll("path.line").remove(),{};var a=e.line().defined(function(e){return null!=e.value}).x(function(e){return t.lineScaleX(e.timestamp)}).y(function(e){return t.scaleY(e.value)}),n=[],r=t.data.lineData[0].value.length;if("undefined"==typeof r)n.push(t.data.lineData);else for(var i=0;r>i;i++){var l=t.data.lineData.map(function(e){return{timestamp:e.timestamp,value:e.value[i],id:e.id&&e.id[i],className:e.className&&e.className[i]}});n.push(l)}var o=t.container.select(".line-group").selectAll("path.line").data(n);return o.enter().append("path").style("fill","none").merge(o).attr("class",function(e,t){return["line","layer"+t,e[0].id,e[0].className].join(" ")}).attr("d",a),o.exit().remove(),{}},Te=function(e){if(!e.data.lineData.length)return e.container.select(".dot-group").selectAll(".dot-layer").remove(),{};for(var t=e.data.lineData,a=[],n=t[0].value.length,r=0;n>r;r++){var i=[];t.forEach(function(e,a){var n=Math.max(0,a-1),l=Math.min(t.length-1,a+1),o=a,s=t[n].value[r],c=t[l].value[r],u=e.value[r];(null!==u&&(null===s||null===c)||o===n&&o===l)&&i.push({value:u,timestamp:e.timestamp,layer:r})}),a.push(i)}var l=e.container.select(".dot-group").selectAll(".dot-layer").data(a),o=l.enter().append("g").merge(l).attr("class","dot-layer");l.exit().remove();var s=o.selectAll(".dot").data(function(e,t){return e});return s.enter().append("circle").merge(s).attr("class",function(e,t,a){return["dot","layer"+e.layer].join(" ")}).attr("cx",function(t){return e.lineScaleX(t.timestamp)}).attr("cy",function(t){return e.scaleY(t.value)}).attr("r",2),s.exit().remove(),{}},Ce=function(e){var t=e.container.select(".threshold-line-group").selectAll("line.threshold-line").data(e.data.thresholdData);return t.enter().append("line").merge(t).attr("class",function(e){return["threshold-line",e.id,e.className].join(" ")}).attr("x1",0).attr("y1",function(t){return e.scaleY(t.value)||0}).attr("x2",e.chartWidth).attr("y2",function(t){return e.scaleY(t.value)||0}).attr("display",function(e){return e?null:"none"}),t.exit().remove(),{}},Ye=function(t){if(!t.data.areaData||!t.data.areaData.length)return t.container.select(".area-group").selectAll("path.area").remove(),{};var a=e.area().defined(function(e){return null!=e.value}).x(function(e){return t.lineScaleX(e.timestamp)}).y0(t.chartHeight).y1(function(e){return t.scaleY(e.value)}),n=t.container.select(".area-group").selectAll("path.area").data([t.data.areaData]);return n.enter().append("path").attr("class",function(e,t){return["area","layer"+t,e[0].id,e[0].className].join(" ")}).merge(n).attr("d",a),n.exit().remove(),{}},Ne=function(t){if(!t.data.stackedAreaData||!t.data.stackedAreaData.length)return t.container.select(".stacked-area-group").selectAll("g.stack-area").remove(),{};var a=t.data.stackedAreaData[0].value.map(function(e,t){return"y"+t}),n=e.area().defined(function(e){return!Number.isNaN(e[0])&&!Number.isNaN(e[1])}).x(function(e){return t.lineScaleX(e.data.timestamp)}).y0(function(e){return t.scaleY(e[0])}).y1(function(e){return t.scaleY(e[1])}),r=[];t.data.stackedAreaData.forEach(function(e,t){var a=k.mergeAll({},e);e.value&&e.value.length&&(e.value.forEach(function(e,t){a["y"+t]=e}),r.push(a))});var i=t.container.select(".stacked-area-group").selectAll("g.stack-area").data(e.stack().keys(a)(r)),l=i.enter().append("g").attr("class","stack-area").merge(i).selectAll("path.stacked-area").data(function(e,t){return e.forEach(function(t){t.index=e.index}),[e]});return l.enter().append("path").merge(l).attr("class",function(e){var t=e[0].data.id?e[0].data.id[e.index]:null,a=e[0].data.className?e[0].data.className[e.index]:null;return["stacked-area","layer"+e.index,t,a].join(" ")}).attr("d",n),l.exit().remove(),i.exit().remove(),{}},Xe=function(e){if(e.showStripes===!1)return e.container.select(".stripe-group").selectAll("rect.stripe").remove(),{};var t=e.container.select(".stripe-group").selectAll("rect.stripe").data(e.data.timestamp);return t.enter().append("rect").attr("class","stripe").merge(t).classed("even",function(e,t){return t%2}).attr("x",function(t,a){return e.stripeScaleX(t)||0}).attr("y",function(e){return 0}).attr("width",function(t){return e.stripeScaleX.bandwidth()}).attr("height",function(t){return e.chartHeight}),t.exit().remove(),{}},He=function(t){var a=t.activeDate&&void 0!==t.activeDate.getTime?t.activeDate.getTime():new Date(t.activeDate).getTime(),n=t.data.timestamp.filter(function(e){return e.getTime()===a}),r=t.container.select(".active-group").selectAll("rect.active").data(n);return r.enter().append("rect").attr("class","active").merge(r).each(function(a){if(!t.dataIsEmpty){var n=be(a,t.data);t.events.call("active",null,{timestamp:a,data:n,config:t,event:e.event})}}).attr("x",function(e,a){return t.stripeScaleX(e)||0}).attr("y",function(e){return 0}).attr("width",function(e){return t.stripeScaleX.bandwidth()}).attr("height",function(e){return t.chartHeight}),r.exit().remove(),{}},Ie=k.pipeline(se.defaultConfig,me,ce,he,pe,we,se.axisX,se.axisY,Xe,He,Ye,De,Ae,Ne,ke,Me,Se,Te,Ce,se.axisComponentY,se.labelsRewriterY,se.message,se.axisComponentX,se.axisTitleComponentX,se.axisTitleComponentY,se.chartTitleComponent),Le=function(t){var a,n,r=e.dispatch("hover","click","mouseout","active"),i=~~(1e4*Math.random()),l=k.throttle(function(){a.width=a.parent.clientWidth,o()},200);e.select(window).on("resize."+i,l);var o=function(){n=Ie(a)},s=function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return a=k.mergeAll({},a),a.data=t,o(),this},c=function(e){return a=k.mergeAll(a,e),o(),this},u=function(e,t){c(k.mergeAll(e,{events:t}))},d=function(){e.select(window).on("resize."+i,null),a.parent.innerHTML=null};return u(t,r),{on:k.rebind(r),setConfig:c,setData:s,destroy:d}},Ee=function(t){var a=t.parent.querySelector(".datahub-table-chart");if(!a){var n='<div class="datahub-table-chart"><div class="table-container"><div class="header"><div class="row"></div></div><div class="content"></div><div class="footer"><div class="row"></div></div></div><div class="chart-container"><div class="header"><div class="row"></div></div><div class="content"><div class="rows"></div><div class="chart"><svg><g class="panel"><g class="stripes"></g><g class="bars"></g><g class="axis"></g><g class="message-group"></g></g></svg></div></div><div class="footer"><div class="row"></div></div></div></div>';a=k.appendHtmlToNode(n,t.parent)}var r=!(t.elements&&t.elements.length),i={top:0,bottom:24,right:24,left:24},l=t.margin||i,o=t.rowHeight||48,s=e.select(a),c=s.select(".chart-container"),u=c.node().clientWidth,d=u-l.left-l.right,m=r?o:t.elements.length*o+l.bottom,h=m-l.bottom;return{container:s,width:u,height:m,chartWidth:d,chartHeight:h,rowHeight:o,margin:l,dataIsEmpty:r}},Fe=function(e){if(e.elements){var t=e.elements.slice(),a=t.sort(e.sortFunc);return{elements:a}}return{}},Oe=function(t){var a=t.domain||[0,0];if(!t.domain&&t.elements){var n=e.merge(t.elements).filter(function(e){return e.key===t.valueKey||e.key===t.referenceKey}).map(function(e){return e.value});a=n.length?e.extent(n):[0,0]}a[0]=Math.min(a[0],0);var r=Math.max(Math.abs(a[0]),Math.abs(a[1]));a=[-r,r];var i=e.scaleLinear().domain(a).range([0,t.chartWidth]);return{scaleX:i}},We=function(t){var a=t.axisXFormat||".2s",n=e.axisBottom().scale(t.scaleX).tickFormat(e.format(a)),r=t.container.select(".axis").attr("transform","translate("+[0,t.chartHeight]+")").attr("display",t.dataIsEmpty?"none":"block").call(n);return{axisX:r}},Be=function(e){var t=e.container.select(".header .row").selectAll("div.column").data(e.header||[]);return t.enter().append("div").merge(t).attr("class",function(e){return"column "+e.key}).html(function(e){if(Array.isArray(e.label)){var t=e.label.map(function(e,t){return"<div>"+e+"</div>"}).join("");return'<div class="multiline">'+t+"</div>"}return e.label}),t.exit().remove(),{}},Pe=function(e){var t=e.container.select(".table-container .content").selectAll("div.row").data(e.elements||[]),a=t.enter().append("div").merge(t).attr("class","row");t.exit().remove();var n=a.selectAll("div.column").data(function(e){return e});n.enter().append("div").merge(n).attr("class","column").html(function(t){if("number"==typeof t.label){var a=function(e){return Math.floor(100*e)/100},n=e.valueFormat||a;return n(t.label)}if(Array.isArray(t.label)){var r=t.label.map(function(e,t){return"<div>"+e+"</div>"}).join("");return'<div class="multiline">'+r+"</div>"}return null===t.label||"undefined"==typeof t.label?e.emptyPlaceholder||"":t.label}),n.exit().remove();var r=e.container.select(".chart-container .rows").selectAll("div.row").data(e.elements||[]);return r.enter().append("div").attr("class","row").append("div").attr("class","column"),r.exit().remove(),{}},ze=function(e){var t=e.container.select("svg").attr("width",e.width).attr("height",e.height).select(".panel").attr("transform","translate("+e.margin.left+" 0)").select(".bars").selectAll("g.bar-group").data(e.elements||[]),a=t.enter().append("g").merge(t).attr("class","bar-group").attr("transform",function(t,a){return"translate(0 "+a*e.rowHeight+")"});t.exit().remove();var n=a.selectAll("rect.reference-bar").data(function(t,a){var n=t.filter(function(t){return t.key===e.referenceKey});return[n&&n[0]]});n.enter().append("rect").merge(n).attr("class","reference-bar").attr("width",function(t){return Math.abs(e.scaleX(t.value)-e.scaleX(0))}).attr("height",function(t){return e.rowHeight/2}).attr("x",function(t){return t.value<0?e.scaleX(t.value):e.scaleX(0)}).attr("y",function(t){return e.rowHeight/4}),n.exit().remove();var r=2,i=a.selectAll("rect.reference-line").data(function(t,a){var n=t.filter(function(t){return t.key===e.referenceKey});return[n&&n[0]]});i.enter().append("rect").merge(i).attr("class","reference-line").attr("display",function(e){return e.value||0===e.value?"block":"none"}).attr("width",r).attr("height",function(t){return e.rowHeight/2}).attr("x",function(t){var a=r;return t.value>0&&(a*=-1),e.scaleX(t.value)+a}).attr("y",function(t){return e.rowHeight/4}),i.exit().remove();var l=a.selectAll("rect.value-bar").data(function(t,a){var n=t.filter(function(t){return t.key===e.valueKey});return[n&&n[0]]});return l.enter().append("rect").merge(l).attr("class","value-bar").attr("width",function(t){return Math.abs(e.scaleX(t.value)-e.scaleX(0))}).attr("height",function(t){return e.rowHeight/4}).attr("x",function(t){return t.value<0?e.scaleX(t.value):e.scaleX(0)}).attr("y",function(t){return 3*e.rowHeight/8}),l.exit().remove(),{}},je=function(t){return t.container.on("click",function(){t.events.call("click",null,{event:e.event})}),{}},Re=function(e){var t=e.scaleX.ticks(),a=e.container.select(".stripes").selectAll("rect.stripe").data(t);return a.enter().append("rect").attr("class","stripe").merge(a).attr("x",function(a,n){var r=t[Math.max(n-1,0)],i=(e.scaleX(a)-e.scaleX(r))/2;
return e.scaleX(a)-i}).attr("y",function(e){return 0}).attr("width",function(a,n){var r=t[Math.max(n-1,0)],i=(e.scaleX(a)-e.scaleX(r))/2;return i=Math.max(i,0)}).attr("height",function(t){return e.chartHeight}),a.exit().remove(),{}},Ue=function(e){var t=(e.scaleX.ticks(),e.container.select(".stripes").selectAll("line.grid").data([0]));return t.enter().append("line").attr("class","grid").merge(t).attr("display",e.dataIsEmpty?"none":"block").attr("x1",function(t){return e.scaleX(0)+.5}).attr("y1",0).attr("x2",function(t){return e.scaleX(0)+.5}).attr("y2",e.chartHeight),t.exit().remove(),{}},qe=function(e){return e.labelsRewriterX?(e.container.selectAll(".axis").selectAll("text").html(function(t,a){return e.labelsRewriterX(t,a,e)}),{}):{}},Ke=k.pipeline(Ee,Fe,Be,Pe,Oe,je,Re,Ue,We,qe,ze),Ve=function(t){var a,n,r=e.dispatch("click"),i=~~(1e4*Math.random()),l=k.throttle(function(){a.width=a.parent.clientWidth,o()},200);e.select(window).on("resize."+i,l);var o=function(){n=Ke(a)},s=function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return a=k.mergeAll({},a,{data:t}),o(),this},c=function(e){return a=k.mergeAll(a,e),o(),this},u=function(e,t){c(k.mergeAll(e,{events:t}))},d=function(){e.select(window).on("resize."+i,null),a.parent.innerHTML=null};return u(t,r),{on:k.rebind(r),setConfig:c,setData:s,destroy:d}},Je=function(t){var a=t.parent.querySelector(".datahub-vertical-chart");if(!a){var n='<div class="datahub-vertical-chart"><div class="header"></div><div class="chart-container"><div class="chart-wrapper"><svg><g class="panel"><g class="reference-bars"></g><g class="bars"></g><g class="axis"></g></g></svg></div></div><div class="number-container"></div></div>';a=k.appendHtmlToNode(n,t.parent)}var r=!(t.elements&&t.elements.length),i=e.select(a),l=i.select(".chart-container"),o=l.node().clientWidth,s=26,c=r?0:t.elements.length*s;return{container:i,chartWidth:o,chartHeight:c,rowHeight:s,dataIsEmpty:r,refernceValue:100}},_e=function(t){var a=e.scaleLinear().domain([0,100]).range([0,t.referenceBarSize]);return{scaleX:a}},Ge=function(e){return e.container.select(".header").html(e.title),{}},Ze=function(e){var t=e.container.select(".number-container").selectAll(".number").data(e.elements||[]),a=t.enter().append("div").merge(t).attr("class",function(e,t){return"number number"+t});t.exit().remove();var n=a.selectAll(".label").data(function(e){return[e]});n.enter().append("div").attr("class","label").merge(n).html(function(e){return e.label}),n.exit().remove();var r=a.selectAll(".value").data(function(e){return[e]});return r.enter().append("div").attr("class","value").merge(r).html(function(t){return Math.round(t.value)+" "+e.unit}),r.exit().remove(),{}},Qe=function(e){var t=e.container.select("svg").attr("width",e.chartWidth).attr("height",e.chartHeight).select(".panel"),a=e.rowHeight,n=a-2,r=n/2,i=t.select(".bars").selectAll(".bar").data(e.elements||[]);i.enter().append("rect").merge(i).attr("class",function(e,t){return["bar",e.label.toLowerCase(),"bar"+t].join(" ")}).attr("x",function(t){var a=e.scaleX(t.value);return 0>a?e.chartWidth/2-Math.abs(a):e.chartWidth/2}).attr("y",function(e,t){return a*t+(a-r)/2}).attr("width",function(t){return t.value?Math.abs(e.scaleX(t.value)):void 0}).attr("height",r),i.exit().remove();var l=t.select(".reference-bars").selectAll(".bar").data(e.elements||[]);l.enter().append("rect").attr("class","bar").merge(l).attr("x",e.chartWidth/2).attr("y",function(e,t){return a*t+(a-n)/2}).attr("width",function(t,a){return e.referenceBarSize}).attr("height",n),l.exit().remove();var o=t.select(".reference-bars").selectAll(".line").data(e.elements||[]);return o.enter().append("line").attr("class","line").merge(o).attr("x1",e.chartWidth/2+e.referenceBarSize).attr("y1",function(e,t){return a*t+(a-n)/2}).attr("x2",e.chartWidth/2+e.referenceBarSize).attr("y2",function(e,t){return a*t+(a-n)/2+n}),o.exit().remove(),{}},$e=function(e){var t=e.container.select(".axis").selectAll(".vertical").data([0]);return t.enter().append("line").attr("class","vertical").merge(t).attr("x1",e.chartWidth/2).attr("y1",0).attr("x2",e.chartWidth/2).attr("y2",e.chartHeight),t.exit().remove(),{}},et=k.pipeline(Je,Ge,Ze,_e,$e,Qe),tt=function(t){var a,n,r=e.dispatch("barHover"),i=~~(1e4*Math.random()),l=k.throttle(function(){a.width=a.parent.clientWidth,o()},200);e.select(window).on("resize."+i,l);var o=function(){n=et(a)},s=function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return a=k.mergeAll({},a,{data:t}),o(),this},c=function(e){return a=k.mergeAll(a,e),o(),this},u=function(e,t){c(k.mergeAll(e,{events:t}))},d=function(){e.select(window).on("resize."+i,null),a.parent.innerHTML=null};return u(t,r),{on:k.rebind(r),setConfig:c,setData:s,destroy:d}},at=function(t){var a=t.parent.querySelector(".datahub-waterfall-chart");if(!a){var n='<div class="datahub-waterfall-chart"><div class="chart-container"><svg><g class="panel"><g class="bars"></g><g class="connectors"></g></g></svg></div><div class="number-container"></div></div>';a=k.appendHtmlToNode(n,t.parent)}var r=!(t.elements&&t.elements.length),i=!(!r&&t.elements[0].value),l=e.select(a),o=l.select(".chart-container"),s=t.width||o.node().clientWidth,c=t.height||o.node().clientHeight||300,u=[1,3],d=[1];return{container:l,chartWidth:s,chartHeight:c,dataIsEmpty:i,infoIsEmpty:r,elements:t.elements||[],isConnected:u,isNegative:d}},nt=function(t){var a=e.scaleBand().domain(e.range(t.elements.length)).rangeRound([0,t.chartWidth]).paddingInner(.4).paddingOuter(.2);return{scaleX:a}},rt=function(t){var a=t.elements.map(function(e){return e.value}),n=e.scaleLinear().domain([0,e.max(a)]).range([0,t.chartHeight]);return{scaleY:n}},it=function(e){var t=e.container.select("svg").attr("width",e.chartWidth).attr("height",e.chartHeight).select(".panel");if(e.dataIsEmpty)return t.select(".bars").selectAll(".bar").remove(),{};var a=t.select(".bars").selectAll(".bar").data(e.elements);return a.enter().append("rect").merge(a).attr("class",function(e,t){return["bar",e.label.toLowerCase(),e.key,"bar"+t].join(" ")}).attr("x",function(t,a){return e.scaleX(a)}).attr("y",function(t,a){var n=e.isConnected.indexOf(a)>-1;if(n){var r=Math.max(0,a-1),i=e.elements[r];return e.isNegative.indexOf(a)>-1?e.chartHeight-e.scaleY(Math.abs(i.value)):e.chartHeight-e.scaleY(Math.abs(i.value))-e.scaleY(Math.abs(t.value))}return e.chartHeight-e.scaleY(Math.abs(t.value))}).attr("width",function(t){return t.value?e.scaleX.bandwidth():void 0}).attr("height",function(t){return e.scaleY(Math.abs(t.value))}),a.exit().remove(),{}},lt=function(e){if(e.dataIsEmpty)return e.container.select(".connectors").selectAll(".connector").remove(),{};var t=e.container.select(".connectors").selectAll(".connector").data(e.elements);t.enter().append("line").attr("class","connector").merge(t).attr("x1",function(t,a){return e.scaleX(a)}).attr("y1",function(t,a){var n=e.isConnected.indexOf(a)>-1;if(n){var r=Math.max(0,a-1),i=e.elements[r];return e.isNegative.indexOf(a)>-1?e.scaleY(Math.abs(t.value)):e.chartHeight-e.scaleY(Math.abs(i.value))-e.scaleY(Math.abs(t.value))}return e.chartHeight-e.scaleY(Math.abs(t.value))}).attr("x2",function(t,a){return e.scaleX(Math.min(a+1,e.elements.length-1))}).attr("y2",function(t,a){var n=e.isConnected.indexOf(a)>-1;if(n){var r=Math.max(0,a-1),i=e.elements[r];return e.isNegative.indexOf(a)>-1?e.chartHeight-e.scaleY(Math.abs(i.value))+e.scaleY(Math.abs(t.value)):e.chartHeight-e.scaleY(Math.abs(i.value))-e.scaleY(Math.abs(t.value))}return e.chartHeight-e.scaleY(Math.abs(t.value))}),t.exit().remove();var t=e.container.select(".connectors").selectAll(".base").data([0]);return t.enter().append("line").attr("class","base").merge(t).attr("x1",e.scaleX(0)).attr("y1",e.chartHeight).attr("x2",e.scaleX(Math.max(e.elements.length-1,0))+e.scaleX.bandwidth()||0).attr("y2",e.chartHeight),t.exit().remove(),{}},ot=function(e){var t=e.container.select(".number-container").selectAll(".number").data(e.elements),a=t.enter().append("div").merge(t).attr("class",function(e,t){return"number number"+t});t.exit().remove();var n=a.selectAll(".label").data(function(e){return[e]});n.enter().append("div").attr("class","label").merge(n).html(function(e){return e.label}),n.exit().remove();var r=a.selectAll(".value").data(function(e){return[e]});return r.enter().append("div").attr("class","value").merge(r).html(function(e){return"undefined"==typeof e.value?'<div class="error">(Data Unavailable)</div>':Math.round(e.value)}),r.exit().remove(),{}},st=k.pipeline(at,nt,rt,it,lt,ot),ct=function(t){var a,n,r=e.dispatch("barHover"),i=~~(1e4*Math.random()),l=k.throttle(function(){a.width=a.parent.clientWidth,o()},200);e.select(window).on("resize."+i,l);var o=function(){n=st(a)},s=function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return a=k.mergeAll({},a,{data:t}),o(),this},c=function(e){return a=k.mergeAll(a,e),o(),this},u=function(e,t){c(k.mergeAll(e,{events:t}))},d=function(){e.select(window).on("resize."+i,null),a.parent.innerHTML=null};return u(t,r),{on:k.rebind(r),setConfig:c,setData:s,destroy:d}},ut=function(t){var a=t.width-t.margin.left-t.margin.right,n=t.timeRange.map(function(e){return new Date(e)}),r=e.scaleTime().domain(n).range([0,a]);return{scaleX:r,sliderWidth:a}},dt=function(t){var a=t.height-t.margin.top-t.margin.bottom,n=t.axisXFormat||e.utcFormat("%b"),r=e.axisBottom().scale(t.scaleX).tickFormat(n).tickSize(a-12);return{axisX:r,sliderHeight:a}},mt=function(e){var t=e.container.selectAll("g.axis.x").data([0]);return t.enter().append("g").attr("class","x axis").attr("transform","translate("+[0,e.margin.top]+")").merge(t).transition().attr("transform","translate("+[0,e.margin.top]+")").call(e.axisX),t.exit().remove(),{}},ht=function(t){t.container.classed("datahub-button-group",!0);var a=e.dispatch("click"),n=t.container.selectAll(".element").data(t.elements),r=n.enter().append("div").on("click",function(e){var n=this,i=!1;r.classed("active",function(){return isAlreadyActive=this.classList.contains("active"),isTarget=n===this,isTarget&&isAlreadyActive&&t.isTogglable!==!1&&(i=!0),t.isExclusive?(!isAlreadyActive||isAlreadyActive&&t.isTogglable===!1)&&isTarget:isTarget?!isAlreadyActive:isAlreadyActive}),a.call("click",null,{selected:i?null:e})}).merge(n).attr("class",function(e){return"element "+(e.className||"")}).classed("active",function(e){return e.key===t.defaultElementKey}).html(function(e){return e.label});return n.exit().remove(),{events:a}},ft=function(t){t.container.classed("datahub-slider",!0);var a=e.dispatch("brush"),n=e.brushX().extent([[0,0],[t.sliderWidth,t.sliderHeight-12]]).handleSize(10).on("brush",function(){var n=e.event.selection,r={start:t.scaleX.invert(n[0]),end:t.scaleX.invert(n[1])};a.call("brush",null,{brushExtent:r})}),r=t.container.selectAll("g.brush").data([0]);r.enter().append("g").attr("class","brush").attr("transform","translate("+[0,t.margin.top]+")").merge(r).attr("transform","translate("+[0,t.margin.top]+")").call(n).call(n.move,t.scaleX.range());return r.exit().remove(),t.initialTimeRange,{events:a}},gt=function(t){function a(e){return i.title=e||i.title,s.select(".title").html(i.title),this}function n(e){return i.value=e||i.value,s.select(".value").html(i.value),this}function r(e){return i.info=e||i.info,s.select(".info").html(i.info),this}var i={title:t.title,value:t.value,info:t.info},l='<div class="datahub-number"><div class="title"></div><div class="value"></div><div class="info"></div></div>',o=k.appendHtmlToNode(l,t.parent),s=e.select(o).on("click",function(e){c.call("click",null,i)}),c=e.dispatch("click");return a(i.title),n(i.value),r(i.info),{on:k.rebind(c),setTitle:a,setValue:n,setInfo:r}},vt=function(t){function a(e){if(!e)return this;s.header=e,s.defaultSortKey=e[0].key;var t=o.select(".header-row").selectAll(".header-cell").data(e),a=t.enter().append("div").attr("class","header-cell").on("click",function(e,t){if(this.classList.contains("sortable")&&s.elements){var r=this,i=!1;a.classed("ascending",function(e){var t=r===this;return t&&(i=this.classList.contains("ascending"),t=!i),t}),n(s.elements,e.key,!i)}}).merge(t).classed("sortable",function(e){return e.sortable}).classed("ascending",function(e){return e.key===s.defaultSortKey}).html(function(e){return e.label});t.exit().remove()}function n(e,t,a){if(!e||!s.header)return this;s.elements=e;var n=t||s.defaultSortKey,i="undefined"==typeof a?!0:a,l=r(e,n,i),c=o.selectAll(".table-row").data(l),u=c.enter().append("div").attr("class","table-row").merge(c);c.exit().remove();var d=u.selectAll(".cell").data(function(e){return e});d.enter().append("div").attr("class","cell").merge(d).html(function(e){return e}),d.exit().remove()}function r(e,t,a){var n=s.header.map(function(e){return e.key}).indexOf(t),r=JSON.parse(JSON.stringify(e)).sort(function(e,t){return e[n]<t[n]?a?-1:1:e[n]>t[n]?a?1:-1:0});return r}var i='<div class="datahub-table"><div class="header-row"></div></div>',l=k.appendHtmlToNode(i,t.parent),o=e.select(l),s={elements:t.elements,header:t.header,defaultSortKey:t.header?t.header[0].key:null};return n(t.elements),a(t.header),{setHeader:a,setElements:n}},pt=function(t){function a(e){l.select(".alert-band").classed(e,!0)}function n(e){l.select(".alert-message").html(e)}var r='<div class="datahub-alert-message"><div class="alert-band"></div><div class="alert-message"></div></div>',i=k.appendHtmlToNode(r,t.parent),l=e.select(i);return a(t.level),n(t.message),{setLevel:a,setMessage:n}},xt=function(t){function a(){M.text(b.year),i()}function n(){A.classed("active",function(e){return e===b.month}),i()}function r(){w.call("change",null,l()),i()}function i(){w.call("update",null,l())}function l(){return{year:b.year,month:b.month,date:o(),iso:c(),formatted:s()}}function o(){return new Date(b.year,y.indexOf(b.month))}function s(t){var a=t||"%B %Y";return e.timeFormat(a)(o())}function c(t){return e.isoFormat(o())}function u(e){return b={month:y[new Date(e).getMonth()],year:new Date(e).getFullYear()},a(),n(),this}function d(e){return b.month=e,n(),this}function m(e){return b.year=e,a(),this}function h(){return y}function f(e){return b.month=y[e],n(),this}function g(){t.parent.innerHTML=null}var v='<div class="datahub-month-calendar"> <div class="year-selector">     <div class="prev-year">&lsaquo;</div>     <div class="selected-year"></div>     <div class="next-year">&rsaquo;</div> </div> <div class="month-selector"> </div></div>',p=k.appendHtmlToNode(v,t.parent),x=e.select(p),y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b={month:y[(new Date).getMonth()],year:(new Date).getFullYear()},w=e.dispatch("change","update"),M=x.select(".selected-year").text(b.year);x.select(".prev-year").on("click",function(e){b.year-=1,a(),r()}),x.select(".next-year").on("click",function(e){b.year+=1,a(),r()});var D=x.select(".month-selector").selectAll(".element").data(y),A=D.enter().append("div").attr("class","element month").text(function(e){return e}).on("click",function(e){var t=this;A.classed("active",function(){return t===this}),b.month=e,n(),r()}).merge(D).classed("active",function(e){return e===b.month});return t.defaultMonth&&t.defaultYear?(d(t.defaultMonth),m(t.defaultYear)):t.defaultMonthNumber&&t.defaultYear?(f(t.defaultMonthNumber),m(t.defaultYear)):u(t.defaultDate||new Date),r(),{on:k.rebind(w),getDateFormats:l,getDate:o,getISODate:c,getFormattedDate:s,setDate:u,setMonth:d,setYear:m,getMonthNames:h,setMonthNumber:f,destroy:g}},yt=function(t){function a(e){return f.html(e),s&&s.classed("active",function(t){return t.label===e}),this}function n(e){if(!e)return this;var n=m.selectAll(".element").data(e,function(e){return e.key});return s=n.enter().append("div").attr("class","element").on("mouseover",i).on("click",function(e){if(!t.ignoreClickEvents){var n=this;s.classed("active",function(){return n===this}),a(e.label),h.call("change",null,e),l()}}).merge(n).html(function(e){return e.label}),n.exit().remove(),a(t.selected||t.elements[0].label),this}function r(e){return m.classed("active",e),this}function i(){return r(!0),this}function l(){return r(!1),this}function o(){return m.classed("active")}var s,c='<div class="datahub-dropdown"> <div class="top">     <div class="title"></div>     <div class="selected-element"></div> </div> <div class="elements"></div></div>',u=k.appendHtmlToNode(c,t.parent),d=e.select(u),m=d.select(".elements"),h=e.dispatch("change");d.select(".title").html(t.title);var f=d.on("mouseover",function(){var e="ontouchstart"in document.documentElement,t=m.classed("active");t||e||i()}).on("mouseout",function(){var e=m.classed("active"),t="ontouchstart"in document.documentElement;e&&!t&&l()}).select(".top").on("click",function(){var e=m.classed("active");e?l():i()}).select(".selected-element");return n(t.elements),{on:k.rebind(h),toggle:r,open:i,close:l,isOpened:o,setElements:n,setSelected:a}},bt=function(t){var a=e.dispatch("change"),n=yt({parent:t.parent,ignoreClickEvents:!0}),r=xt({parent:t.parent.querySelector(".elements"),defaultDate:t.defaultDate,defaultMonthNumber:t.defaultMonthNumber,defaultYear:t.defaultYear,defaultMonth:t.defaultMonth}).on("change",function(e){a.call("change",null,e)}).on("update",function(e){n.setSelected(e.formatted)});return n.setSelected(r.getFormattedDate()),{on:k.rebind(a),toggle:n.toggle,open:n.open,close:n.close,isOpened:n.isOpened,setElements:n.setElements,setSelected:n.setSelected,getDateFormats:r.getDateFormats,getDate:r.getDate,getISODate:r.getISODate,getFormattedDate:r.getFormattedDate,setDate:r.setDate,setMonth:r.setMonth,setYear:r.setYear,getMonthNames:r.getMonthNames,setMonthNumber:r.setMonthNumber}},ft=k.pipeline(ut,dt,se.svgContainer,mt,ft),wt=k.pipeline(se.container,ht),kt={timeSlider:ft,buttonGroup:wt,number:gt,table:vt,alertMessage:pt,monthCalendar:xt,dropdown:yt,dropdownCalendar:bt},Mt=t.schemeSpectral||e.schemeSpectral,Dt=Mt[11].reverse(),At=function(t,a){var n=e.scaleQuantile().domain(t).range(e.range(a-1)).quantiles();return n.push(e.max(t)),n.unshift(e.min(t)),n},St=function(t,a){var n=At(t,a.length);return e.scaleLinear().domain(n).range(a)},Tt=function(t,a){var n=a||t.length,r=e.scaleLinear().domain([0,n-1]).range(t);return e.range(n).map(r)},Ct={grayscale:function(t){return e.scaleLinear().domain(e.extent(t)).range(["white","black"])},equalizedSpectral:function(e){return St(e,Dt)},equalizedGrayscale:function(e){return St(e,Tt(["white","black"],10))}},Yt=function(e){return{margin:e.margin||{right:20,left:20},unit:null,colorScale:e.colorScale||Ct.equalizedSpectral}},Nt=function(t){var a=t.parent.querySelector(".datahub-legend");if(!a){var n='<div class="datahub-legend"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="panel"><defs><linearGradient id="legend-gradient"></linearGradient></defs><rect class="color-band" fill="url(#legend-gradient)" /><g class="axis"></g><text class="unit"></text></g></svg></div>';a=k.appendHtmlToNode(n,t.parent)}var r=e.select(a),i=t.width||a.offsetWidth,l=t.height||a.offsetHeight;r.select("svg").attr("width",i).attr("height",l);var o=(r.select(".panel").attr("transform","translate("+t.margin.left+",0)"),i-t.margin.left-t.margin.right);return{container:r,width:i,height:l,legendWidth:o}},Xt=function(t){if(!t.data)return{};var a,n,r,i=t.colorScale(t.data);return n=i.domain(),r=e.range(0,n.length),a=t.colorScale(r),{legendColorScale:a,labelValues:n,colors:r}},Ht=function(e){if(!e.data)return{};var t=e.container.select("#legend-gradient").selectAll("stop").data(e.colors);return t.enter().append("stop").merge(t).attr("offset",function(t,a){return a*(100/(e.colors.length-1))+"%"}).attr("stop-color",function(t){return e.legendColorScale(t)}),t.exit().remove(),e.container.select(".color-band").attr("width",e.legendWidth).attr("height",e.height/2),{}},It=function(e){if(!e.data)return{};var t=e.container.select(".axis").selectAll("text.tick-label").data(e.labelValues),a=t.enter().append("text").classed("tick-label",!0).merge(t).attr("x",function(t,a){return a*(e.legendWidth/(e.labelValues.length-1))}).attr("y",.7*e.height).attr("dy","0.5em").text(function(e){return e.toPrecision(3)});t.exit().remove(),a.attr("dx",function(e,t){return-(this.getBBox().width/2)});var n=e.container.select(".axis").selectAll("line.tick-line").data(e.labelValues),r=n.enter().append("line").classed("tick-line",!0).merge(n).attr("x1",function(t,a){return a*(e.legendWidth/(e.labelValues.length-1))}).attr("y1",e.height/2).attr("x2",function(t,a){return a*(e.legendWidth/(e.labelValues.length-1))}).attr("y2",.55*e.height);return n.exit().remove(),r.attr("dx",function(e,t){return-(this.getBBox().width/2)}),e.unit&&e.container.select(".unit").attr("y",.95*e.height).text(e.unit),{}},Lt=k.pipeline(Yt,Nt,Xt,Ht,It),Et=function(t){var a,n,r=~~(1e4*Math.random()),i=k.throttle(function(){a.width=a.parent.clientWidth,l()},200);e.select(window).on("resize."+r,i);var l=function(){n=Lt(a)},o=function(e){var t=e?JSON.parse(JSON.stringify(e)):{};return a=k.mergeAll({},a),a.data=t,l(),this},s=function(e){return a=k.mergeAll(a,e),l(),this},c=function(e){s(k.mergeAll({},e))},u=function(){e.select(window).on("resize."+r,null),a.parent.innerHTML=null};return c(t),{setConfig:s,render:l,setData:o,destroy:u}},Ft=function(){var e=null,t=null,n=null,r=null,i=null,l=null,o=a.DomUtil.create("canvas","data-grid-layer");o.style.display="none",document.body.appendChild(o);var s={};return s.render=function(i){var l=i||r;if(r=l,!l)return s;var c=t.getBounds(),u=t.getPixelOrigin(),d=t.getPixelWorldBounds(),m=t.getSize(),h=m.y;t._zoom<m.y/512&&(h=d.max.y-d.min.y),console.log("Start rendering..."),console.time("render");var f=l.lat,g=l.lon,v=l.values;o.width=m.x,o.height=h;for(var p,x,y,b,w,M,D,A,S,T=o.getContext("2d"),C=Math.max(k.bisectionReversed(f,c.getNorth())-1,0),Y=Math.min(k.bisectionReversed(f,c.getSouth()),f.length-1),N=Math.max(k.bisection(g,c.getWest())-1,0),X=Math.min(k.bisection(g,c.getEast())+1,g.length-1),H=t.latLngToContainerPoint([f[C],g[Math.max(N,0)]]),I=t.latLngToContainerPoint([f[C],g[Math.min(N+1,g.length-1)]]),L=Math.ceil(Math.max(I.x-H.x,1))+2,E=T.getImageData(0,0,m.x,h),F=new ArrayBuffer(E.data.length),O=new Uint8ClampedArray(F),l=new Uint32Array(F),W=0;W<f.length;W++)if(!(C>W||W>Y)){D=Math.max(W,0),A=Math.min(D+1,f.length-1);for(var B=t.latLngToContainerPoint([f[D],g[N]]),P=t.latLngToContainerPoint([f[A],g[N]]),z=Math.ceil(Math.max(P.y-B.y,1)+1),j=0;j<g.length;j++)if(j>=N&&X>j&&(S=Math.max(j,0),w=t.latLngToContainerPoint([f[D],g[S]]),t._zoom<m.y/512&&(w.y=w.y+u.y-t._getMapPanePos().y),M=v[D][S],-999!==M&&null!==M&&!isNaN(M)&&W%1===0&&j%1===0))for(p=k.parseRGB(e(M)),y=0;L>y;y++)for(b=0;z>b;b++)x=(~~w.y+b-~~(z/2))*m.x+Math.min(Math.max(~~w.x+y-~~(L/2),0),m.x-1),l[x]=255<<24|p[2]<<16|p[1]<<8|p[0]}return E.data.set(O),T.putImageData(E,0,0),n&&n.removeFrom(t),n=a.imageOverlay(o.toDataURL("image/png"),c).addTo(t),n.setOpacity(.8),console.timeEnd("render"),s},s.setColorScale=function(t){return e=t,s},s.setData=function(e){return s.render(e),s},s.addTo=function(e){return t=e,t.on("moveend",function(e){var a=e.target._panes.overlayPane.querySelector("img");if(a){var n=a.style,r=n.transform;if(r){var o=r.match(/\((.*)\)/)[1].split(",").slice(0,2);n.transform="translate("+o+")"}}var c=e.target._zoom,u=c!==i;i=c;var d=t.getBounds(),m=JSON.stringify(d)!==JSON.stringify(l);l=d,(u||m)&&s.render()}),s},s},Ot=function(t){function n(e){a.marker(e,{interactive:!0}).on("click",function(e){r(),o(),c.call("markerClick",this,e)},this).addTo(m);o()}function r(){return m.clearLayers(),h._toolbars.draw._modes.rectangle.handler.disable(),h._toolbars.draw._modes.marker.handler.disable(),this}function i(e){return{type:"Feature",geometry:{type:"Polygon",coordinates:[e.concat([e[0]])]},properties:{}}}function l(e,t){var n=a.GeoJSON.geometryToLayer(e).on("click",function(e){m.removeLayer(this),t&&t(this),o()},this);return n.addTo(m),this}function o(){var e=m.getBounds();return e._southWest?u.fitBounds(e):u.fitWorld(),this}var s=Wt({parent:t.parent}).init(),c=e.dispatch("mapCloseClick","rectangleDraw","rectangleClick","markerClick","markerDraw","geojsonClick"),u=s._getMap();u.zoomControl.setPosition("bottomright");var d=a.Control.extend({position:"topright",onAdd:function(e){var t=a.DomUtil.create("a","map-close leaflet-bar leaflet-control leaflet-control-custom");return t.onclick=function(e){c.call("mapCloseClick",this,e)},t}});u.addControl(new d);var m=new a.FeatureGroup;u.addLayer(m);var h=new a.Control.Draw({edit:{featureGroup:m,edit:!1,remove:!1},draw:{polygon:!1,circle:!1,polyline:!1,marker:{icon:new a.Icon.Default,zIndexOffset:2e3,repeatMode:!0},rectangle:{shapeOptions:{fillColor:"#128DE0",color:"#128DE0",opacity:.5},repeatMode:!0}}});return u.addControl(h),u.on("draw:created",function(e){var t=e.layer;r();if("rectangle"===e.layerType&&(t.addTo(m).on("click",function(e){r(),o(),c.call("rectangleClick",this,e)},this),c.call("rectangleDraw",this,t.getBounds()),o()),"marker"===e.layerType){var a=t.getLatLng();n(a),c.call("markerDraw",this,a)}},this),s.addRectangle=function(e){r();var t=i(e);return l(t,function(){c.call("rectangleClick",this,arguments)}),o(),this},s.addPolygons=function(e){return r(),e.forEach(function(e){e[1].id=e[0];var t=a.GeoJSON.geometryToLayer(e[1]).on("click",function(t){m.removeLayer(this),c.call("geojsonClick",this,e),o()},this);t.addTo(m)}),o(),this},s.removeAllPolygons=r,s.zoomToBoundingBox=o,s.addMarker=n,s},Wt=function(t){function n(){a.Icon.Default.imagePath=p.imagePath,y=a.map(p.container,x).on("click",function(e){S.call("click",this,{lat:e.latlng.lat,lon:e.latlng.lng})}).on("mousedown",function(e){p.container.classList.add("grab")}).on("mouseup",function(e){p.container.classList.remove("grab")}).on("mousemove",function(e){if(D){var t=k.bisectionReversed(D.lat,e.latlng.lat),r=k.bisection(D.lon,e.latlng.lng),i=Math.max(t-1,0),l=D.lat[i]-D.lat[t];e.latlng.lat>D.lat[t]+l/2&&(t=i);var o=Math.max(r-1,0),s=D.lon[r]-D.lon[o];e.latlng.lng<D.lon[r]-s/2&&(r=o);var c=null;if(e.latlng.lat<=D.lat[0]&&e.latlng.lat>=D.lat[D.lat.length-1]&&e.latlng.lng>=D.lon[0]&&e.latlng.lng<=D.lon[D.lon.length-1]&&(c=D.values[t][r]),null!==c&&-999!==c&&p.showTooltip){var u=a.Util.formatNum(c,2);n.setTooltipContent(u+"").openTooltip([e.latlng.lat,e.latlng.lng])}else n.closeTooltip();S.call("mousemove",this,{x:e.containerPoint.x,y:e.containerPoint.y,value:c,lat:e.latlng.lat,lon:e.latlng.lng})}}).on("mouseover",function(e){S.call("mouseenter",this,arguments)}).on("mouseout",function(e){S.call("mouseleave",this,arguments)}),t.mapConfig&&t.mapConfig.zoom||y.fitWorld(),y.createPane("labels");var e={};e.basemapDark=a.tileLayer("https://api.mapbox.com/styles/v1/planetos/ciusdqjc200w12jmlg0dys640/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGxhbmV0b3MiLCJhIjoiZjZkNDE4MTE5NWNhOGYyMmZhZmNhMDQwMDg0YWMyNGUifQ.htlwo6U82iekTcpGtDR_dQ",{tileSize:256,maxZoom:19}),e.basemapLight=a.tileLayer("https://api.mapbox.com/styles/v1/planetos/civ28flwe002c2ino04a6jiqs/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGxhbmV0b3MiLCJhIjoiZjZkNDE4MTE5NWNhOGYyMmZhZmNhMDQwMDg0YWMyNGUifQ.htlwo6U82iekTcpGtDR_dQ",{tileSize:256,maxZoom:19}),e.labelLight=a.tileLayer("http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",{attribution:"©OpenStreetMap, ©CartoDB",pane:"labels"}),e[p.basemapName].addTo(y),p.showLabels&&e.labelLight.addTo(y),b=Ft().addTo(y);var n=a.featureGroup().bindTooltip("").addTo(y);return this}function r(e,t){var n=t.bbox,r=[[n.latMax,n.lonMin],[n.latMin,n.lonMax]];return a.imageOverlay(e,r).addTo(y),this}function i(){return p.container.style.display="block",T.isVisible=!0,this}function l(){return p.container.style.display="none",T.isVisible=!1,this}function o(){return y.invalidateSize(),A?s(A):y.fitWorld(),this}function s(e){var t=a.geoJson(e);return y.fitBounds(t.getBounds()),A=e,this}function c(e){var t=function(e,t){t.on({click:function(e){S.call("featureClicked",this,{id:e.target.feature.properties.id,lat:e.target._latlng?e.target._latlng.lat:e.latlng.lat,lon:e.target._latlng?e.target._latlng.lng:e.latlng.lng,layer:e})},mouseover:function(e,t,a){S.call("featureMousEnter",this,{x:e.containerPoint.x,y:e.containerPoint.y,lat:e.latlng.lat,lon:e.latlng.lng,value:e.target.feature.properties.id})},mouseout:function(e){S.call("featureMousLeave",this,{x:e.containerPoint.x,y:e.containerPoint.y,lat:e.latlng.lat,lon:e.latlng.lng,value:e.target.feature.properties.id})}})};return w=a.geoJson(e,{onEachFeature:t,pointToLayer:function(e,t){return new a.CircleMarker(t,{radius:4,fillColor:"#05A5DE",color:"#1E1E1E",weight:1,opacity:.5,fillOpacity:.4})}}).addTo(y),p.polygonTooltipFunc&&w.bindTooltip(p.polygonTooltipFunc),this}function u(e){return d(),M=a.marker(e,{interactive:!0,draggable:!0,opacity:1}).on("click",function(e){S.call("markerClicked",this,arguments)}).addTo(y),this}function d(){return M&&M.remove(),this}function m(e){D=e;var t=e.uniqueValues.sort(function(e,t){return e-t}),a=p.colorScale(t);return b.setColorScale(a).setData(e),this}function h(e){return e?(y.addControl(y.zoomControl),y.doubleClickZoom.enable(),y.boxZoom.enable(),y.dragging.enable()):(y.removeControl(y.zoomControl),y.doubleClickZoom.disable(),y.boxZoom.disable(),y.dragging.disable()),this}function f(){return z.getWorldVector(function(e){c(e)}),this}var g=a.DomUtil.create("div","datahub-map"),v=t.parent.appendChild(g),p={container:v,colorScale:t.colorScale,basemapName:t.basemapName||"basemapDark",imagePath:t.imagePath||"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/images/",showLabels:!(t.showLabels===!1),showTooltip:!(t.showTooltip===!1),polygonTooltipFunc:t.polygonTooltipFunc},x={maxBounds:[[-90,-180],[90,180]],maxZoom:13,minZoom:1,scrollWheelZoom:!1,zoomSnap:0,zoomDelta:.5,attributionControl:!1,fadeAnimation:!1,tileLayer:{noWrap:!0,continuousWorld:!1}};k.merge(x,t.mapConfig);var y,b,w,M,D,A,S=e.dispatch("click","mousemove","mouseenter","mouseleave","featureClicked","featureMousEnter","featureMousLeave","markerClicked"),T={isVisible:!0};return{init:n,show:i,hide:l,resize:o,zoomToPolygonBoundingBox:s,addMarker:u,removeMarker:d,renderPolygon:c,renderImage:r,renderRaster:m,renderVectorMap:f,isVisible:T.isVisible,hideZoomControl:h,on:k.rebind(S),_getMap:function(){return y}}},Bt={rasterMap:Wt,selectorMap:Ot},Pt={palette:Ct,colorLegend:Et,map:Bt,widget:kt,multiChart:Le,tableChart:Ve,verticalChart:tt,waterfallChart:ct,common:se,utils:k,data:z};return Pt});