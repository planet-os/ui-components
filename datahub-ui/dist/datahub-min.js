!function(t,e){var a=t="object"==typeof t?t:{},n="object"==typeof e?e:window;if("object"==typeof module&&module.exports){n.d3=require("d3");try{n.colorBrewer=require("d3-scale-chromatic")}catch(r){n.colorBrewer=null}try{n.leaflet=require("leaflet")}catch(r){n.leaflet=null}}else n.d3=n.d3,n.colorBrewer=n.d3,n.leaflet=n.L;!function(t){var e=function(t,a){for(var n in a)a[n]&&a[n].constructor==Object&&t[n]?e(t[n],a[n]):t[n]=a[n]},a=function(t,e){for(var a=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(a[i]=r[i])}return a},n=function(t,e){for(;e.lastChild;)e.removeChild(e.lastChild);return r(t,e)},r=function(t,e){return e.appendChild(document.importNode((new DOMParser).parseFromString(t,"text/html").body.childNodes[0],!0))},i=function(t,e){var a;return function(){return t&&(a=t.apply(e||this,arguments),t=null),a}},l=function(t,e){var a=!1,n=null;return function(){var r=this;a||(a=!0,clearTimeout(n),n=setTimeout(function(){a=!1,t.apply(r,arguments)},e))}},o=function(t,e){var a,n,r,i,l=[],o=[],s=Number.MAX_VALUE,c=Number.MIN_VALUE,u={};for(r=0;r<t.length;r++)for(a=t[r],i=0;i<a.length;i++)n=e?e(a[i]):a[i],l.push(n),u.hasOwnProperty(n)||null===n||(u[n]=1,n>c&&(c=n),s>n&&(s=n));return o=Object.keys(u).map(function(t,e){return+t}),{flattened:l,uniques:o,max:c,min:s}},s=function(t,e){return o(t,e).uniques},c=function(t,e){return o(t,e).flattened},u=function(t,e,a){for(var n,r=0,i=t.length-1;i>r;)n=r+i>>1,a&&e>=t[n]||!a&&e<t[n]?i=n:r=n+1;return r},d=function(t,e){return u(t,e,!0)},m=function(t){var e,a=0,n=t.length;for(e=0;n>e;e++)t[e]>a&&(a=t[e]);return a},h=function(t){var e,a=1/0,n=t.length;for(e=0;n>e;e++)t[e]<a&&(a=t[e]);return a},f=function(t){return t.slice(4).slice(0,-1).split(",").map(function(t,e){return parseInt(t)})},v=function(){var t=arguments,e=this;return function(a){for(var n=0;n<t.length;n++){var r=t[n].call(this,a);a=e.mergeAll(a,r)}return a}},p=function(t,e){for(var a in e)a in t&&(t[a]=e[a])},g=function(t){return function(){return t.on.apply(t,arguments),this}},x=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},y=function(t,e){var a=e?"min":"max";return t?d3[a](t.map(function(t){return t.value})):null},b=function(t,e){var a=e?"min":"max";if(t&&t.length){var n=t.map(function(t){return d3.sum(t.value)});return d3[a](n)}return null},w=function(t,e){var a=e?"min":"max";if(t&&t.length){var n=t.map(function(t,e){return t.value});return n[0].length&&(n=d3.merge(n)),d3[a](n)}return null};t.utils={merge:e,mergeAll:a,htmlToNode:n,appendHtmlToNode:r,once:i,throttle:l,arrayStats:o,arrayUniques:s,arrayFlatten:c,bisection:u,bisectionReversed:d,findMax:m,findMin:h,parseRGB:f,pipeline:v,override:p,rebind:g,capitalize:x,getExtent:y,getStackExtent:b,getMultiExtent:w}}(a),!function(t,e){var a=function(t){var a=e.utcFormat("%b %e, %Y at %H:%M UTC"),n="";if(!t.dataIsEmpty){var r=function(t){return t%1?~~(100*t)/100:t},i=[],l=e.extent(t.timestamps),o=l[0],s=l[1];o.getTime()===s.getTime()&&o.getUTCMonth()===s.getUTCMonth()||i.push("%b %e"),o.getYear()!==s.getYear()&&i.push("%Y"),o.getYear()===s.getYear()&&o.getUTCHours()!==s.getUTCHours()&&i.push("%H:%M"),n=e.utcFormat(i.join(" "))}return{axisXFormat:n,axisTitleXFormat:function(t){return a(t.data.x)},tooltipFormat:function(t){return r(t.data.y)}}},n=function(t){var e={top:50,right:50,bottom:100,left:50};return{margin:t.margin||e,width:t.width||600,height:t.height||300}},r=function(t){return t.dataConverted.sort(function(t,e){var a=t.x.getTime(),n=e.x.getTime();return n>a?-1:a>n?1:0}),{}},i=function(t){var e=!t.flattenedData.filter(function(t){return null!=t.y}).length;return{dataIsAllNulls:e}},l=function(t){var a=t.axisXFormat||"%b",n=e.utcFormat(a)||function(t){return t.toString()},r=e.axisBottom().scale(t.scaleX).tickFormat(n);return{axisX:r}},o=function(t){var a=t.axisYFormat||".2s",n=e.format(a),r=t.scaleY.range()[0],i=e.axisLeft().scale(t.scaleY).ticks(Math.max(~~(r/30),2)).tickPadding(10).tickFormat(n).tickSize(-t.chartWidth);return{axisY:i}},s=function(t){var a=t.container.selectAll("g.axis.x").data([0]),n=a.enter().append("g").attr("class","x axis").attr("transform","translate("+[0,t.chartHeight]+")").merge(a).attr("display",function(e){return t.dataIsEmpty?"none":null}).attr("transform","translate("+[0,t.chartHeight]+")");n.call(t.axisX),a.exit().remove();var r=[],i=(n.selectAll(".tick").select("text").each(function(t,e){var a=this.getBBox().width;a&&r.push(a)}),Math.floor(e.max(r)/t.stripeScaleX.bandwidth()));return i&&n.selectAll(".tick text").attr("display",function(t,e){return e%(i+1)?"none":"block"}),{}},c=function(t){var e=t.axisYPadding||0,a=t.container.selectAll("g.axis.y").data([0]);return a.enter().append("g").attr("class","y axis").attr("transform","translate("+[-e/2,0]+")").merge(a).call(t.axisY).attr("text-anchor","start").selectAll("text").attr("dx",-t.margin.left+10),a.exit().remove(),{}},u=function(t){var e=t.container.selectAll("text.axis-title.x").data([0]);return e.enter().append("text").attr("class","x axis-title").merge(e).text(t.axisTitleX||"").attr("x",t.chartWidth).attr("y",t.chartHeight),e.exit().remove(),{axisTitleXComponent:l}},d=function(t){var e=t.container.selectAll("text.axis-title.y").data([0]);e.enter().append("text").attr("class","y axis-title").merge(e).text(t.axisTitleY||"").attr("x",-t.margin.left).attr("y",-10).attr("text-anchor","start");return e.exit().remove(),{}},m=function(t){var e=t.container.selectAll("text.chart-title").data([t.chartTitle||""]);return e.enter().append("text").attr("class","chart-title").merge(e).html(function(t){return t}).attr("x",function(e){return(t.chartWidth-5*e.length)/2}).attr("y",-5),e.exit().remove(),{}},h=function(t){var e=t.container.selectAll("g.shapes").data([0]),a=e.enter().append("g").attr("class","shapes").merge(e);return e.exit().remove(),{shapePanel:a}},f=function(t){var a=e.select(t.parent).selectAll("div.widget-container").data([0]),n=a.enter().append("div").attr("class","widget-container").merge(a).attr("width",t.width).attr("height",t.height);return a.exit().remove(),{container:n}},v=function(t){var e=f(t).container,a=e.selectAll("svg").data([0]),n=a.enter().append("svg").attr("class","datahub-chart"),r=n.append("g").attr("class","panel").merge(a).attr("transform","translate("+t.margin.left+","+t.margin.top+")");return n.merge(a).attr("width",t.width).attr("height",t.height),a.exit().remove(),{root:a,container:r}},p=function(t){var e="";t.dataIsEmpty?e="(Data Unavailable)":t.dataIsAllNulls&&(e="Values are all null");var a=t.container.select(".message-group").selectAll("text").data([e]);return a.enter().append("text").merge(a).attr("x",(t.scaleX.range()[1]-t.scaleX.range()[0])/2).attr("y",function(){return t.height/2-this.getBBox().height/2}).text(function(t){return t}).attr("dx",function(t){return-this.getBBox().width/2}),a.exit().remove(),{}},g=function(t){return t.container.select("g.axis.x").selectAll(".tick text").text(function(t){return e.timeFormat("%a")(t)}),{}},x=function(t){return t.container.select("g.axis.x").selectAll(".tick text").text(function(t){return e.timeFormat("%x")(t)}),{}},y=function(t){return t.container.select("g.axis.x").selectAll(".tick text").style("transform","rotate(30deg)").style("text-anchor","start"),{}},b=function(t){return config.axisY.tickFormat(e.format(".2s")),{}},w=function(t){return t.labelsRewriterY?(t.container.selectAll("g.axis.y").selectAll("text").html(function(e,a){return t.labelsRewriterY(e,a,t)}),{}):{}},A=function(t){console.warn(t)};t.common={axesFormatAutoconfig:a,defaultConfig:n,sortData:r,detectDataAllNulls:i,axisX:l,axisY:o,axisComponentX:s,axisComponentY:c,axisTitleComponentX:u,axisTitleComponentY:d,chartTitleComponent:m,shapePanel:h,svgContainer:v,container:f,message:p,axisXFormatterTime:g,axisXFormatterTimeHour:x,axisXFormatterRotate30:y,axisYFormatSI:b,labelsRewriterY:w,printer:A}}(a,n.d3),!function(t,e){function n(t){if(t)return!0;throw"You need to set an API key using `datahub.data.setApiKey(API_KEY)`. You can get yours at http://data.planetos.com/"}var r={currentBaseURI:"https://data.planetos.com/",baseURI:"https://api.planetos.com/v1a/",datasetsEndpoint:"https://api.planetos.com/v1/datasets/",apiKey:null},i=function(t){return r.apiKey=t,this},l=function(){return{type:"Feature",properties:{name:""},geometry:{type:"LineString",coordinates:[[-170,80],[170,80],[170,-80],[-170,-80],[-170,80]]}}},o=function(){var t=m(50,function(t,e){return{coordinates:[360*Math.random()-180,180*Math.random()-90],id:"random-point-"+e}});return c(t)},s=function(t){return Math.random().toString(36).substring(4,t+4||8)},c=function(t){return{type:"FeatureCollection",features:t.map(function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:{id:t.id}}})}},u=function(t){var e="https://cdn.rawgit.com/johan/world.geo.json/master/countries.geo.json";g(e,function(e,a){t(a)})},d=function(){var e={lon:m(360,function(t,e){return e-180}),lat:m(180,function(t,e){return 180-e-90}),values:m(180,function(t,e){return m(360,function(t,e){return~~(100*Math.random())})})};return e.uniqueValues=t.utils.arrayUniques(e.values),e},m=function(t,e){var a=e||function(t,e){return 0};return Array.apply(null,Array(t)).map(a)},h=function(t){var t=t||{},e={count:t.count||12,layerCount:t.layerCount||1,timeStart:t.timeStart||"2016-01-01",timeIncrement:t.timeIncrement||"month",step:t.step||1,min:t.min||0,max:t.max||100},a=~~(Math.random()*(e.max-e.min))+e.min,n=m(e.count,function(){return m(e.layerCount,function(t){return a+=(2*Math.random()-1)*((e.max-e.min)/10),a=Math.max(a,e.min)})}),r=v(e),i=r.map(function(t,e){return{timestamp:t,value:n[e],id:n[e].map(function(t){return~~(1e3*Math.random())}),className:n[e].map(function(t){return Math.random().toString(36).substring(4,8)})}});return i},f=function(t){var t=t||{},e={count:t.count||12,layerCount:t.layerCount||1,timeStart:t.timeStart||"2016-01-01",timeIncrement:t.timeIncrement||"month",step:t.step||1,min:t.min||0,max:t.max||100},a=~~(Math.random()*(e.max-e.min))+e.min,n=m(e.layerCount,function(){var t={},n=v(e);return t.data=m(e.count,function(t,r){return a+=(2*Math.random()-1)*((e.max-e.min)/10),a=Math.max(a,e.min),a=Math.min(a,e.max),{value:a,timestamp:n[r]}}),t.metadata={id:s(8)},t});return n},v=function(a){var a=a||{},n={count:a.count||12,layerCount:a.layerCount||1,timeStart:a.timeStart||"2016-01-01",timeIncrement:a.timeIncrement||"month",step:a.step||1,min:a.min||0,max:a.max||100},r="utc"+t.utils.capitalize(n.timeIncrement)||"utcHour",i=e[r],l=e[r+"s"],o=n.timeStart?new Date(n.timeStart):new Date,s=i.offset(o,n.count*n.step),c=l(o,s,n.step),u=c.map(function(t,a){return e.isoFormat(t)});return u},p=function(){var t={layerCount:1,count:10,timeIncrement:"minute",min:0,max:50},e=a.utils.mergeAll({},t,{layerCount:1,count:100,timeIncrement:"hour"}),n={historical:{wind:a.data.generateTimeSeriesSplit(t),windDirection:a.data.generateTimeSeriesSplit(t),wave:a.data.generateTimeSeriesSplit(t),tide:a.data.generateTimeSeriesSplit(t),bottomAxis:a.data.generateTimeSeriesSplit(t),topAxis:a.data.generateTimeSeriesSplit(t)},forecast:{wind:a.data.generateTimeSeriesSplit(e),windDirection:a.data.generateTimeSeriesSplit(e),wave:a.data.generateTimeSeriesSplit(e),tide:a.data.generateTimeSeriesSplit(e),bottomAxis:a.data.generateTimeSeriesSplit(e),topAxis:a.data.generateTimeSeriesSplit(e)}};return n},g=function(t,e){var a="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("get",t,!0),a.onreadystatechange=function(){var t,n;4==a.readyState&&(t=a.status,200==t?(n=JSON.parse(a.responseText),e(null,n)):e(t))},a.send()},x=function(t,e){n(r.apiKey);var a=r.baseURI+"/datasets/"+t+"?apikey="+r.apiKey;return console.log("get dataset details",a),g(a,function(t,a){if(void 0===a)return console.log("Can not render dataset because of API error",t),!1;var n=a.FeatureType||"timeseries",r="grid"===n.toLowerCase().trim()?"raster":"timeseries";console.log("Data type:",r,a.ProductType,a.FeatureType,a),e({datasetInfo:a,dataType:r,productType:a.ProductType})}),this},y=function(t,e,a){n(r.apiKey);var i=r.baseURI+"/datasets/"+t+"/variables?apikey="+r.apiKey;return console.log("query variables",i),g(i,function(n,r){var i,l=r[t],o=e;o&&(i=l.filter(function(t){return t.name===o})[0]);var s=i||l[0];a({variables:l,defaultVariable:s})}),this},b=function(t,e,a){n(r.apiKey);var i=r.baseURI+"/datasets/"+t+"/variables/"+encodeURIComponent(e)+"/timestamps?apikey="+r.apiKey;return console.log("query timestamps",i),g(i,function(t,e){if(t)return void console.log("Server error",t);var n=e.map(function(t){return new Date(parseInt(t))});a({timestamps:n})}),this},w=function(e,a,i,l){n(r.apiKey);var o=r.baseURI+"/datasets/"+e+"/variables/"+encodeURIComponent(a);return i&&(o+="/timestamps/"+i),o+="/sample_data",o+="?apikey="+r.apiKey,console.log("query dataset",o),g(o,function(n,i){if(n)return void console.log("Server error",n);i.values=i.values.map(function(t,e){return t.map(function(t){return-999===t?null:t})}),i.uniqueValues=t.utils.arrayUniques(i.values).sort();var s=r.currentBaseURI+"/datasets/"+e+"?variable="+a;l({json:i,uri:o,datahubLink:s})}),this},A=function(t,e){n(r.apiKey);var a=r.datasetsEndpoint+t+"/stations?apikey="+r.apiKey;return console.log("get stations",a),g(a,function(t,a){if(t)return void console.log("Server error",t);var n=[];for(var r in a.station){var i=a.station[r];void 0!==i.SpatialExtent&&n.push({id:r,coordinates:i.SpatialExtent.coordinates})}e({stations:n,defaultStation:n[0]})}),this},k=function(t,e,a,i,l){n(r.apiKey);var o=500,s=r.datasetsEndpoint+t+"/stations/"+e+"?apikey="+r.apiKey+"&verbose=true&count="+o;return i||(s+="&time_order=desc"),console.log("station variable",s),g(s,function(e,n){if(e)return void console.log("Server error",e);console.log("Point API data",n,s);var i,o,c={},u=n.metadata.contexts;for(var d in u){i=u[d].dataVariables;for(var m in i)o=i[m],o.key=m,c[m]=o}var h={};n.entries.forEach(function(t){for(var e in t.data)h[e]||(h[e]={values:[],timestamps:[]}),h[e].values.push(t.data[e]),h[e].timestamps.push(new Date(t.axes.time))});var f=[];for(var v in c)f.push(c[v]);var p=r.currentBaseURI+"/datasets/"+t+"?variable="+a;l({datasets:h,variablesMetadata:c,variables:f,datahubLink:p,variableData:h[a],variableMetadata:c[a]})}),this},M=function(t,e,a,i,l){n(r.apiKey);var o=r.baseURI+"/datasets/"+t+"/variables/"+encodeURIComponent(e);return a&&(o+="/timestamps/"+a),o+="/image",o+="?width="+i+"&projection=mercator",o+="&apikey="+r.apiKey,console.log("query image",o),g(o,function(t,e){l(e.img,e.metadata)}),this};t.data={generateRaster:d,generateGeojson:l,generateTimeSeries:h,generateTimeSeriesSplit:f,generateTimestamps:v,generateWeatherChartData:p,getDatasetDetails:x,getVariables:y,getTimestamps:b,getPreview:w,getStations:A,getStationVariables:k,getImage:M,getJSON:g,apiConfig:r,pointsToFeatures:c,generateGeojsonPoints:o,getWorldVector:u,setApiKey:i}}(a,n.d3),!function(t,e){var a=function(t){var a=t.width-t.margin.left-t.margin.right,n=t.timeRange.map(function(t){return new Date(t)}),r=e.scaleTime().domain(n).range([0,a]);return{scaleX:r,sliderWidth:a}},n=function(t){var a=t.height-t.margin.top-t.margin.bottom,n=t.axisXFormat||e.utcFormat("%b"),r=e.axisBottom().scale(t.scaleX).tickFormat(n).tickSize(a-12);return{axisX:r,sliderHeight:a}},r=function(t){var e=t.container.selectAll("g.axis.x").data([0]);return e.enter().append("g").attr("class","x axis").attr("transform","translate("+[0,t.margin.top]+")").merge(e).transition().attr("transform","translate("+[0,t.margin.top]+")").call(t.axisX),e.exit().remove(),{}},i=function(t){t.container.classed("datahub-button-group",!0);var a=e.dispatch("click"),n=t.container.selectAll(".element").data(t.elements),r=n.enter().append("div").on("click",function(e){var n=this,i=!1;r.classed("active",function(){return isAlreadyActive=this.classList.contains("active"),isTarget=n===this,isTarget&&isAlreadyActive&&t.isTogglable!==!1&&(i=!0),t.isExclusive?(!isAlreadyActive||isAlreadyActive&&t.isTogglable===!1)&&isTarget:isTarget?!isAlreadyActive:isAlreadyActive}),a.call("click",null,{selected:i?null:e})}).merge(n).attr("class",function(t){return"element "+(t.className||"")}).classed("active",function(e){return e.key===t.defaultElementKey}).html(function(t){return t.label});return n.exit().remove(),{events:a}},l=function(t){t.container.classed("datahub-slider",!0);var a=e.dispatch("brush"),n=e.brushX().extent([[0,0],[t.sliderWidth,t.sliderHeight-12]]).handleSize(10).on("brush",function(){var n=e.event.selection,r={start:t.scaleX.invert(n[0]),end:t.scaleX.invert(n[1])};a.call("brush",null,{brushExtent:r})}),r=t.container.selectAll("g.brush").data([0]);r.enter().append("g").attr("class","brush").attr("transform","translate("+[0,t.margin.top]+")").merge(r).attr("transform","translate("+[0,t.margin.top]+")").call(n).call(n.move,t.scaleX.range());return r.exit().remove(),t.initialTimeRange,{events:a}},o=function(a){function n(t){return l.title=t||l.title,c.select(".title").html(l.title),this}function r(t){return l.value=t||l.value,c.select(".value").html(l.value),this}function i(t){return l.info=t||l.info,c.select(".info").html(l.info),this}var l={title:a.title,value:a.value,info:a.info},o='<div class="datahub-number"><div class="title"></div><div class="value"></div><div class="info"></div></div>',s=t.utils.appendHtmlToNode(o,a.parent),c=e.select(s).on("click",function(t){u.call("click",null,l)}),u=e.dispatch("click");return n(l.title),r(l.value),i(l.info),{on:t.utils.rebind(u),setTitle:n,setValue:r,setInfo:i}},s=function(a){function n(t){if(!t)return this;c.header=t,c.defaultSortKey=t[0].key;var e=s.select(".header-row").selectAll(".header-cell").data(t),a=e.enter().append("div").attr("class","header-cell").on("click",function(t,e){if(this.classList.contains("sortable")&&c.elements){var n=this,i=!1;a.classed("ascending",function(t){var e=n===this;return e&&(i=this.classList.contains("ascending"),e=!i),e}),r(c.elements,t.key,!i)}}).merge(e).classed("sortable",function(t){return t.sortable}).classed("ascending",function(t){return t.key===c.defaultSortKey}).html(function(t){return t.label});e.exit().remove()}function r(t,e,a){if(!t||!c.header)return this;c.elements=t;var n=e||c.defaultSortKey,r="undefined"==typeof a?!0:a,l=i(t,n,r),o=s.selectAll(".table-row").data(l),u=o.enter().append("div").attr("class","table-row").merge(o);o.exit().remove();var d=u.selectAll(".cell").data(function(t){return t});d.enter().append("div").attr("class","cell").merge(d).html(function(t){return t}),d.exit().remove()}function i(t,e,a){var n=c.header.map(function(t){return t.key}).indexOf(e),r=JSON.parse(JSON.stringify(t)).sort(function(t,e){return t[n]<e[n]?a?-1:1:t[n]>e[n]?a?1:-1:0});return r}var l='<div class="datahub-table"><div class="header-row"></div></div>',o=t.utils.appendHtmlToNode(l,a.parent),s=e.select(o),c={elements:a.elements,header:a.header,defaultSortKey:a.header?a.header[0].key:null};return r(a.elements),n(a.header),{setHeader:n,setElements:r}},c=function(a){function n(t){o.select(".alert-band").classed(t,!0)}function r(t){o.select(".alert-message").html(t)}var i='<div class="datahub-alert-message"><div class="alert-band"></div><div class="alert-message"></div></div>',l=t.utils.appendHtmlToNode(i,a.parent),o=e.select(l);return n(a.level),r(a.message),{setLevel:n,setMessage:r}},u=function(a){function n(){k.text(w.year),l()}function r(){D.classed("active",function(t){return t===w.month}),l()}function i(){A.call("change",null,o()),l()}function l(){A.call("update",null,o())}function o(){return{year:w.year,month:w.month,date:s(),iso:u(),formatted:c()}}function s(){return new Date(w.year,b.indexOf(w.month))}function c(t){var a=t||"%B %Y";return e.timeFormat(a)(s())}function u(t){return e.isoFormat(s())}function d(t){return w={month:b[new Date(t).getMonth()],year:new Date(t).getFullYear()},n(),r(),this}function m(t){return w.month=t,r(),this}function h(t){return w.year=t,n(),this}function f(){return b}function v(t){return w.month=b[t],r(),this}function p(){a.parent.innerHTML=null}var g='<div class="datahub-month-calendar"> <div class="year-selector">     <div class="prev-year">&lsaquo;</div>     <div class="selected-year"></div>     <div class="next-year">&rsaquo;</div> </div> <div class="month-selector"> </div></div>',x=t.utils.appendHtmlToNode(g,a.parent),y=e.select(x),b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],w={month:b[(new Date).getMonth()],year:(new Date).getFullYear()},A=e.dispatch("change","update"),k=y.select(".selected-year").text(w.year);y.select(".prev-year").on("click",function(t){w.year-=1,n(),i()}),y.select(".next-year").on("click",function(t){w.year+=1,n(),i()});var M=y.select(".month-selector").selectAll(".element").data(b),D=M.enter().append("div").attr("class","element month").text(function(t){return t}).on("click",function(t){var e=this;D.classed("active",function(){return e===this}),w.month=t,r(),i()}).merge(M).classed("active",function(t){return t===w.month});return a.defaultMonth&&a.defaultYear?(m(a.defaultMonth),h(a.defaultYear)):a.defaultMonthNumber&&a.defaultYear?(v(a.defaultMonthNumber),h(a.defaultYear)):d(a.defaultDate||new Date),i(),{on:t.utils.rebind(A),getDateFormats:o,getDate:s,getISODate:u,getFormattedDate:c,setDate:d,setMonth:m,setYear:h,getMonthNames:f,setMonthNumber:v,destroy:p}},d=function(a){function n(t){return v.html(t),c&&c.classed("active",function(e){return e.label===t}),this}function r(t){if(!t)return this;var e=h.selectAll(".element").data(t,function(t){return t.key});return c=e.enter().append("div").attr("class","element").on("mouseover",l).on("click",function(t){if(!a.ignoreClickEvents){var e=this;c.classed("active",function(){return e===this}),n(t.label),f.call("change",null,t),o()}}).merge(e).html(function(t){return t.label}),e.exit().remove(),n(a.selected||a.elements[0].label),this}function i(t){return h.classed("active",t),this}function l(){return i(!0),this}function o(){return i(!1),this}function s(){return h.classed("active")}var c,u='<div class="datahub-dropdown"> <div class="top">     <div class="title"></div>     <div class="selected-element"></div> </div> <div class="elements"></div></div>',d=t.utils.appendHtmlToNode(u,a.parent),m=e.select(d),h=m.select(".elements"),f=e.dispatch("change");m.select(".title").html(a.title);var v=m.on("mouseover",function(){var t="ontouchstart"in document.documentElement,e=h.classed("active");e||t||l()}).on("mouseout",function(){var t=h.classed("active"),e="ontouchstart"in document.documentElement;t&&!e&&o()}).select(".top").on("click",function(){var t=h.classed("active");t?o():l()}).select(".selected-element");return r(a.elements),{on:t.utils.rebind(f),toggle:i,open:l,close:o,isOpened:s,setElements:r,setSelected:n}},m=function(a){var n=e.dispatch("change"),r=d({parent:a.parent,ignoreClickEvents:!0}),i=u({parent:a.parent.querySelector(".elements"),defaultDate:a.defaultDate,defaultMonthNumber:a.defaultMonthNumber,defaultYear:a.defaultYear,defaultMonth:a.defaultMonth}).on("change",function(t){n.call("change",null,t)}).on("update",function(t){r.setSelected(t.formatted)});return r.setSelected(i.getFormattedDate()),{on:t.utils.rebind(n),toggle:r.toggle,open:r.open,close:r.close,isOpened:r.isOpened,setElements:r.setElements,setSelected:r.setSelected,getDateFormats:i.getDateFormats,getDate:i.getDate,getISODate:i.getISODate,getFormattedDate:i.getFormattedDate,setDate:i.setDate,setMonth:i.setMonth,setYear:i.setYear,getMonthNames:i.getMonthNames,setMonthNumber:i.setMonthNumber}},l=t.utils.pipeline(a,n,t.common.svgContainer,r,l),h=t.utils.pipeline(t.common.container,i);t.widget={timeSlider:l,buttonGroup:h,number:o,table:s,alertMessage:c,monthCalendar:u,dropdown:d,dropdownCalendar:m}}(a,n.d3),!function(t,e){var a=function(t){return{margin:t.margin||{right:20,left:20},unit:null,colorScale:t.colorScale||palette.equalizedSpectral}},n=function(a){var n=a.parent.querySelector(".datahub-legend");if(!n){var r='<div class="datahub-legend"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="panel"><defs><linearGradient id="legend-gradient"></linearGradient></defs><rect class="color-band" fill="url(#legend-gradient)" /><g class="axis"></g><text class="unit"></text></g></svg></div>';n=t.utils.appendHtmlToNode(r,a.parent)}var i=e.select(n),l=a.width||n.offsetWidth,o=a.height||n.offsetHeight;i.select("svg").attr("width",l).attr("height",o);var s=(i.select(".panel").attr("transform","translate("+a.margin.left+",0)"),l-a.margin.left-a.margin.right);return{container:i,width:l,height:o,legendWidth:s}},r=function(t){if(!t.data)return{};var a,n,r,i=t.colorScale(t.data);return n=i.domain(),r=e.range(0,n.length),a=t.colorScale(r),{legendColorScale:a,labelValues:n,colors:r}},i=function(t){if(!t.data)return{};var e=t.container.select("#legend-gradient").selectAll("stop").data(t.colors);return e.enter().append("stop").merge(e).attr("offset",function(e,a){return a*(100/(t.colors.length-1))+"%"}).attr("stop-color",function(e){return t.legendColorScale(e)}),e.exit().remove(),t.container.select(".color-band").attr("width",t.legendWidth).attr("height",t.height/2),{}},l=function(t){if(!t.data)return{};var e=t.container.select(".axis").selectAll("text.tick-label").data(t.labelValues),a=e.enter().append("text").classed("tick-label",!0).merge(e).attr("x",function(e,a){return a*(t.legendWidth/(t.labelValues.length-1))}).attr("y",.7*t.height).attr("dy","0.5em").text(function(t){return t.toPrecision(3)});e.exit().remove(),a.attr("dx",function(t,e){return-(this.getBBox().width/2)});var n=t.container.select(".axis").selectAll("line.tick-line").data(t.labelValues),r=n.enter().append("line").classed("tick-line",!0).merge(n).attr("x1",function(e,a){return a*(t.legendWidth/(t.labelValues.length-1))}).attr("y1",t.height/2).attr("x2",function(e,a){return a*(t.legendWidth/(t.labelValues.length-1))}).attr("y2",.55*t.height);return n.exit().remove(),r.attr("dx",function(t,e){return-(this.getBBox().width/2)}),t.unit&&t.container.select(".unit").attr("y",.95*t.height).text(t.unit),{}},o=t.utils.pipeline(a,n,r,i,l),s=function(a){var n,r,i=~~(1e4*Math.random()),l=t.utils.throttle(function(){n.width=n.parent.clientWidth,s()},200);e.select(window).on("resize."+i,l);var s=function(){r=o(n)},c=function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return n=t.utils.mergeAll({},n),n.data=a,s(),this},u=function(e){return n=t.utils.mergeAll(n,e),s(),this},d=function(e){u(t.utils.mergeAll({},e))},m=function(){e.select(window).on("resize."+i,null),n.parent.innerHTML=null};return d(a),{setConfig:u,render:s,setData:c,destroy:m}};t.colorLegend=s}(a,n.d3),!function(t,e,a){var n=a.schemeSpectral[11].reverse(),r=function(t,a){var n=e.scaleQuantile().domain(t).range(e.range(a-1)).quantiles();return n.push(e.max(t)),n.unshift(e.min(t)),n},i=function(t,a){var n=r(t,a.length);return e.scaleLinear().domain(n).range(a)},l=function(t,a){var n=a||t.length,r=e.scaleLinear().domain([0,n-1]).range(t);return e.range(n).map(r)},o={grayscale:function(t){return e.scaleLinear().domain(e.extent(t)).range(["white","black"])},equalizedSpectral:function(t){return i(t,n)},equalizedGrayscale:function(t){return i(t,l(["white","black"],10))}};t.palette=o}(a,n.d3,n.colorBrewer),!function(t,e,n){var r=function(){var e=null,a=null,r=null,i=null,l=null,o=null,s=n.DomUtil.create("canvas","data-grid-layer");s.style.display="none",document.body.appendChild(s);var c={};return c.render=function(l){var o=l||i;if(i=o,!o)return c;var u=a.getBounds(),d=a.getPixelOrigin(),m=a.getPixelWorldBounds(),h=a.getSize(),f=h.y;a._zoom<h.y/512&&(f=m.max.y-m.min.y),console.log("Start rendering..."),console.time("render");var v=o.lat,p=o.lon,g=o.values;s.width=h.x,s.height=f;for(var x,y,b,w,A,k,M,D,T,S=s.getContext("2d"),C=Math.max(t.utils.bisectionReversed(v,u.getNorth())-1,0),Y=Math.min(t.utils.bisectionReversed(v,u.getSouth()),v.length-1),X=Math.max(t.utils.bisection(p,u.getWest())-1,0),N=Math.min(t.utils.bisection(p,u.getEast())+1,p.length-1),E=a.latLngToContainerPoint([v[C],p[Math.max(X,0)]]),H=a.latLngToContainerPoint([v[C],p[Math.min(X+1,p.length-1)]]),I=Math.ceil(Math.max(H.x-E.x,1))+2,O=S.getImageData(0,0,h.x,f),L=new ArrayBuffer(O.data.length),F=new Uint8ClampedArray(L),o=new Uint32Array(L),W=0;W<v.length;W++)if(!(C>W||W>Y)){M=Math.max(W,0),D=Math.min(M+1,v.length-1);for(var B=a.latLngToContainerPoint([v[M],p[X]]),j=a.latLngToContainerPoint([v[D],p[X]]),P=Math.ceil(Math.max(j.y-B.y,1)+1),z=0;z<p.length;z++)if(z>=X&&N>z&&(T=Math.max(z,0),A=a.latLngToContainerPoint([v[M],p[T]]),a._zoom<h.y/512&&(A.y=A.y+d.y-a._getMapPanePos().y),k=g[M][T],-999!==k&&null!==k&&!isNaN(k)&&W%1===0&&z%1===0))for(x=t.utils.parseRGB(e(k)),b=0;I>b;b++)for(w=0;P>w;w++)y=(~~A.y+w-~~(P/2))*h.x+Math.min(Math.max(~~A.x+b-~~(I/2),0),h.x-1),o[y]=255<<24|x[2]<<16|x[1]<<8|x[0]}return O.data.set(F),S.putImageData(O,0,0),r&&r.removeFrom(a),r=n.imageOverlay(s.toDataURL("image/png"),u).addTo(a),r.setOpacity(.8),console.timeEnd("render"),c},c.setColorScale=function(t){return e=t,c},c.setData=function(t){return c.render(t),c},c.addTo=function(t){return a=t,a.on("moveend",function(t){var e=t.target._panes.overlayPane.querySelector("img");if(e){var n=e.style,r=n.transform;if(r){var i=r.match(/\((.*)\)/)[1].split(",").slice(0,2);n.transform="translate("+i+")"}}var s=t.target._zoom,u=s!==l;l=s;var d=a.getBounds(),m=JSON.stringify(d)!==JSON.stringify(o);o=d,(u||m)&&c.render()}),c},c},i=function(t){function a(t){n.marker(t,{interactive:!0}).on("click",function(t){r(),s(),u.call("markerClick",this,t)},this).addTo(h);s()}function r(){return h.clearLayers(),f._toolbars.draw._modes.rectangle.handler.disable(),f._toolbars.draw._modes.marker.handler.disable(),this}function i(t){return{type:"Feature",geometry:{type:"Polygon",coordinates:[t.concat([t[0]])]},properties:{}}}function o(t,e){var a=n.GeoJSON.geometryToLayer(t).on("click",function(t){h.removeLayer(this),e&&e(this),s()},this);return a.addTo(h),this}function s(){var t=h.getBounds();return t._southWest?d.fitBounds(t):d.fitWorld(),this}var c=l({parent:t.parent}).init(),u=e.dispatch("mapCloseClick","rectangleDraw","rectangleClick","markerClick","markerDraw","geojsonClick"),d=c._getMap();d.zoomControl.setPosition("bottomright");var m=n.Control.extend({position:"topright",onAdd:function(t){var e=n.DomUtil.create("a","map-close leaflet-bar leaflet-control leaflet-control-custom");return e.onclick=function(t){u.call("mapCloseClick",this,t)},e}});d.addControl(new m);var h=new n.FeatureGroup;d.addLayer(h);var f=new n.Control.Draw({edit:{featureGroup:h,edit:!1,remove:!1},draw:{polygon:!1,circle:!1,polyline:!1,marker:{icon:new n.Icon.Default,zIndexOffset:2e3,repeatMode:!0},rectangle:{shapeOptions:{fillColor:"#128DE0",color:"#128DE0",opacity:.5},repeatMode:!0}}});return d.addControl(f),d.on("draw:created",function(t){var e=t.layer;r();if("rectangle"===t.layerType&&(e.addTo(h).on("click",function(t){r(),s(),u.call("rectangleClick",this,t)},this),u.call("rectangleDraw",this,e.getBounds()),s()),"marker"===t.layerType){var n=e.getLatLng();a(n),u.call("markerDraw",this,n)}},this),c.addRectangle=function(t){r();var e=i(t);return o(e,function(){u.call("rectangleClick",this,arguments)}),s(),this},c.addPolygons=function(t){return r(),t.forEach(function(t){t[1].id=t[0];var e=n.GeoJSON.geometryToLayer(t[1]).on("click",function(e){h.removeLayer(this),u.call("geojsonClick",this,t),s()},this);e.addTo(h)}),s(),this},c.removeAllPolygons=r,c.zoomToBoundingBox=s,c.addMarker=a,c},l=function(i){function l(){n.Icon.Default.imagePath=b.imagePath,A=n.map(b.container,w).on("click",function(t){C.call("click",this,{lat:t.latlng.lat,lon:t.latlng.lng})}).on("mousedown",function(t){b.container.classList.add("grab")}).on("mouseup",function(t){b.container.classList.remove("grab")}).on("mousemove",function(e){if(T){var r=t.utils.bisectionReversed(T.lat,e.latlng.lat),i=t.utils.bisection(T.lon,e.latlng.lng),l=Math.max(r-1,0),o=T.lat[l]-T.lat[r];
e.latlng.lat>T.lat[r]+o/2&&(r=l);var s=Math.max(i-1,0),c=T.lon[i]-T.lon[s];e.latlng.lng<T.lon[i]-c/2&&(i=s);var u=null;if(e.latlng.lat<=T.lat[0]&&e.latlng.lat>=T.lat[T.lat.length-1]&&e.latlng.lng>=T.lon[0]&&e.latlng.lng<=T.lon[T.lon.length-1]&&(u=T.values[r][i]),null!==u&&-999!==u&&b.showTooltip){var d=n.Util.formatNum(u,2);a.setTooltipContent(d+"").openTooltip([e.latlng.lat,e.latlng.lng])}else a.closeTooltip();C.call("mousemove",this,{x:e.containerPoint.x,y:e.containerPoint.y,value:u,lat:e.latlng.lat,lon:e.latlng.lng})}}).on("mouseover",function(t){C.call("mouseenter",this,arguments)}).on("mouseout",function(t){C.call("mouseleave",this,arguments)}),i.mapConfig&&i.mapConfig.zoom||A.fitWorld(),A.createPane("labels");var e={};e.basemapDark=n.tileLayer("https://api.mapbox.com/styles/v1/planetos/ciusdqjc200w12jmlg0dys640/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGxhbmV0b3MiLCJhIjoiZjZkNDE4MTE5NWNhOGYyMmZhZmNhMDQwMDg0YWMyNGUifQ.htlwo6U82iekTcpGtDR_dQ",{tileSize:256,maxZoom:19}),e.basemapLight=n.tileLayer("https://api.mapbox.com/styles/v1/planetos/civ28flwe002c2ino04a6jiqs/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicGxhbmV0b3MiLCJhIjoiZjZkNDE4MTE5NWNhOGYyMmZhZmNhMDQwMDg0YWMyNGUifQ.htlwo6U82iekTcpGtDR_dQ",{tileSize:256,maxZoom:19}),e.labelLight=n.tileLayer("http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",{attribution:"©OpenStreetMap, ©CartoDB",pane:"labels"}),e[b.basemapName].addTo(A),b.showLabels&&e.labelLight.addTo(A),k=r().addTo(A);var a=n.featureGroup().bindTooltip("").addTo(A);return this}function o(t,e){var a=e.bbox,r=[[a.latMax,a.lonMin],[a.latMin,a.lonMax]];return n.imageOverlay(t,r).addTo(A),this}function s(){return b.container.style.display="block",Y.isVisible=!0,this}function c(){return b.container.style.display="none",Y.isVisible=!1,this}function u(){return A.invalidateSize(),S?d(S):A.fitWorld(),this}function d(t){var e=n.geoJson(t);return A.fitBounds(e.getBounds()),S=t,this}function m(t){var e=function(t,e){e.on({click:function(t){C.call("featureClick",this,{id:t.target.feature.properties.id,lat:t.target._latlng?t.target._latlng.lat:t.latlng.lat,lon:t.target._latlng?t.target._latlng.lng:t.latlng.lng,layer:t})},mouseover:function(t,e,a){C.call("featureMousEnter",this,{x:t.containerPoint.x,y:t.containerPoint.y,lat:t.latlng.lat,lon:t.latlng.lng,value:t.target.feature.properties.id})},mouseout:function(t){C.call("featureMousLeave",this,{x:t.containerPoint.x,y:t.containerPoint.y,lat:t.latlng.lat,lon:t.latlng.lng,value:t.target.feature.properties.id})}})};return M=n.geoJson(t,{onEachFeature:e,pointToLayer:function(t,e){return new n.CircleMarker(e,{radius:4,fillColor:"#05A5DE",color:"#1E1E1E",weight:1,opacity:.5,fillOpacity:.4})}}).addTo(A),b.polygonTooltipFunc&&M.bindTooltip(b.polygonTooltipFunc),this}function h(t){return f(),D=n.marker(t,{interactive:!0,draggable:!0,opacity:1}).on("click",function(t){C.call("markerClick",this,arguments)}).addTo(A),this}function f(){return D&&D.remove(),this}function v(t){T=t;var e=t.uniqueValues.sort(function(t,e){return t-e}),a=b.colorScale(e);return k.setColorScale(a).setData(t),this}function p(t){return t?(A.addControl(A.zoomControl),A.doubleClickZoom.enable(),A.boxZoom.enable(),A.dragging.enable()):(A.removeControl(A.zoomControl),A.doubleClickZoom.disable(),A.boxZoom.disable(),A.dragging.disable()),this}function g(){return a.data.getWorldVector(function(t){m(t)}),this}var x=n.DomUtil.create("div","datahub-map"),y=i.parent.appendChild(x),b={container:y,colorScale:i.colorScale,basemapName:i.basemapName||"basemapDark",imagePath:i.imagePath||"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/images/",showLabels:!(i.showLabels===!1),showTooltip:!(i.showTooltip===!1),polygonTooltipFunc:i.polygonTooltipFunc},w={maxBounds:[[-90,-180],[90,180]],maxZoom:13,minZoom:1,scrollWheelZoom:!1,zoomSnap:0,zoomDelta:.5,attributionControl:!1,fadeAnimation:!1,tileLayer:{noWrap:!0,continuousWorld:!1}};t.utils.merge(w,i.mapConfig);var A,k,M,D,T,S,C=e.dispatch("click","mousemove","mouseenter","mouseleave","featureClick","featureMousEnter","featureMousLeave","markerClick"),Y={isVisible:!0};return{init:l,show:s,hide:c,resize:u,zoomToPolygonBoundingBox:d,addMarker:h,removeMarker:f,renderPolygon:m,renderImage:o,renderRaster:v,renderVectorMap:g,isVisible:Y.isVisible,hideZoomControl:p,on:t.utils.rebind(C),_getMap:function(){return A}}};t.map={rasterMap:l,selectorMap:i}}(a,n.d3,n.leaflet),!function(t,e){var a=function(a){var n=a.parent.querySelector(".widget-container");if(!n){var r='<div class="widget-container"><svg class="datahub-chart"><g class="panel"><g class="stripe-group"></g><g class="area-group"></g><g class="stacked-area-group"></g><g class="reference-bar-group"></g><g class="reference-line-group"></g><g class="bar-group"></g><g class="stacked-bar-group"></g><g class="estimate-bar-group"></g><g class="line-group"></g><g class="dot-group"></g><g class="threshold-line-group"></g><g class="y axis"></g><g class="x axis"></g><g class="active-group"></g><g class="title-container"><text class="y axis-title"></text><text class="x axis-title"></text><text class="chart-title"></text></g><g class="message-group"></g><g class="events"><rect class="event-panel"></rect></g></g></svg></div>';n=t.utils.appendHtmlToNode(r,a.parent)}var i=a.width-a.margin.left-a.margin.right,l=a.height-a.margin.top-a.margin.bottom,o=e.select(n);return o.select("svg").attr("width",a.width).attr("height",a.height),o.select(".panel").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),o.select(".events rect").attr("width",i).attr("height",l).attr("opacity",0),{container:o,chartWidth:i,chartHeight:l}},n=function(t,e,a){return t[e]?t[e].map(function(t){return t.timestamp=new Date(t.timestamp),t.value=Array.isArray(t.value)&&!a?t.value[0]:t.value,t}):[]},r=function(t){return t.timestamp?t.timestamp.map(function(t){return new Date(t)}):[]},i=function(t){var e=t.data||{};return{dataIsEmpty:!e||!e.timestamp||!e.timestamp.length,data:{timestamp:r(e),stackedBarData:n(e,"stackedBarData",!0),stackedAreaData:n(e,"stackedAreaData",!0),lineData:n(e,"lineData",!0),barData:n(e,"barData"),referenceData:n(e,"referenceData"),estimateData:n(e,"estimateData"),thresholdData:n(e,"thresholdData"),areaData:n(e,"areaData")}}},l=function(t){var a=t.dataIsEmpty?0:t.data.timestamp,n=e.scaleBand().domain(a).range([0,t.chartWidth]).paddingInner(.4).paddingOuter(.2),r=n.copy().paddingInner(.1).paddingOuter(.05),i=n.copy().paddingInner(0).paddingOuter(0),l=n.copy().paddingInner(1).paddingOuter(.5);return{scaleX:n,referenceScaleX:r,stripeScaleX:i,lineScaleX:l}},o=function(a){var n=[];n.push(t.utils.getExtent(a.data.barData)),n.push(t.utils.getExtent(a.data.referenceData)),n.push(t.utils.getExtent(a.data.estimateData)),n.push(t.utils.getExtent(a.data.thresholdData)),n.push(t.utils.getExtent(a.data.areaData)),n.push(t.utils.getStackExtent(a.data.stackedBarData)),n.push(t.utils.getStackExtent(a.data.stackedAreaData)),n.push(t.utils.getMultiExtent(a.data.lineData));var r=[],i=!0;r.push(t.utils.getExtent(a.data.barData,i)),r.push(t.utils.getExtent(a.data.referenceData,i)),r.push(t.utils.getExtent(a.data.estimateData,i)),r.push(t.utils.getExtent(a.data.thresholdData,i)),r.push(t.utils.getExtent(a.data.areaData,i)),r.push(t.utils.getStackExtent(a.data.stackedBarData,i)),r.push(t.utils.getStackExtent(a.data.stackedAreaData,i)),r.push(t.utils.getMultiExtent(a.data.lineData,i));var l,o=e.max(n);if(a.autoScaleY){l=e.min(r);var s=(o-l)/10;l=Math.max(l-s,0),o+=s}else l=Math.min(e.min(r),0),o=Math.max(o,0);var c=[l,o];a.domain&&(c=a.domain),a.reverseY&&(c=[c[1],c[0]]);var u=e.scaleLinear().domain(c).range([a.chartHeight,0]);return{scaleY:u}},s=function(e,a,n){if(!n)return null;var r=e[a].map(function(t){return t.timestamp&&t.timestamp.getTime()}).indexOf(n.getTime());if(r>-1){var i=t.utils.mergeAll({},e[a][r]);return i.value=[].concat(e[a][r].value),i.id=[].concat(e[a][r].id),i}return null},c=function(e,a,n){if(e[a][0]){var r=t.utils.mergeAll({},e[a][0]);return r.value=[].concat(e[a][0].value),r.id=[].concat(e[a][0].id),r}return null},u=function(t,e){var a={referenceData:s(e,"referenceData",t),estimateData:s(e,"estimateData",t),barData:s(e,"barData",t),stackedBarData:s(e,"stackedBarData",t),lineData:s(e,"lineData",t),areaData:s(e,"areaData",t),stackedAreaData:s(e,"stackedAreaData",t),thresholdData:c(e,"thresholdData",t)};return a},d=function(t){var a=t.container.select(".events .event-panel").on("mousemove touchstart",function(a){if(!t.dataIsEmpty){var n=e.mouse(this)[0],r=t.stripeScaleX.bandwidth(),i=t.stripeScaleX.domain(),l=i.length,o=Math.min(~~(n/r),l-1),s=i[o],c=u(s,t.data);t.events.call("hover",null,{index:o,timestamp:s,data:c,config:t,event:e.event})}}).on("mouseout",function(e){t.events.call("mouseout",null,{})}).on("click",function(a){t.events.call("click",null,{event:e.event})});return{eventPanel:a}},m=function(t){var e=t.container.select(".bar-group").selectAll("rect.bar").data(t.data.barData);return e.enter().append("rect").merge(e).attr("class",function(t){return["bar",t.id,t.className].join(" ")}).attr("x",function(e,a){return t.scaleX(e.timestamp)||0}).attr("y",function(e){return t.autoScaleY?t.chartHeight-(t.chartHeight-Math.abs(t.scaleY(e.value))):e.value>=0||t.reverseY?t.scaleY(0)-Math.abs(t.scaleY(e.value)-t.scaleY(0)):t.scaleY(0)}).attr("width",function(e){return t.scaleX.bandwidth()}).attr("height",function(e){return t.autoScaleY?t.chartHeight-Math.abs(t.scaleY(e.value)):Math.abs(t.scaleY(e.value)-t.scaleY(0))}),e.exit().remove(),{}},h=function(t){var e=t.container.select(".estimate-bar-group").selectAll("rect.estimate-bar").data(t.data.estimateData);return e.enter().append("rect").merge(e).attr("class",function(t){return["estimate-bar",t.id,t.className].join(" ")}).attr("x",function(e,a){return t.scaleX(e.timestamp)||0}).attr("y",function(e){return t.scaleY(e.value)||0}).attr("width",function(e){return t.scaleX.bandwidth()}).attr("height",function(e){return t.chartHeight-t.scaleY(e.value)||0}),e.exit().remove(),{}},f=function(t){var e=t.container.select(".reference-bar-group").selectAll("rect.reference-bar").data(t.data.referenceData);e.enter().append("rect").merge(e).attr("class",function(t){return["reference-bar",t.id,t.className].join(" ")}).attr("x",function(e,a){return t.referenceScaleX(e.timestamp)||0}).attr("y",function(e){return t.autoScaleY?t.chartHeight-(t.chartHeight-Math.abs(t.scaleY(e.value))):e.value>=0||t.reverseY?t.scaleY(0)-Math.abs(t.scaleY(e.value)-t.scaleY(0)):t.scaleY(0)}).attr("width",function(e){return t.referenceScaleX.bandwidth()}).attr("height",function(e){return t.autoScaleY?t.chartHeight-Math.abs(t.scaleY(e.value)):Math.abs(t.scaleY(e.value)-t.scaleY(0))}),e.exit().remove();var a=t.container.select(".reference-line-group").selectAll("path.reference-top").data(t.data.referenceData);return a.enter().append("path").attr("class","reference-top").merge(a).attr("d",function(e,a){var n=t.referenceScaleX(e.timestamp)||0,r=0;r=e.value>=0||t.reverseY?t.scaleY(0)-Math.abs(t.scaleY(e.value)-t.scaleY(0)):t.scaleY(0)+Math.abs(t.scaleY(e.value)-t.scaleY(0));var i=t.referenceScaleX.bandwidth();return"M"+[[n,r],[n+i,r]]}),a.exit().remove(),{}},v=function(a){if(!a.data.stackedBarData||!a.data.stackedBarData.length)return a.container.select(".stacked-bar-group").selectAll("g.stack").remove(),{};var n=a.data.stackedBarData[0].value.map(function(t,e){return"y"+e}),r=[];a.data.stackedBarData.forEach(function(e,a){var n=t.utils.mergeAll({},e);e.value&&e.value.length&&(e.value.forEach(function(t,e){n["y"+e]=t}),r.push(n))});var i=a.container.select(".stacked-bar-group").selectAll("g.stack").data(e.stack().keys(n)(r)),l=i.enter().append("g").attr("class","stack").merge(i).selectAll("rect.stacked-bar").data(function(t,e){return t.forEach(function(e){e.index=t.index}),t});return l.enter().append("rect").attr("class","stacked-bar").merge(l).attr("class",function(t,e,a){var n=t.data.id?t.data.id[t.index]:null,r=t.data.className?t.data.className[t.index]:null;return["stacked-bar","layer"+t.index,n,r].join(" ")}).filter(function(t){return!Number.isNaN(t[0])&&!Number.isNaN(t[1])}).attr("x",function(t){return a.scaleX(t.data.timestamp)}).attr("y",function(t){return a.scaleY(t[1])}).attr("height",function(t){return a.scaleY(t[0])-a.scaleY(t[1])}).attr("width",a.scaleX.bandwidth()),l.exit().remove(),i.exit().remove(),{}},p=function(t){if(!t.data.lineData.length)return t.container.select(".line-group").selectAll("path.line").remove(),{};var a=e.line().defined(function(t){return null!=t.value}).x(function(e){return t.lineScaleX(e.timestamp)}).y(function(e){return t.scaleY(e.value)}),n=[],r=t.data.lineData[0].value.length;if("undefined"==typeof r)n.push(t.data.lineData);else for(var i=0;r>i;i++){var l=t.data.lineData.map(function(t){return{timestamp:t.timestamp,value:t.value[i],id:t.id&&t.id[i],className:t.className&&t.className[i]}});n.push(l)}var o=t.container.select(".line-group").selectAll("path.line").data(n);return o.enter().append("path").style("fill","none").merge(o).attr("class",function(t,e){return["line","layer"+e,t[0].id,t[0].className].join(" ")}).attr("d",a),o.exit().remove(),{}},g=function(t){if(!t.data.lineData.length)return t.container.select(".dot-group").selectAll(".dot-layer").remove(),{};for(var e=t.data.lineData,a=[],n=e[0].value.length,r=0;n>r;r++){var i=[];e.forEach(function(t,a){var n=Math.max(0,a-1),l=Math.min(e.length-1,a+1),o=a,s=e[n].value[r],c=e[l].value[r],u=t.value[r];(null!==u&&(null===s||null===c)||o===n&&o===l)&&i.push({value:u,timestamp:t.timestamp,layer:r})}),a.push(i)}var l=t.container.select(".dot-group").selectAll(".dot-layer").data(a),o=l.enter().append("g").merge(l).attr("class","dot-layer");l.exit().remove();var s=o.selectAll(".dot").data(function(t,e){return t});return s.enter().append("circle").merge(s).attr("class",function(t,e,a){return["dot","layer"+t.layer].join(" ")}).attr("cx",function(e){return t.lineScaleX(e.timestamp)}).attr("cy",function(e){return t.scaleY(e.value)}).attr("r",2),s.exit().remove(),{}},x=function(t){var e=t.container.select(".threshold-line-group").selectAll("line.threshold-line").data(t.data.thresholdData);return e.enter().append("line").merge(e).attr("class",function(t){return["threshold-line",t.id,t.className].join(" ")}).attr("x1",0).attr("y1",function(e){return t.scaleY(e.value)||0}).attr("x2",t.chartWidth).attr("y2",function(e){return t.scaleY(e.value)||0}).attr("display",function(t){return t?null:"none"}),e.exit().remove(),{}},y=function(t){if(!t.data.areaData||!t.data.areaData.length)return t.container.select(".area-group").selectAll("path.area").remove(),{};var a=e.area().defined(function(t){return null!=t.value}).x(function(e){return t.lineScaleX(e.timestamp)}).y0(t.chartHeight).y1(function(e){return t.scaleY(e.value)}),n=t.container.select(".area-group").selectAll("path.area").data([t.data.areaData]);return n.enter().append("path").attr("class",function(t,e){return["area","layer"+e,t[0].id,t[0].className].join(" ")}).merge(n).attr("d",a),n.exit().remove(),{}},b=function(a){if(!a.data.stackedAreaData||!a.data.stackedAreaData.length)return a.container.select(".stacked-area-group").selectAll("g.stack-area").remove(),{};var n=a.data.stackedAreaData[0].value.map(function(t,e){return"y"+e}),r=e.area().defined(function(t){return!Number.isNaN(t[0])&&!Number.isNaN(t[1])}).x(function(t){return a.lineScaleX(t.data.timestamp)}).y0(function(t){return a.scaleY(t[0])}).y1(function(t){return a.scaleY(t[1])}),i=[];a.data.stackedAreaData.forEach(function(e,a){var n=t.utils.mergeAll({},e);e.value&&e.value.length&&(e.value.forEach(function(t,e){n["y"+e]=t}),i.push(n))});var l=a.container.select(".stacked-area-group").selectAll("g.stack-area").data(e.stack().keys(n)(i)),o=l.enter().append("g").attr("class","stack-area").merge(l).selectAll("path.stacked-area").data(function(t,e){return t.forEach(function(e){e.index=t.index}),[t]});return o.enter().append("path").merge(o).attr("class",function(t){var e=t[0].data.id?t[0].data.id[t.index]:null,a=t[0].data.className?t[0].data.className[t.index]:null;return["stacked-area","layer"+t.index,e,a].join(" ")}).attr("d",r),o.exit().remove(),l.exit().remove(),{}},w=function(t){if(t.showStripes===!1)return t.container.select(".stripe-group").selectAll("rect.stripe").remove(),{};var e=t.container.select(".stripe-group").selectAll("rect.stripe").data(t.data.timestamp);return e.enter().append("rect").attr("class","stripe").merge(e).classed("even",function(t,e){return e%2}).attr("x",function(e,a){return t.stripeScaleX(e)||0}).attr("y",function(t){return 0}).attr("width",function(e){return t.stripeScaleX.bandwidth()}).attr("height",function(e){return t.chartHeight}),e.exit().remove(),{}},A=function(t){var a=t.activeDate&&void 0!==t.activeDate.getTime?t.activeDate.getTime():new Date(t.activeDate).getTime(),n=t.data.timestamp.filter(function(t){return t.getTime()===a}),r=t.container.select(".active-group").selectAll("rect.active").data(n);return r.enter().append("rect").attr("class","active").merge(r).each(function(a){if(!t.dataIsEmpty){var n=u(a,t.data);t.events.call("active",null,{timestamp:a,data:n,config:t,event:e.event})}}).attr("x",function(e,a){return t.stripeScaleX(e)||0}).attr("y",function(t){return 0}).attr("width",function(e){return t.stripeScaleX.bandwidth()}).attr("height",function(e){return t.chartHeight}),r.exit().remove(),{}},k=t.utils.pipeline(t.common.defaultConfig,i,a,l,o,d,t.common.axisX,t.common.axisY,w,A,y,f,v,b,m,h,p,g,x,t.common.axisComponentY,t.common.labelsRewriterY,t.common.message,t.common.axisComponentX,t.common.axisTitleComponentX,t.common.axisTitleComponentY,t.common.chartTitleComponent),M=function(a){var n,r,i=e.dispatch("hover","click","mouseout","active"),l=~~(1e4*Math.random()),o=t.utils.throttle(function(){n.width=n.parent.clientWidth,s()},200);e.select(window).on("resize."+l,o);var s=function(){r=k(n)},c=function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return n=t.utils.mergeAll({},n),n.data=a,s(),this},u=function(e){return n=t.utils.mergeAll(n,e),s(),this},d=function(e,a){u(t.utils.mergeAll(e,{events:a}))},m=function(){e.select(window).on("resize."+l,null),n.parent.innerHTML=null};return d(a,i),{on:t.utils.rebind(i),setConfig:u,setData:c,destroy:m}};t.multiChart=M}(a,n.d3),!function(t,e){var a=function(a){var n=a.parent.querySelector(".datahub-table-chart");if(!n){var r='<div class="datahub-table-chart"><div class="table-container"><div class="header"><div class="row"></div></div><div class="content"></div><div class="footer"><div class="row"></div></div></div><div class="chart-container"><div class="header"><div class="row"></div></div><div class="content"><div class="rows"></div><div class="chart"><svg><g class="panel"><g class="stripes"></g><g class="bars"></g><g class="axis"></g><g class="message-group"></g></g></svg></div></div><div class="footer"><div class="row"></div></div></div></div>';n=t.utils.appendHtmlToNode(r,a.parent)}var i=!(a.elements&&a.elements.length),l={top:0,bottom:24,right:24,left:24},o=a.margin||l,s=a.rowHeight||48,c=e.select(n),u=c.select(".chart-container"),d=u.node().clientWidth,m=d-o.left-o.right,h=i?s:a.elements.length*s+o.bottom,f=h-o.bottom;return{container:c,width:d,height:h,chartWidth:m,chartHeight:f,rowHeight:s,margin:o,dataIsEmpty:i}},n=function(t){if(t.elements){var e=t.elements.slice(),a=e.sort(t.sortFunc);return{elements:a}}return{}},r=function(t){var a=t.domain||[0,0];if(!t.domain&&t.elements){var n=e.merge(t.elements).filter(function(e){return e.key===t.valueKey||e.key===t.referenceKey}).map(function(t){return t.value});a=n.length?e.extent(n):[0,0]}a[0]=Math.min(a[0],0);var r=Math.max(Math.abs(a[0]),Math.abs(a[1]));a=[-r,r];var i=e.scaleLinear().domain(a).range([0,t.chartWidth]);return{scaleX:i}},i=function(t){var a=t.axisXFormat||".2s",n=e.axisBottom().scale(t.scaleX).tickFormat(e.format(a)),r=t.container.select(".axis").attr("transform","translate("+[0,t.chartHeight]+")").attr("display",t.dataIsEmpty?"none":"block").call(n);return{axisX:r}},l=function(t){var e=t.container.select(".header .row").selectAll("div.column").data(t.header||[]);return e.enter().append("div").merge(e).attr("class",function(t){return"column "+t.key}).html(function(t){if(Array.isArray(t.label)){var e=t.label.map(function(t,e){return"<div>"+t+"</div>"}).join("");return'<div class="multiline">'+e+"</div>"}return t.label}),e.exit().remove(),{}},o=function(t){var e=t.container.select(".table-container .content").selectAll("div.row").data(t.elements||[]),a=e.enter().append("div").merge(e).attr("class","row");e.exit().remove();var n=a.selectAll("div.column").data(function(t){return t});n.enter().append("div").merge(n).attr("class","column").html(function(e){if("number"==typeof e.label){var a=function(t){return Math.floor(100*t)/100},n=t.valueFormat||a;return n(e.label)}if(Array.isArray(e.label)){var r=e.label.map(function(t,e){return"<div>"+t+"</div>"}).join("");return'<div class="multiline">'+r+"</div>"}return null===e.label||"undefined"==typeof e.label?t.emptyPlaceholder||"":e.label}),n.exit().remove();var r=t.container.select(".chart-container .rows").selectAll("div.row").data(t.elements||[]);return r.enter().append("div").attr("class","row").append("div").attr("class","column"),r.exit().remove(),{}},s=function(t){var e=t.container.select("svg").attr("width",t.width).attr("height",t.height).select(".panel").attr("transform","translate("+t.margin.left+" 0)").select(".bars").selectAll("g.bar-group").data(t.elements||[]),a=e.enter().append("g").merge(e).attr("class","bar-group").attr("transform",function(e,a){return"translate(0 "+a*t.rowHeight+")"});e.exit().remove();var n=a.selectAll("rect.reference-bar").data(function(e,a){var n=e.filter(function(e){return e.key===t.referenceKey});return[n&&n[0]]});n.enter().append("rect").merge(n).attr("class","reference-bar").attr("width",function(e){return Math.abs(t.scaleX(e.value)-t.scaleX(0))}).attr("height",function(e){return t.rowHeight/2}).attr("x",function(e){return e.value<0?t.scaleX(e.value):t.scaleX(0)}).attr("y",function(e){return t.rowHeight/4}),n.exit().remove();var r=2,i=a.selectAll("rect.reference-line").data(function(e,a){var n=e.filter(function(e){return e.key===t.referenceKey});return[n&&n[0]]});i.enter().append("rect").merge(i).attr("class","reference-line").attr("display",function(t){return t.value||0===t.value?"block":"none"}).attr("width",r).attr("height",function(e){return t.rowHeight/2}).attr("x",function(e){var a=r;return e.value>0&&(a*=-1),t.scaleX(e.value)+a}).attr("y",function(e){return t.rowHeight/4}),i.exit().remove();var l=a.selectAll("rect.value-bar").data(function(e,a){var n=e.filter(function(e){return e.key===t.valueKey});return[n&&n[0]]});return l.enter().append("rect").merge(l).attr("class","value-bar").attr("width",function(e){return Math.abs(t.scaleX(e.value)-t.scaleX(0))}).attr("height",function(e){return t.rowHeight/4}).attr("x",function(e){return e.value<0?t.scaleX(e.value):t.scaleX(0)}).attr("y",function(e){return 3*t.rowHeight/8}),l.exit().remove(),{}},c=function(t){return t.container.on("click",function(){t.events.call("click",null,{event:e.event})}),{}},u=function(t){var e=t.scaleX.ticks(),a=t.container.select(".stripes").selectAll("rect.stripe").data(e);return a.enter().append("rect").attr("class","stripe").merge(a).attr("x",function(a,n){var r=e[Math.max(n-1,0)],i=(t.scaleX(a)-t.scaleX(r))/2;return t.scaleX(a)-i}).attr("y",function(t){return 0}).attr("width",function(a,n){var r=e[Math.max(n-1,0)],i=(t.scaleX(a)-t.scaleX(r))/2;return i=Math.max(i,0)}).attr("height",function(e){return t.chartHeight}),a.exit().remove(),{}},d=function(t){var e=(t.scaleX.ticks(),t.container.select(".stripes").selectAll("line.grid").data([0]));return e.enter().append("line").attr("class","grid").merge(e).attr("display",t.dataIsEmpty?"none":"block").attr("x1",function(e){return t.scaleX(0)+.5}).attr("y1",0).attr("x2",function(e){return t.scaleX(0)+.5}).attr("y2",t.chartHeight),e.exit().remove(),{}},m=function(t){return t.labelsRewriterX?(t.container.selectAll(".axis").selectAll("text").html(function(e,a){return t.labelsRewriterX(e,a,t)}),{}):{}},h=t.utils.pipeline(a,n,l,o,r,c,u,d,i,m,s),f=function(a){var n,r,i=e.dispatch("click"),l=~~(1e4*Math.random()),o=t.utils.throttle(function(){n.width=n.parent.clientWidth,s()},200);e.select(window).on("resize."+l,o);var s=function(){r=h(n)},c=function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return n=t.utils.mergeAll({},n,{data:a}),s(),this},u=function(e){return n=t.utils.mergeAll(n,e),s(),this},d=function(e,a){u(t.utils.mergeAll(e,{events:a}))},m=function(){e.select(window).on("resize."+l,null),n.parent.innerHTML=null};return d(a,i),{on:t.utils.rebind(i),setConfig:u,setData:c,destroy:m}};t.tableChart=f}(a,n.d3),!function(t,e){function a(a,n){var r=[];return a.dataConverted.forEach(function(i,l){var o=e.bisector(function(t,e){return t.timestamp.getTime()-e.getTime()}).left,s=o(i.data,n),c=i.data[Math.min(s,i.data.length-1)],u=i.data[Math.max(s-1,0)],d=n-u.timestamp>c.timestamp-n?c:u,m=Math.round(a.scaleX(d.timestamp)),h=Math.round(a.scaleY(d.value)),f={event:e.event,posX:m,posY:h};d=t.utils.mergeAll({},d,i.metadata,f),r.push(d)}),r}function n(t,e){var a=e[0].posX+t.margin.left;if(t.container.select(".tooltip line").attr("y1",0).attr("y2",t.height).attr("x1",a).attr("x2",a).attr("display","block"),!e||!e[0]||"undefined"==typeof e[0].value||null===e[0].value||t.hide.indexOf("tooltip")>-1)return void t.container.select(".tooltip").selectAll("text.tooltip-label").remove();if(t.hide.indexOf("tooltipDot")>-1)t.container.select(".tooltip").selectAll("circle.dot").remove();else{var n=t.container.select(".tooltip").selectAll("circle.dot").data(e);n.enter().append("circle").merge(n).attr("display","block").attr("class",function(t,e){return["dot",t.id,"layer"+e].join(" ")}).attr("cx",function(e){return e.posX+t.margin.left}).attr("cy",function(e){return e.posY+t.margin.top}).attr("r",2),n.exit().remove()}var r=t.container.select(".tooltip").selectAll("text.tooltip-label").data(e);r.enter().append("text").merge(r).attr("display","block").attr("class",function(t,e){return["tooltip-label",t.id,"layer"+e].join(" ")}).attr("transform",function(e,a){return"translate("+[e.posX+t.margin.left,e.posY+t.margin.top]+")"}).attr("dx",-4).attr("text-anchor","end").text(function(e,a){return t.valueFormatter?t.valueFormatter(e,a):e.value}),r.exit().remove()}function r(t){t.container.select(".tooltip line").attr("display","none"),t.container.selectAll(".tooltip circle").attr("display","none"),t.container.selectAll(".tooltip .tooltip-label").attr("display","none")}var i=function(a){var n=a.parent.querySelector(".datahub-timeseries-chart");if(!n){var r='<div class="datahub-timeseries-chart"><div class="number-group"></div><div class="chart-group"><svg><g class="panel"><g class="shapes"></g><g class="grid x"></g><g class="axis x"></g><g class="axis y"></g><g class="axis-title x"><text></text></g><g class="axis-title y"><text></text></g><g class="reference"></g></g><g class="tooltip"><line></line></g><g class="events"><rect class="event-panel"></rect></g></svg></div></div>';n=t.utils.appendHtmlToNode(r,a.parent)}var i=(!a.data,e.select(n)),l=a.width||a.parent.clientWidth,o=a.height||a.parent.clientHeight,s=l-a.margin.left-a.margin.right,c=o-a.margin.top-a.margin.bottom;return i.select("svg").attr("width",l).attr("height",o),i.select(".panel").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),i.select(".events rect").attr("width",l).attr("height",o).attr("opacity",0),{container:i,width:l,height:o,chartWidth:s,chartHeight:c}},l=function(t){var e={top:0,right:0,bottom:10,left:10};return{margin:t.margin||e,hide:t.hide||[],chartType:t.chartType||"line"}},o=function(t){var e=t.data||[],a=[],n=[];return e.forEach(function(t){t.data.forEach(function(t,e,r){r[e].timestamp=new Date(t.timestamp),a.push(t.value),n.push(r[e].timestamp)})}),{dataConverted:e,dataValues:a,dataTimestamps:n,dataIsEmpty:!e.length}},s=function(t){if(t.dataIsEmpty)return{};var a=e.scaleTime().domain(e.extent(t.dataTimestamps)).range([0,t.chartWidth]);return{scaleX:a}},c=function(t){if(t.dataIsEmpty)return{};var a,n;t.domain?(a=t.domain[0],n=t.domain[1]):(a=e.min(t.dataValues),n=e.max(t.dataValues),"number"==typeof t.reference&&(n=Math.max(t.reference,n),a=Math.min(t.reference,a)),a===n&&(a-=a/20,n+=n/10));var r=e.scaleLinear().domain([a,n]).range([t.chartHeight,0]);return{scaleY:r}},u=function(a){if(a.dataIsEmpty)return{};var n=a.axisXTimeResolution||"minute",r="utc"+t.utils.capitalize(n),i=(e[r],a.xAxisOnTop?"axisTop":"axisBottom"),l=e[i]().scale(a.scaleX).ticks(a.xTicks||null).tickFormat(e.utcFormat(a.axisXFormat||"%H:%M"));return{axisX:l}},d=function(t){if(t.dataIsEmpty)return{};var a=e.axisLeft().scale(t.scaleY).ticks(t.yTicks||6).tickFormat(function(t){return 1>t?e.format(".2")(t):e.format(".2s")(t)}).tickPadding(10);return{axisY:a}},m=function(t){if(t.dataIsEmpty||t.hide.indexOf("xAxis")>-1)return{};t.container.select(".axis.x").attr("transform","translate("+[0,t.chartHeight]+")").call(t.axisX);return{}},h=function(t){if(t.dataIsEmpty||t.hide.indexOf("yAxis")>-1||t.axisOnly)return{};t.container.select(".axis.y").call(t.axisY);return{}},f=function(t){if(t.dataIsEmpty||t.hide.indexOf("xGrid")>-1||t.axisOnly)return{};t.container.select(".grid.x").attr("transform","translate("+[0,t.chartHeight]+")").call(t.axisX.tickSize(-t.chartHeight).tickFormat(""));return{}},v=function(t){if(t.dataIsEmpty||t.axisOnly||"line"!==t.chartType&&"area"!==t.chartType)return t.container.select(".line-group").selectAll("path.line").remove(),{};var a,n=t.chartType||"line";a="area"===n?e.area().defined(function(t){return null!=t.value}).x(function(e){return t.scaleX(e.timestamp)}).y0(function(e){return t.scaleY(0)}).y1(function(e){return t.scaleY(e.value)}):e.line().defined(function(t){return null!=t.value}).x(function(e){return t.scaleX(e.timestamp)}).y(function(e){return t.scaleY(e.value)});var r=t.container.select(".shapes").selectAll(".shape-group").data(t.dataConverted),i=r.enter().append("g").attr("class","shape-group").merge(r).selectAll("path.shape").data(function(t,e){return t.layer=e,[t]});return i.enter().append("path").merge(i).attr("class",function(t,e,a,r){return["shape",t.metadata.id,"layer"+t.layer,n].join(" ")}).attr("d",function(t){return a(t.data)}),i.exit().remove(),r.exit().remove(),{}},p=function(t){if(t.dataIsEmpty||t.axisOnly||"step"!==t.chartType)return t.container.select(".step-group").selectAll("path.shape").remove(),{};var a=t.dataConverted[0].metadata.id,n=t.stepRange||3,r=[],i=t.dataConverted[0].data;i.forEach(function(e,a){var n=Math.max(a-1,0);r.push([t.scaleX(e.timestamp),t.scaleY(i[n].value)]),r.push([t.scaleX(e.timestamp),t.scaleY(e.value)])});var l=[],o=[],s=t.dataConverted[0].data;s.forEach(function(e,a){var r=Math.max(a-1,0);l.push([t.scaleX(e.timestamp),t.scaleY(i[r].value+n)]),l.push([t.scaleX(e.timestamp),t.scaleY(e.value+n)]),o.push([t.scaleX(e.timestamp),t.scaleY(i[r].value-n)]),o.push([t.scaleX(e.timestamp),t.scaleY(e.value-n)])});var c=l.concat(o.reverse()),u=(e.line().defined(function(t){return null!=t.value}).x(function(e){return t.scaleX(e.timestamp)}).y(function(e){return t.scaleY(e.value)}),t.container.select(".shapes").selectAll(".step-group").data([r,c])),d=u.enter().append("g").attr("class","step-group").merge(u).selectAll("path.shape").data(function(t,e){return t.layer=e,[t]});return d.enter().append("path").merge(d).attr("class",function(e,n,r,i){return["shape",a,"layer"+e.layer,t.chartType].join(" ")}).attr("d",function(t,e){return"M"+t.join()}),d.exit().remove(),u.exit().remove(),{}},g=function(t){if(t.dataIsEmpty||t.axisOnly||"arrow"!==t.chartType)return t.container.select(".shapes").selectAll("path.arrow").remove(),{};var e="M6 0L12 10L8 10L8 24L4 24L4 10L0 10Z",a=t.container.select(".shapes").selectAll("path.arrow").data(t.dataConverted[0].data.filter(function(e,a){var n=t.arrowSkip||3;return a%n===0}));return a.enter().append("path").attr("class",function(t){return"arrow";
}).merge(a).attr("d",e).attr("transform",function(e){return"translate("+t.scaleX(e.timestamp)+", 0) scale(0.5) rotate("+e.value+", 6, 12)"}),a.exit().remove(),{}},x=function(t){if(t.dataIsEmpty||"number"!=typeof t.reference)return t.container.selectAll("path.reference").remove(),{};var e=t.scaleY(t.reference),a="M"+[[0,e],[t.chartWidth,e]].join("L"),n=t.container.select(".reference").selectAll("path").data([0]);return n.enter().append("path").attr("class","reference").style("fill","none").merge(n).attr("d",a),n.exit().remove(),{}},y=function(t){var n=t.container.select(".events .event-panel").on("mousemove touchstart",function(n){if(!t.dataIsEmpty){var r=e.mouse(this)[0]-t.margin.left,i=t.scaleX.invert(r),l=a(t,i);t.events.call("hover",null,l)}}).on("mouseout",function(e){t.events.call("mouseout",null,{})}).on("click",function(a){t.events.call("click",null,{event:e.event})});return{eventPanel:n}},b=function(t){if("undefined"!=typeof t.tooltipTimestamp)if(null===t.tooltipTimestamp)r(t),t.events.call("tooltipChange",null,{});else{var e=a(t,t.tooltipTimestamp);n(t,e),t.events.call("tooltipChange",null,{timestamp:e[0].timestamp})}return t.dataIsEmpty||t.axisOnly||t.hide.indexOf("tooltip")>-1?(r(t),{}):void t.events.on("hover.tooltip",function(e){n(t,e)})},w=function(t){if(t.dataIsEmpty||t.axisOnly||t.hide.indexOf("xTitle")>-1)return{};var a=t.xTitleFormat||e.utcFormat("%c"),n=t.container.select(".axis-title.x"),r=n.select("text");return t.events.on("hover.title",function(e){var i=e[0].timestamp;n.attr("transform","translate("+[t.chartWidth,t.chartHeight]+")"),r.text(a(i)).attr("dy",-8).attr("text-anchor","end")}),{}},A=function(t){return t.axisOnly||t.hide.indexOf("yTitle")>-1?{}:(t.container.select(".axis-title.y text").text(t.yAxisTitle||"").attr("dx","0.5em").attr("dy","1em"),{})},k=t.utils.pipeline(l,i,o,s,c,u,d,m,f,v,g,p,h,x,y,b,w,A),M=function(a){var n,r,i=e.dispatch("hover","click","mouseout","tooltipChange"),l=~~(1e4*Math.random()),o=t.utils.throttle(function(){n.width=n.parent.clientWidth,s()},200);e.select(window).on("resize."+l,o);var s=function(){r=k(n)},c=function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return n=t.utils.mergeAll({},n,{data:a}),s(),this},u=function(e){return n=t.utils.mergeAll({},n,e),s(),this},d=function(e,a){u(t.utils.mergeAll({},e,{events:a}))},m=function(){e.select(window).on("resize."+l,null),n.parent.innerHTML=null};return d(a,i),{on:t.utils.rebind(i),setConfig:u,setData:c,destroy:m}};t.timeseries=M}(a,n.d3),!function(t,e){var a=function(a){var n=a.parent.querySelector(".datahub-vertical-chart");if(!n){var r='<div class="datahub-vertical-chart"><div class="header"></div><div class="chart-container"><div class="chart-wrapper"><svg><g class="panel"><g class="reference-bars"></g><g class="bars"></g><g class="axis"></g></g></svg></div></div><div class="number-container"></div></div>';n=t.utils.appendHtmlToNode(r,a.parent)}var i=!(a.elements&&a.elements.length),l=e.select(n),o=l.select(".chart-container"),s=o.node().clientWidth,c=26,u=i?0:a.elements.length*c;return{container:l,chartWidth:s,chartHeight:u,rowHeight:c,dataIsEmpty:i,refernceValue:100}},n=function(t){var a=e.scaleLinear().domain([0,100]).range([0,t.referenceBarSize]);return{scaleX:a}},r=function(t){return t.container.select(".header").html(t.title),{}},i=function(t){var e=t.container.select(".number-container").selectAll(".number").data(t.elements||[]),a=e.enter().append("div").merge(e).attr("class",function(t,e){return"number number"+e});e.exit().remove();var n=a.selectAll(".label").data(function(t){return[t]});n.enter().append("div").attr("class","label").merge(n).html(function(t){return t.label}),n.exit().remove();var r=a.selectAll(".value").data(function(t){return[t]});return r.enter().append("div").attr("class","value").merge(r).html(function(e){return Math.round(e.value)+" "+t.unit}),r.exit().remove(),{}},l=function(t){var e=t.container.select("svg").attr("width",t.chartWidth).attr("height",t.chartHeight).select(".panel"),a=t.rowHeight,n=a-2,r=n/2,i=e.select(".bars").selectAll(".bar").data(t.elements||[]);i.enter().append("rect").merge(i).attr("class",function(t,e){return["bar",t.label.toLowerCase(),"bar"+e].join(" ")}).attr("x",function(e){var a=t.scaleX(e.value);return 0>a?t.chartWidth/2-Math.abs(a):t.chartWidth/2}).attr("y",function(t,e){return a*e+(a-r)/2}).attr("width",function(e){return e.value?Math.abs(t.scaleX(e.value)):void 0}).attr("height",r),i.exit().remove();var l=e.select(".reference-bars").selectAll(".bar").data(t.elements||[]);l.enter().append("rect").attr("class","bar").merge(l).attr("x",t.chartWidth/2).attr("y",function(t,e){return a*e+(a-n)/2}).attr("width",function(e,a){return t.referenceBarSize}).attr("height",n),l.exit().remove();var o=e.select(".reference-bars").selectAll(".line").data(t.elements||[]);return o.enter().append("line").attr("class","line").merge(o).attr("x1",t.chartWidth/2+t.referenceBarSize).attr("y1",function(t,e){return a*e+(a-n)/2}).attr("x2",t.chartWidth/2+t.referenceBarSize).attr("y2",function(t,e){return a*e+(a-n)/2+n}),o.exit().remove(),{}},o=function(t){var e=t.container.select(".axis").selectAll(".vertical").data([0]);return e.enter().append("line").attr("class","vertical").merge(e).attr("x1",t.chartWidth/2).attr("y1",0).attr("x2",t.chartWidth/2).attr("y2",t.chartHeight),e.exit().remove(),{}},s=t.utils.pipeline(a,r,i,n,o,l),c=function(a){var n,r,i=e.dispatch("barHover"),l=~~(1e4*Math.random()),o=t.utils.throttle(function(){n.width=n.parent.clientWidth,c()},200);e.select(window).on("resize."+l,o);var c=function(){r=s(n)},u=function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return n=t.utils.mergeAll({},n,{data:a}),c(),this},d=function(e){return n=t.utils.mergeAll(n,e),c(),this},m=function(e,a){d(t.utils.mergeAll(e,{events:a}))},h=function(){e.select(window).on("resize."+l,null),n.parent.innerHTML=null};return m(a,i),{on:t.utils.rebind(i),setConfig:d,setData:u,destroy:h}};t.verticalChart=c}(a,n.d3),!function(t,e){var a=function(a){var n=a.parent.querySelector(".datahub-waterfall-chart");if(!n){var r='<div class="datahub-waterfall-chart"><div class="chart-container"><svg><g class="panel"><g class="bars"></g><g class="connectors"></g></g></svg></div><div class="number-container"></div></div>';n=t.utils.appendHtmlToNode(r,a.parent)}var i=!(a.elements&&a.elements.length),l=!(!i&&a.elements[0].value),o=e.select(n),s=o.select(".chart-container"),c=a.width||s.node().clientWidth,u=a.height||s.node().clientHeight||300,d=[1,3],m=[1];return{container:o,chartWidth:c,chartHeight:u,dataIsEmpty:l,infoIsEmpty:i,elements:a.elements||[],isConnected:d,isNegative:m}},n=function(t){var a=e.scaleBand().domain(e.range(t.elements.length)).rangeRound([0,t.chartWidth]).paddingInner(.4).paddingOuter(.2);return{scaleX:a}},r=function(t){var a=t.elements.map(function(t){return t.value}),n=e.scaleLinear().domain([0,e.max(a)]).range([0,t.chartHeight]);return{scaleY:n}},i=function(t){var e=t.container.select("svg").attr("width",t.chartWidth).attr("height",t.chartHeight).select(".panel");if(t.dataIsEmpty)return e.select(".bars").selectAll(".bar").remove(),{};var a=e.select(".bars").selectAll(".bar").data(t.elements);return a.enter().append("rect").merge(a).attr("class",function(t,e){return["bar",t.label.toLowerCase(),t.key,"bar"+e].join(" ")}).attr("x",function(e,a){return t.scaleX(a)}).attr("y",function(e,a){var n=t.isConnected.indexOf(a)>-1;if(n){var r=Math.max(0,a-1),i=t.elements[r];return t.isNegative.indexOf(a)>-1?t.chartHeight-t.scaleY(Math.abs(i.value)):t.chartHeight-t.scaleY(Math.abs(i.value))-t.scaleY(Math.abs(e.value))}return t.chartHeight-t.scaleY(Math.abs(e.value))}).attr("width",function(e){return e.value?t.scaleX.bandwidth():void 0}).attr("height",function(e){return t.scaleY(Math.abs(e.value))}),a.exit().remove(),{}},l=function(t){if(t.dataIsEmpty)return t.container.select(".connectors").selectAll(".connector").remove(),{};var e=t.container.select(".connectors").selectAll(".connector").data(t.elements);e.enter().append("line").attr("class","connector").merge(e).attr("x1",function(e,a){return t.scaleX(a)}).attr("y1",function(e,a){var n=t.isConnected.indexOf(a)>-1;if(n){var r=Math.max(0,a-1),i=t.elements[r];return t.isNegative.indexOf(a)>-1?t.scaleY(Math.abs(e.value)):t.chartHeight-t.scaleY(Math.abs(i.value))-t.scaleY(Math.abs(e.value))}return t.chartHeight-t.scaleY(Math.abs(e.value))}).attr("x2",function(e,a){return t.scaleX(Math.min(a+1,t.elements.length-1))}).attr("y2",function(e,a){var n=t.isConnected.indexOf(a)>-1;if(n){var r=Math.max(0,a-1),i=t.elements[r];return t.isNegative.indexOf(a)>-1?t.chartHeight-t.scaleY(Math.abs(i.value))+t.scaleY(Math.abs(e.value)):t.chartHeight-t.scaleY(Math.abs(i.value))-t.scaleY(Math.abs(e.value))}return t.chartHeight-t.scaleY(Math.abs(e.value))}),e.exit().remove();var e=t.container.select(".connectors").selectAll(".base").data([0]);return e.enter().append("line").attr("class","base").merge(e).attr("x1",t.scaleX(0)).attr("y1",t.chartHeight).attr("x2",t.scaleX(Math.max(t.elements.length-1,0))+t.scaleX.bandwidth()||0).attr("y2",t.chartHeight),e.exit().remove(),{}},o=function(t){var e=t.container.select(".number-container").selectAll(".number").data(t.elements),a=e.enter().append("div").merge(e).attr("class",function(t,e){return"number number"+e});e.exit().remove();var n=a.selectAll(".label").data(function(t){return[t]});n.enter().append("div").attr("class","label").merge(n).html(function(t){return t.label}),n.exit().remove();var r=a.selectAll(".value").data(function(t){return[t]});return r.enter().append("div").attr("class","value").merge(r).html(function(t){return"undefined"==typeof t.value?'<div class="error">(Data Unavailable)</div>':Math.round(t.value)}),r.exit().remove(),{}},s=t.utils.pipeline(a,n,r,i,l,o),c=function(a){var n,r,i=e.dispatch("barHover"),l=~~(1e4*Math.random()),o=t.utils.throttle(function(){n.width=n.parent.clientWidth,c()},200);e.select(window).on("resize."+l,o);var c=function(){r=s(n)},u=function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return n=t.utils.mergeAll({},n,{data:a}),c(),this},d=function(e){return n=t.utils.mergeAll(n,e),c(),this},m=function(e,a){d(t.utils.mergeAll(e,{events:a}))},h=function(){e.select(window).on("resize."+l,null),n.parent.innerHTML=null};return m(a,i),{on:t.utils.rebind(i),setConfig:d,setData:u,destroy:h}};t.waterfallChart=c}(a,n.d3),!function(t,e){function n(t,a){var n=e.utcFormat("%c")(t);a.events.call("hover",null,{formattedDate:n})}function r(t,e,a,r,i){for(var l in t)if(l===e)for(var o in t[l])o!==a&&t[l][o].setConfig({tooltipTimestamp:r});else for(var o in t[l])t[l][o].setConfig({tooltipTimestamp:null});n(r,i)}var i=function(a){var n=a.parent.querySelector(".datahub-weather-chart");if(!n){var r='<div class="datahub-weather-chart"><div class="chart-row topAxis"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row wind"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row windDirection"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row wave"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row tide"><div class="historical"></div><div class="forecast"></div></div><div class="chart-row bottomAxis"><div class="historical"></div><div class="forecast"></div></div></div>';n=t.utils.appendHtmlToNode(r,a.parent)}var i=!a.data,l=e.select(n),o=a.width||n.clientWidth,s=a.height||n.clientHeight||300;return{container:l,chartWidth:o,chartHeight:s,dataIsEmpty:i}},l=function(t){var n={tickStep:20,resolution:"minute",axisXFormat:"%H:%M",domain:[0,50],chartType:"area",yTicks:3,height:80,width:t.chartWidth/2,valueFormatter:function(t,e){return Math.round(100*t.value)/100},hide:["xTitle","yTitle","xAxis"],margin:{top:10,right:20,bottom:10,left:50}},r=a.utils.mergeAll({},n,{xTicks:e.utcHour.every(12),resolution:"hour",hide:["xAxis","yAxis","yTitle","xTitle"],margin:{top:10,right:20,bottom:10,left:0}}),i={hide:["xAxis","yAxis","xTitle","yTitle","tooltipDot"],chartType:"arrow",arrowSkip:1,height:20,margin:{top:0,right:20,bottom:0,left:50}},l=a.utils.mergeAll({},n,i),o=a.utils.mergeAll({},r,i,{margin:{top:0,right:20,bottom:0,left:0},arrowSkip:6}),s={axisOnly:!0,xAxisOnTop:!0,hide:["yAxis","yTitle","tooltip"],height:20,margin:{top:20,right:20,bottom:0,left:50}},c=a.utils.mergeAll({},n,s),u=a.utils.mergeAll({},r,s,{margin:{top:20,right:20,bottom:0,left:0}}),d=a.utils.mergeAll({},n,s,{margin:{top:0,right:20,bottom:20,left:50},xAxisOnTop:!1}),m=a.utils.mergeAll({},r,s,{margin:{top:0,right:20,bottom:20,left:0},xAxisOnTop:!1}),h={historical:{wind:n,windDirection:l,wave:n,tide:n,bottomAxis:d,topAxis:c},forecast:{wind:r,windDirection:o,wave:r,tide:r,bottomAxis:m,topAxis:u}};return{chartConfig:h}},o=function(t){var e=t.data;return{dataConverted:e}},s=function(t){var e={historical:{wind:null,windDirection:null,wave:null,tide:null,bottomAxis:null,topAxis:null},forecast:{wind:null,windDirection:null,wave:null,tide:null,bottomAxis:null,topAxis:null}};for(var n in e)for(var i in e[n])e[n][i]=a.timeseries({parent:t.container.select("."+i+" ."+n).node()}).setConfig(t.chartConfig[n][i]).on("hover",function(a){var l=n,o=i;return function(a){r(e,l,o,a[0].timestamp,t)}}()).on("mouseout",function(){var a=new Date(t.dataConverted.historical.wind[0].data.slice(-1)[0].timestamp);r(e,"historical",null,a,t)}),t.dataIsEmpty||e[n][i].setData(t.dataConverted[n][i]);return{charts:e}},c=t.utils.pipeline(i,l,o,s),u=function(a){var n,r,i=e.dispatch("hover"),l=~~(1e4*Math.random()),o=t.utils.throttle(function(){n.width=n.parent.clientWidth,s()},200);e.select(window).on("resize."+l,o);var s=function(){r=c(n)},u=function(e){var a=e?JSON.parse(JSON.stringify(e)):{};return n=t.utils.mergeAll({},n,{data:a}),s(),this},d=function(e){return n=t.utils.mergeAll(n,e),s(),this},m=function(e,a){d(t.utils.mergeAll(e,{events:a}))},h=function(){e.select(window).on("resize."+l,null),n.parent.innerHTML=null};return m(a,i),{setConfig:d,setData:u,destroy:h}};t.weatherChart=u}(a,n.d3);var a=t="object"==typeof t?t:{},n="object"==typeof e?e:window;"object"==typeof module&&module.exports?n.d3=require("d3"):n.d3=n.d3,"object"==typeof module&&module.exports&&(module.exports=t),e.datahub=t}({},function(){return this}());