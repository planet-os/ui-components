<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.7/leaflet.draw.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.0/d3.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="../src/datahub-utils.js"></script>
    <script src="../src/datahub-palette.js"></script>
    <script src="../src/datahub-data.js"></script>
    <script src="../src/datahub-map.js"></script>
    <script src="../src/datahub-widget.js"></script>
    <script src="../src/datahub-group.js"></script>
    <script src="../src/datahub-chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.7/leaflet.draw.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <link rel="stylesheet" href="../style/components.css" />
    <link rel="stylesheet" href="../style/dark-theme.css" />
    <style>
    div {
        /*border: 1px solid silver;*/
    }
    
    .map {
        width: 512px;
        height: 512px;
        margin: 0 auto;
    }
    
    .map-group {
        width: 550px;
        margin: 0 auto;
    }
    
    .map-group .map {
        width: 256px;
        height: 256px;
    }
    
    .map-group .map:not(:last-child) {
        margin-right: 10px;
    }
    
    .chart {
        width: 512px;
        height: 300px;
        margin: 0 auto;
    }
    
    .vertical-buttons {
        height: 200px;
        width: 60px;
        margin: 0 auto;
    }
    
    .section {
        max-width: 64em;
        margin: 0 auto 20px auto;
        padding: 20px;
    }
    
    .button-group.vertical {
        max-width: 64px;
    }
    </style>
</head>

<body>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row map-group">
                <div class="map map-light"></div>
                <div class="map map-dark"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A map can have a light or dark basemap.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row map-group">
                <div class="map map-grayscale"></div>
                <div class="map map-rainbow"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A map can load raster data. Multiple palettes are available, like a simple linear grayscale and a rainbow palette using histogram equalization.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="map map-raster"></div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A map can zoom and pan raster efficiently. A tooltip shows value under the cursor.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="map map-vector"></div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A map can load vector data, points and polygons.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="map map-selector"></div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A vector map supports markers and rectangle selection. Clicking on the selection deletes it.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="multiline-chart"></div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A timeseries chart can have multiple lines.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="time-slider"></div>
            <div class="slider-chart"></div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A time slider is used to zoom in a timeseries.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row">
                <div class="number-widget big col-xs"></div>
                <div class="number-widget medium col-xs"></div>
                <div class="number-widget small col-xs"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A number widget comes in 3 sizes. It can have a title, a value and some info.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row">
                <div class="number-group small col-xs"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">Number widgets can be grouped.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row">
                <div class="table-widget col-xs"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A table can be sorted.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row">
                <div class="button-group vertical col-xs"></div>
                <div class="button-group horizontal col-xs"></div>
                <div class="button-group exclusive col-xs"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A group of buttons can be stacked vertically or horizontally. It can also be exclusive, forcing only one button to be selected.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row">
                <div class="legend col-xs"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">A group of buttons accepts html labels and can be styled as a legend. Legend element can be toggled on or off.</div>
        </div>
    </div>
    <div class="row section">
        <div class="col-xs-12 col-md-7">
            <div class="row">
                <div class="alert-message col-xs"></div>
            </div>
        </div>
        <div class="col-xs-12 col-md-5">
            <div class="description">An alert message has a colored band with icon and a message.</div>
        </div>
    </div>
    <script>
    /**/
    /*
        changelog:
        - d3v4 scales
        - which scale as rgb, uses custom parser
        - default imagePath
        - removed datahubmap util for datahub.utils
        - datahub.map.rasterMap
        - flattenAndUniquify -> arrayStats
        - zoom is in mapConfig.zoom
        - el and container -> parent
        - datahub.data.setApiKey
    */

    datahub.data.setApiKey('0f58fe2540fa4cf19a4aa68f290fd148')

    datahub.map.rasterMap({
            parent: document.querySelector('.map-light'),
            showLabels: false,
            mapConfig: {
                zoomControl: false
            },
            showTooltip: false
        })
        .init()

    datahub.map.rasterMap({
            parent: document.querySelector('.map-dark'),
            basemapName: 'basemapLight',
            showLabels: false,
            mapConfig: {
                zoomControl: false
            },
            showTooltip: false
        })
        .init()


    var datasetName = 'noaa_gfs_global_sflux_0.12d'
    var variableName = 'Temperature_hybrid'
    datahub.data.getPreview(datasetName, variableName, null, function(response) {
        rasterMap.renderRaster(response.json)
        rasterMapGrayscale.renderRaster(response.json)
        rasterMapBig.renderRaster(response.json)
    })

    var rasterMap = datahub.map.rasterMap({
            parent: document.querySelector('.map-grayscale'),
            colorScale: datahub.palette.grayscale,
            showLabels: false,
            mapConfig: {
                zoomControl: false
            },
            showTooltip: false
        })
        .init()

    var rasterMapGrayscale = datahub.map.rasterMap({
            parent: document.querySelector('.map-rainbow'),
            colorScale: datahub.palette.equalizedSpectral,
            showLabels: false,
            mapConfig: {
                zoomControl: false
            },
            showTooltip: false
        })
        .init()

    var rasterMapBig = datahub.map.rasterMap({
            parent: document.querySelector('.map-raster'),
            colorScale: datahub.palette.equalizedSpectral
        })
        .init()

    datahub.data.getWorldVector(function(geojson) {
        vectorMap.renderPolygon(geojson)
    })

    var pointsGeojson = datahub.data.generateGeojsonPoints()

    var vectorMap = datahub.map.rasterMap({
            parent: document.querySelector('.map-vector')
        })
        .init()
        .renderPolygon(pointsGeojson)

    datahub.map.selectorMap({
        parent: document.querySelector('.map-selector')
    })


    var timeSeries = datahub.data.generateTimeSeries(400, 3)
    var container = document.querySelector('.multiline-chart')
    datahub.chart.timeseriesMultilineChart({
        parent: container,
        width: container.clientWidth,
        height: 300,
        margin: {
            top: 50,
            right: 40,
            bottom: 90,
            left: 60
        },
        data: timeSeries,
        axisTitleY: 'Unit'
    })

    var sliderChartContainer = document.querySelector('.slider-chart')

    function renderMainChart(timeSeries) {
        datahub.chart.timeseriesMultilineChart({
            parent: sliderChartContainer,
            width: sliderChartContainer.clientWidth,
            height: 300,
            margin: {
                top: 50,
                right: 40,
                bottom: 60,
                left: 60
            },
            data: timeSeries,
            axisTitleY: 'Unit'
        })
    }

    var timeSeries = datahub.data.generateTimeSeries(365, 6, '2016-01-01', 'day', 1)

    var timeSliderContainer = document.querySelector('.time-slider')
    var timeSlider = datahub.widget.timeSlider({
        parent: timeSliderContainer,
        timeRange: ['2016-01-01', '2017-01-01'],
        initialTimeRange: ['2016-01-01', '2017-01-01'],
        width: timeSliderContainer.clientWidth,
        height: 40,
        margin: {
            top: 4,
            right: 60,
            bottom: 4,
            left: 60
        }
    })

    timeSlider.events.on('brush', function(d) {
        var startIndex = datahub.utils.bisection(timeSeries.timestamps, d.brushExtent.start)
        var endIndex = datahub.utils.bisection(timeSeries.timestamps, d.brushExtent.end)
        var timeseriesSlice = {
            values: timeSeries.values.map(function(d, i) {
                return d.slice(startIndex, endIndex)
            }),
            timestamps: timeSeries.timestamps.slice(startIndex, endIndex)
        }

        renderMainChart(timeseriesSlice)
    })

    renderMainChart(timeSeries)

    datahub.widget.number({
        parent: document.querySelector('.number-widget.big'),
        title: 'NET PRODUCTION',
        value: '236,43GWh',
        info: 'Plan: 231,64GWh'
    })

    datahub.widget.number({
        parent: document.querySelector('.number-widget.medium'),
        value: '236,43GWh',
        info: 'Net Production'
    })

    datahub.widget.number({
        parent: document.querySelector('.number-widget.small'),
        value: '16,00%',
        info: 'MTD Actual'
    })

    datahub.group.number({
        parent: document.querySelector('.number-group'),
        elements: [{
            value: '236,43GWh',
            info: 'Net Production'
        },
        {
            value: '236,43GWh',
            info: 'Plan: 231,64GWh'
        },
        {
            value: '16,00%',
            info: 'MTD Actual'
        }]
    })

    datahub.widget.table({
        parent: document.querySelector('.table-widget'),
        elements: [
            ['Spain', 1, 2],
            ['Germany', 7, 8],
            ['United Kingdom', 1, 2],
            ['Poland', 7, 8],
            ['Netherlands', 1, 2],
            ['Italy', 7, 8],
        ],
        metadata: [{
            key: 'country',
            label: 'Country',
            sortable: true
        }, {
            key: 'production',
            label: 'Production',
            units: 'MWh',
            sortable: true
        }, {
            key: 'revenues',
            label: 'Revenues',
            units: 'M€'
        }]
    })

    var heightSelector = datahub.widget.buttonGroup({
        parent: document.querySelector('.button-group.vertical'),
        elements: [{
            label: 'All',
            key: 'all'
        }, {
            label: '200',
            key: '200'
        }, {
            label: '180',
            key: '180'
        }, {
            label: '160',
            key: '160'
        }],
        defaultElement: 'all',
        isExclusive: true
    })

    heightSelector.events.on('click', function(d) {
        console.log(d)
    })

    datahub.widget.buttonGroup({
        parent: document.querySelector('.button-group.horizontal'),
        elements: [{
            label: 'All',
            key: 'all'
        }, {
            label: '200',
            key: '200'
        }, {
            label: '180',
            key: '180'
        }, {
            label: '160',
            key: '160'
        }],
        defaultElement: 'all'
    })

    datahub.widget.buttonGroup({
        parent: document.querySelector('.button-group.exclusive'),
        elements: [{
            label: 'All',
            key: 'all'
        }, {
            label: '200',
            key: '200'
        }, {
            label: '180',
            key: '180'
        }, {
            label: '160',
            key: '160'
        }],
        defaultElement: 'all',
        isExclusive: true
    })

    datahub.widget.buttonGroup({
        parent: document.querySelector('.legend'),
        elements: [{
            label: 'Legend element 1 <span class="units">(MWh)</span>',
            key: 'element1',
            colorClass: 'color-1'
        }, {
            label: 'Legend element 2 <span class="units">(MWh)</span>',
            key: 'element2',
            colorClass: 'color-2'
        }],
        defaultElement: 'element1'
    })

    datahub.widget.alertMessage({
        parent: document.querySelector('.alert-message'),
        level: 'low',
        message: 'Alert message, low'
    })

    datahub.widget.alertMessage({
        parent: document.querySelector('.alert-message'),
        level: 'medium',
        message: 'Alert message, medium'
    })

    datahub.widget.alertMessage({
        parent: document.querySelector('.alert-message'),
        level: 'high',
        message: 'Alert message, high'
    })
    </script>
</body>

</html>
