<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.0/d3.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="../src/datahub-utils.js"></script>
    <script src="../src/datahub-palette.js"></script>
    <script src="../src/datahub-data.js"></script>
    <script src="../src/datahub-map.js"></script>
    <script src="../src/datahub-chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.2/leaflet.css" />
    <link rel="stylesheet" href="../style/components.css" />
    <style>
    .map {
        width: 512px;
        height: 512px;
    }
    
    .chart {
        width: 512px;
        height: 300px;
    }

    .vertical-buttons {
        height: 200px;
        width: 60px;
    }


    </style>
</head>

<body>
    <div class="map"></div>
    <div class="legend"></div>
    <div class="chart"></div>
    <div class="time-slider"></div>
    <div class="vertical-buttons"></div>
    <script>
    /**/
    /*
        upgrades:
        - d3v4 scales
        - which scale as rgb, uses custom parser
        - default imagePath
        - removed datahubmap util for datahub.utils
        - datahub.map.rasterMap
        - flattenAndUniquify -> arrayStats
        - zoom is in mapConfig.zoom
        - el and container -> parent
    */

    var heightSelector = datahub.chart.buttonGroup({
        parent: document.querySelector('.vertical-buttons'),
        elements: ['All', 200, 180, 160, 140, 120, 100, 80, 60, 50, 40],
        defaultElement: 'All',
        margin: {
            top: 0,
            right: 0,
            bottom: 0,
            left: 0
        }
    })

    heightSelector.events.buttonClick.on(function(d) {
        console.log(d)
    })

    var timeSlider = datahub.chart.timeSlider({
        parent: document.querySelector('.time-slider'),
        timeRange: ['2016-01-01', '2017-01-01'],
        width: 500,
        height: 40,
        margin: {
            top: 0,
            right: 70,
            bottom: 0,
            left: 60
        }
    })

    timeSlider.events.brush.on(function(d) {
        console.log(d)
    })

    datahub.chart.legend({
        parent: document.querySelector('.legend'),
        elements: [{
            label: 'Vaisala @ 40M',
            colorClass: 'color-0',
            value: 2.2,
            unit: 'm/s'
        }, {
            label: 'National Weather Service',
            colorClass: 'color-1',
            value: 2.1,
            unit: 'm/s'
        }, {
            label: 'NOAA GFS',
            colorClass: 'color-2',
            value: 2.0,
            unit: 'm/s'
        }]
    })

    var timeSeries = datahub.data.generateTimeSeries(40, 3)
    datahub.chart.timeseriesMultilineChart({
        parent: document.querySelector('.chart'),
        width: 500,
        height: 300,
        margin: {
            top: 50,
            right: 70,
            bottom: 90,
            left: 60
        },
        data: timeSeries,
        axisTitleY: 'Unit'
    })

    var datasetName = 'noaa_gfs_global_sflux_0.12d'
    var variableName = 'Temperature_hybrid'

    datahub.data.getPreview(datasetName, variableName, null, function(response) {
        console.log(response)
        mainMap.renderRaster(response.json)
    })

    var rasterData = datahub.data.generateRaster()
    var polygon = datahub.data.generateGeojson()

    var mainMap = datahub.map.rasterMap({
            parent: document.querySelector('.map'),
            colorScale: datahub.palette.equalizedSpectral,
            // colorScale: colorScales.grayscale,
        })
        .init()

    // .renderRaster(rasterData)
    // .addMarker([0, 0])
    // .renderPolygon(polygon)
    // .zoomToPolygonBoundingBox(polygon)

    // mainMap.events.click.on(function(e) {
    //     console.log(e)
    // })
    </script>
</body>

</html>
